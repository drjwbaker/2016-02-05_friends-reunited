FR.Data={Get:function(n,t,i,r){t=$.extend({dataType:"html"},t),$.ajax({type:"GET",url:n,cache:!1,dataType:t.dataType,success:function(n){typeof i=="function"&&i(n)},error:function(t,i,u){FR.Error(u,n),FR.Data.IsAbort(t)||i!="error"&&i!="timeout"&&i!="parsererror"||(typeof r=="function"?r(t,i,u):FR.Notification.Add("There was a problem","We're sorry, but something went wrong, and we weren't able to complete your request.","warning"))}})},Post:function(n,t,i,r,u){t=$.extend({jsonify:!0,dataType:"json",contentType:"application/json"},t),$.ajax({type:"POST",url:n,data:t.jsonify?JSON.stringify(i):i,dataType:t.dataType,contentType:t.contentType,success:function(n){typeof r=="function"&&r(n)},error:function(t,i,r){FR.Error(r,n),FR.Data.IsAbort(t)||i!="error"&&i!="timeout"&&i!="parsererror"||(typeof u=="function"?u(t,i,r):FR.Notification.Add("There was a problem","We're sorry, but something went wrong, and we weren't able to complete your request.","warning"))}})},IsAbort:function(n){return!n.getAllResponseHeaders()}};FR.Util={ShowEl:function(n){$(n).unblock(),$(n).children().css("visibility","visible")},HideEl:function(n){var t=$("#pleaseWait");t.length<1&&$(n).after('<div id="pleaseWait" style="display: none;"><img src="'+FR.StaticUrl+'/img/loadingSpinner.gif" alt="Loading" height="28px" width="28px" /></div>'),$(n).children().css("visibility","hidden"),$(n).block({message:$("#pleaseWait"),css:{border:"none"},overlayCSS:{backgroundColor:"#FFF",opacity:1}})},ErrorMsg:function(n,t){var i='<span class="alertMessage">'+t+"</span>";$(n).html(i)},ErrorMsgRemove:function(n){$(n).html("")},ErrorButton:function(n,t,i){$(n).addClass("errorButton").html(t).off("click").on("click",function(){var t="error-window",n="width=850,height=650,scrollbars=yes";window.open(i,t,n)})},AttachInlineCount:function(n,t){var i,r,e,f,o,u;n.length>0&&(i=$.extend({count:1e3,expandable:!1,toggleCount:!0,exceedCls:"exceed",startText:"Maximum of {0} characters",standardText:"Characters left: {0}",exceedText:"{0} characters too many",targetEl:null,countClass:"chars-left"},t),r=$(n).attr("id"),r||(r=$(n).attr("name")),e=$(n).val().length,f=e>0?'<div class="clear"></div><span style="display: none;" class="'+i.countClass+'" data-element="'+r+'">'+i.standardText.replace("{0}",i.count-e)+"</span>":'<div class="clear"></div><span style="display: none;" class="'+i.countClass+'" data-element="'+r+'">'+i.startText.replace("{0}",i.count)+"</span>",i.targetEl?$(i.targtEl).append(f):$(n).after(f),i.expandable&&($(".lt-ie9").length>0?$(n).height("auto").css("overflow","auto"):(o=$(n).height(),$(n).wrap('<div class="sizeWapper" />').addClass("overflowHide"),$(n).smartkeydown(function(){var r=new Date,t,i;$(n).parent().height($(n).height()),$(n).height(20).height($(n)[0].scrollHeight+30),$(n).height()<o&&$(n).height(o),$(n).parent().height("auto"),t=new Date,i=t-r}).addClass("overflowHide"))),u=$("."+i.countClass+"[data-element="+r+"]"),u&&(i.toggleCount?$(n).focus(function(){u.fadeIn()}):u.show()),$(n).smartkeydown(function(){var u=$("."+i.countClass+"[data-element="+r+"]"),t=Math.abs(i.count-n.val().length);$(n).val().length>i.count?(u.text(i.exceedText.replace("{0}",t)).addClass(i.exceedCls),$(n).addClass(i.exceedCls)):(u.text(i.standardText.replace("{0}",t)).removeClass(i.exceedCls),$(n).removeClass(i.exceedCls))}))},GetQueryStringValue:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+n+"=([^&#]*)",r=new RegExp(i),t=r.exec(window.location.search);return t==null?"":decodeURIComponent(t[1].replace(/\+/g," "))},AddLargeProfileLinks:function(){function n(n,t){$.getJSON("/Member/MemberDetails?id="+n+"&encodedId="+t,function(n){$(".profileName").text(n.Data.Name),$(".profileLink").attr("href",n.Data.ProfileUrl),n.Data.IsFriend?$(".removeFriend").show():$(".addFriend").show(),$(),n.Data.Description?($(".profileDescription").text(n.Data.Description),$(".profileDescription").height()>115&&$(".profileDescription").append('<div class="fadeOutToWhite"></div>')):$(".profileDescription").remove(),$(".largeProfileImage").attr("src",n.Data.FullImageUrl).attr("alt",n.Data.Name)})}$(".profileImage").each(function(){}),$(".profileImage").attr("title","Click to enlarge");$(".profileImage").on("click",function(t){if($("body").is(".gallery"))return!1;t.preventDefault(),$(".profileZoom").remove(),$(this).parent().is("a")&&$(this).unwrap(),$("body").append('<div class="profileZoom"><div class="profileZoomHolder"><img class="largeProfileImage"/></div><div class="profileName"></div><div class="profileDescription"></div><a class="profileLink" href="#" title="View full profile">View full profile</a><a class="close" href="#">Close</a><a class="mail" href="/Mail/SendTo?id='+$(this).attr("data-id")+"&encodedId="+$(this).attr("data-encoded")+'" title="Send Message">Mail</a><a class="addFriend" href="#" title="Add to friend list">Add Friend</a><a class="removeFriend" href="#" title="Remove from friend list">Remove Friend</a></div>'),n($(this).attr("data-id"),$(this).attr("data-encoded")),$(".profileZoom").animate({width:"350",height:"280"},"10",function(){$(this).height("auto").width("350").css("overflow","visible"),$(this).find(".close").show()});var i=$(this).attr("data-id");$(".profileZoom .addFriend").on("click",function(n){n.preventDefault();var t=this;FR.Data.Post(FR.UrlHelper.Urls.Relationship.AddFriend,[],{friendId:i},function(){$(t).hide(),$(t).removeClass("wait"),$(t).next().show()})});$(".profileZoom .removeFriend").on("click",function(n){n.preventDefault();var t=this;FR.Data.Post("/Relationship/RemoveByMemberId",[],{friendId:i},function(){$(t).hide(),$(t).prev().show()})});return!1});$(".profileZoom .close").live("click",function(){return $(this).closest(".profileZoom").remove(),!1}),$("body").bind("click",function(n){$(n.target).closest(".profileZoom").length==0&&window.location.pathname.indexOf("eighbours")==-1&&$(".profileZoom").remove()})}};FR.Reporter={Setup:function(){function n(n){var t,r,i;n.preventDefault(),t=this,$(t).attr("data-validated-member")=="True"?$(t).attr("generated")&&(r=$(t).attr("data-id"),i=$(t).attr("data-type"),FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.ReportForm,{key:r,type:i}),{},function(n){$("#report-container").html(n),$("#Redirect").val($(t).attr("data-url")),$("#reportAbuse").modal({})})):window.location.href=FR.UrlHelper.Urls.Validation}$("body").on("click",".report",n)},Error:function(n){function t(n,r){k,typeof r!="function"&&(i(n,r),r instanceof Object&&$.each(r,function(n,i){t(n,i)}))}function i(){}$.each(n,function(n,i){t(n,i)})}};FR.Notification={Add:function(n,t,i){var r="";i=="warning"?r="stickyBad":i=="confirmation"&&(r="stickyGood"),$.sticky('<div class="stickyNote '+r+'"><div><h3>'+n+"</h3><p>"+t+"</p></div></div>")}};FR.Geolocation={Data:{},Setup:function(){$("#findMe").click(function(){var n=$("#locationInput").val();return n!=""&&($("#locationFinder").addClass("loading"),$("#findMe, #locationEntry").hide(),$.getJSON("/Location/Geocode?address="+n,function(n){FR.Geolocation.Data=n;var t='<select name="locationResults" id="locationResults">';$.each(n,function(n,i){t+="<option value="+n+">"+i.Text+"</option>"}),t+="</select>",$("#locationResult").html(t).show().after('<a href="#" id="clearLocation" class="secondaryButton">Clear</a>'),$("#locationInput").val(""),FR.Geolocation.SetLocation(0),$("#locationResults").change(function(){var n=$(this).val();FR.Geolocation.SetLocation(n)}),$("#clearLocation").live("click",function(){return FR.Geolocation.ClearLocation(),$("#locationResult").html(""),$("#findMe, #locationEntry").show(),$(this).remove(),!1}),$("#locationEntry").hide(),$("#locationFinder").removeClass("loading")})),!1})},SetLocation:function(n){$("#Location_Text").val(FR.Geolocation.Data[n].Text),$("#Location_Latitude").val(FR.Geolocation.Data[n].Latitude),$("#Location_Longitude").val(FR.Geolocation.Data[n].Longitude)},ClearLocation:function(){$("#Location_Text").val(""),$("#Location_Latitude").val(""),$("#Location_Longitude").val("")}};FR.Tagging={Data:{Tags:{},ErrorShowing:!1},Config:{Url:"",El:"",AllowNew:!0,SuggestionCount:6,Input:"#tagInput",AddButton:"#addKeyword",SaveButton:"#SaveButton",AddedTags:"#addedTags",AutoCompleteTags:"#autocompleteTags",SuggestedTags:"#suggestedTags",JSONString:"#KeywordJsonString"},Setup:function(n,t){FR.Tagging.Config.Url=n,$.getJSON(FR.Tagging.Config.Url,function(n){FR.Tagging.Data.Tags=$.map(n,function(n){return{id:n.Id,label:n.Name,value:n.Name,selected:!1}}),$(FR.Tagging.Config.Input,t).autocomplete({source:FR.Tagging.Data.Tags,minLength:2,select:function(n,i){return $("span",t+" "+FR.Tagging.Config.AddedTags).length==0&&$(FR.Tagging.Config.AddedTags,t).empty(),$(FR.Tagging.Config.AddedTags+' span[data-id="'+i.item.id+'"]',t).length==0?($(FR.Tagging.Config.AddedTags,t).append('<span class="customTag" data-id="'+i.item.id+'">'+i.item.value+"</span>"),this.value="",$(FR.Tagging.Config.AutoCompleteTags,t).hide()):(FR.Util.ErrorMsg($("#keywordErrors"),"Tag is already in list"),FR.Tagging.Data.ErrorShowing=!0),!1},search:function(){$(FR.Tagging.Config.AutoCompleteTags,t).show()},appendTo:t+" "+FR.Tagging.Config.AutoCompleteTags})}),$(FR.Tagging.Config.AddButton,t).click(function(){if(FR.Tagging.Config.AllowNew){$("span",t+" "+FR.Tagging.Config.AddedTags).length==0&&$(FR.Tagging.Config.AddedTags,t).empty();var n=$(FR.Tagging.Config.Input,t).val();return n.length>0&&($(FR.Tagging.Config.AddedTags,t).append('<span class="customTag" data-id="0">'+n+"</span>"),$(FR.Tagging.Config.Input,t).val("")),!1}return!1}),$(FR.Tagging.Config.Input,t).keypress(function(n){FR.Tagging.Data.ErrorShowing&&(FR.Util.ErrorMsgRemove($("#keywordErrors")),FR.Tagging.Data.ErrorShowing=!1);var i=n.keyCode?n.keyCode:n.which;if(i==13||i==32||i==44||i==188)return n.preventDefault(),$(FR.Tagging.Config.AddButton,t).trigger("click"),!1}),$(FR.Tagging.Config.SuggestedTags+" .suggestedTag",t).live("click",function(){return $("span",t+" "+FR.Tagging.Config.AddedTags).length==0&&$(FR.Tagging.Config.AddedTags,t).empty(),$(this).siblings(".suggestedTagHidden").first().attr("class","suggestedTag"),$(this).unbind("click").appendTo(t+" "+FR.Tagging.Config.AddedTags),!1}),$(FR.Tagging.Config.AddedTags+" .customTag",t).live("click",function(){return $(this).remove(),!1}),$(FR.Tagging.Config.AddedTags+" .suggestedTag",t).live("click",function(){return $(this).unbind("click").appendTo(t+" "+FR.Tagging.Config.SuggestedTags),$(this).siblings(".suggestedTag").size()>=FR.Tagging.Config.SuggestionCount&&$(this).attr("class","suggestedTagHidden"),!1}),$(FR.Tagging.Config.SaveButton,t).click(function(){var n=$.map($(FR.Tagging.Config.AddedTags+" span",t),function(n){return{Id:$(n).attr("data-id"),Name:$(n).text()}});$(FR.Tagging.Config.JSONString,t).val(JSON.stringify(n))});var i="";$("#tags").click(function(){$("#newTag").focus()}),$("#newTag").keyup(function(n){var r=$("#tags .tag:last");if(n.keyCode=="13"||n.keyCode=="188")n.preventDefault(),txt=$(this).val(),$("#newTag",t).before('<div class="tag">'+txt.split(",")[0]+' <a href="#">x</a></div>'),r=$("#tags .tag:last",t),$(this).val("").focus().width($("#tags").width()-(r.width()+r.position().left)-25),i="",$("#newTagGhost",t).text("");else{if($("#newTagGhost",t).text($(this).val()),r=$("#tags .tag:last",t),r.length>0&&$("#newTagGhost",t).width()+r.position().left+r.width()>$("#tags").width()-35&&($("#newTag",t).width($("#tags",t).width()-25),$("#newTag",t).width()>$("#tags",t).width()/2&&$("#newTag",t).width($("#tags",t).width()/2)),$("#newTagGhost",t).width()>$("#tags",t).width()-40)return $(this).val(i),!1;i=$(this).val()}$("#newTag",t).position().top+$("#newTag",t).height()>$("#tags",t).height()-10&&$("#tags",t).height($("#newTag",t).position().top+$("#newTag",t).height()+20)})}};FR.CascadeSelect={Config:{PrimaryElement:"",SecondaryElement:"",URL:"",PostValueName:"id",SelectText:"Select item"},Setup:function(n,t,i){FR.CascadeSelect.Config.PrimaryElement=n,FR.CascadeSelect.Config.SecondaryElement=t,FR.CascadeSelect.Config.URL=i,$(FR.CascadeSelect.Config.PrimaryElement).change(function(){FR.CascadeSelect.PrimaryChanged()})},PrimaryChanged:function(){var n=$(FR.CascadeSelect.Config.PrimaryElement).val();n==""?($("#"+FR.CascadeSelect.Config.SecondaryElement.attr("id")+" option[value]").remove(),$(FR.CascadeSelect.Config.SecondaryElement).append('<option value="">'+FR.CascadeSelect.Config.SelectText+"</option>"),$(FR.CascadeSelect.Config.SecondaryElement).attr("disabled","disabled")):($(FR.CascadeSelect.Config.SecondaryElement).children().remove(),FR.CascadeSelect.LoadItems(n))},LoadItems:function(n){FR.Data.Post(FR.CascadeSelect.Config.URL,[],{id:n},function(n){if(n.length==0&&Config.SecondaryElement.children('option[value=""]').length==0&&$(FR.CascadeSelect.Config.SecondaryElement).append('<option value="">No more options available</option>'),$(FR.CascadeSelect.Config.SecondaryElement).children('option[value=""]').length==0&&n.length>0){var t=$(FR.CascadeSelect.Config.SecondaryElement).children().first();$(FR.CascadeSelect.Config.SecondaryElement).children().remove(),$(FR.CascadeSelect.Config.SecondaryElement).append('<option value="">'+FR.CascadeSelect.Config.SelectText+"</option>"),$(FR.CascadeSelect.Config.SecondaryElement).append(t)}$.each(n,function(n,t){$(FR.CascadeSelect.Config.SecondaryElement).append('<option value="'+t.Id+'">'+t.Name+"</option>")}),$(FR.CascadeSelect.Config.SecondaryElement).removeAttr("disabled")},function(){})},SelectItem:function(n,t){$(FR.CascadeSelect.Config.PrimaryElement).val(n),$(FR.CascadeSelect.Config.SecondaryElement).val(t)}};FR.Comment={_pollingTimeout:6e4,SetupReplies:function(n){function t(){if($(".commmentSortTabs .reply-tab.selected").hasClass("newest")){var i=FR.UrlHelper.UrlQueryBuilder("/Comment/NewReplies",{timestamp:$("#reply-timestamp").val(),id:n});FR.Data.Get(i,{},function(n){var i=$(n),r;$("#reply-timestamp").remove(),r=$("#replies-list .reply-item"),r.length>0?$("#replies-list .reply-item").last().after(i):$("#replies-list").prepend(i),$(".reply-item",i).length>0&&($("#new-replies-btn").fadeIn(),FR.Track.Event(FR.Track.Params.Comment,"NewRepliesAvailable")),setTimeout(function(){t()},FR.Comment._pollingTimeout)},function(){})}}$(".commmentSortTabs .reply-tab.selected").hasClass("newest")&&setTimeout(function(){t()},FR.Comment._pollingTimeout);$("#comment-list .pager-refresh-target").on("click","#new-replies-btn",function(n){n.preventDefault(),$(".new-hidden-replies").show().removeClass(".new-hidden-replies"),$(this).fadeOut(),FR.Track.Event(FR.Track.Params.Comment,"NewRepliesShown"),FR.Adverts.Refresh(!0)});$(".commmentSortTabs .reply-tab").live("click",function(n){n.preventDefault();var i=this;$(".commmentSortTabs .selected").removeClass("selected"),$("#replies-list .reply-item").removeClass("marker").removeClass("markerBottom"),$(i).addClass("selected"),$(i).hasClass("newest")?(setTimeout(function(){t()},FR.Comment._pollingTimeout),FR.Data.Get($(i).attr("href"),{},function(n){$(".pager-refresh-target").html(n)}),FR.Track.PageWithData(FR.Track.Params.Comment,"SwitchTabNewest")):($("#new-replies-btn").hide(),FR.Data.Get($(i).attr("href"),{},function(n){$(".pager-refresh-target").html(n)}),FR.Track.PageWithData(FR.Track.Params.Comment,"SwitchTabOldest")),FR.Adverts.Refresh(!0)});$("#comment-list").on("click",".showMore.sortNewest",function(n){n.preventDefault();var t=this;$("#comment-list .reply-item").removeClass("markerBottom").last().addClass("markerBottom"),FR.Data.Get($(t).attr("href"),{},function(n){$("#more-replies-url").remove(),$("#comment-list .reply-item").last().after(n),$("#more-replies-url").length>0?$(t).attr("href",$("#more-replies-url").attr("data-href")):$(t).hide()}),FR.Track.PageWithData(FR.Track.Params.Comment,"ShowMoreNewest"),FR.Adverts.Refresh(!0)});$("#comment-list").on("click",".showMore.sortOldest",function(n){n.preventDefault();var t=this;$("#comment-list .reply-item").removeClass("marker").first().addClass("marker"),FR.Data.Get($(t).attr("href"),{},function(n){$("#more-replies-url").remove(),$("#comment-list .reply-item").first().before(n),$("#more-replies-url").length>0?$(t).attr("href",$("#more-replies-url").attr("data-href")):$(t).hide()}),FR.Track.PageWithData(FR.Track.Params.Comment,"ShowMoreOldest"),FR.Adverts.Refresh(!0)});$("#commmentSortTabs .reply-tab-disabled").on("click",function(n){n.preventDefault()})},HidePager:function(){$(".pager").addClass("hidden")},ShowFlaggedMessage:function(n){var t=$(n).closest(".reply-item").removeClass("awaiting").addClass("showReported");$(".reply-hidden",t).hide(),$(".reply-content",t).fadeIn(),FR.Adverts.Refresh(!0),FR.Track.Event(FR.Track.Params.Comment,"ShowFlaggedMessage")},HideFlaggedMessage:function(n){var t=$(n).closest(".reply-item").addClass("awaiting").removeClass("showReported");$(".reply-content",t).fadeOut(),$(".reply-hidden",t).show(),FR.Adverts.Refresh(!0),FR.Track.Event(FR.Track.Params.Comment,"HideFlaggedMessage")},Setup:function(){$(".btnViewReply").live("click",function(n){n.preventDefault(),FR.Comment.ShowFlaggedMessage(this)}),$(".btn-hide-reply").live("click",function(n){n.preventDefault(),FR.Comment.HideFlaggedMessage(this)}),FR.Util.AttachInlineCount($(".Text"),{count:900,expandable:!0}),$(".Text").live("focus",function(){$(this).closest(".commentContainer").removeClass("init")});$("#comment-list").on("click",".commentReply",function(){var n=$(this).closest(".nonpending-reply").parent(),t=n.find(".Text"),r=n.find(".replyImage").parent(),i;return t.val().length>3&&!t.is(".exceed")?(n.find(".commentsContainer").append('<div class="item adddedComment"><a href="#">'+r.html()+'</a><div class="info"><p class="commentBody">'+t.val()+"</p></div></div>"),n.find(".commentReply").parent().addClass("init"),t.removeAttr("style"),i=$(this).closest("form").serialize(),t.val(""),removeCount=n.find(".chars-left"),removeCount.siblings("div.clear").remove(),removeCount.remove(),FR.Util.AttachInlineCount(n.find(".Text"),{count:900,expandable:!0}),$.post(FR.UrlHelper.Urls.Comment.Comment,i,function(t){var r=$(".reply-tab.newest"),i=$(".reply-tab.oldest");i.hasClass("selected")&&i.removeClass("selected"),r.addClass("selected"),setTimeout(function(){getLatestReplies()},FR.Comment._pollingTimeout),FR.Data.Get($(r).attr("href"),{},function(n){$(".pager-refresh-target").html(n)}),n.find(".adddedComment").remove(),n.find(".commentsContainer").append(t),FR.Comment.AddingComments(n),$(document).trigger("fr.comment.AddingComments"),FR.Adverts.Refresh(!0),FR.Track.Page("NewComment")})):(t.addClass("exceed"),t.val().length<4&&n.find(".chars-left").addClass("exceed").text("Please enter at least 4 characters for your comment")),!1});$(".commentBody").each(function(){$(this).height()>500&&$(this).addClass("truncateComment").append('<div class="fadeOut"></div>').after('<div class="showAllComment"><a href="#" class="showAllCommentLink">See more</a></div>')}),$(".showAllCommentLink").click(function(){return $(this).parent().hide().siblings(".truncateComment").removeClass("truncateComment"),!1});$("#comment-list").on("click",".delete-comment",function(){var t=$(".viewAllComments",$(this).closest("#commentContainer").parent()),i=$(this).attr("data-id"),n=$(this).closest(".item");return $.InlineConfirm(this,n,{message:"Are you sure you want to delete this comment?",confirmButtonText:"Delete",cancelButtonText:"Cancel",callback:function(){FR.Data.Post(FR.UrlHelper.Urls.Comment.Delete,[],{commentId:i},function(i){i.IsSuccess&&(n.remove(),FR.Comment.DeleteComments(t))})}}),!1})},AddingComments:function(n){var r=$("#commentTotalCount").text(),t,i;n&&(r=n.find("#commentTotalCount").text()),t=parseInt(r)+1,isNaN(t)?($("#initialHeading").text(""),$("#initialHeading").append('<span id="commentTotalCount">1</span> comment')):($("#initialHeading").text(""),$("#initialHeading").append('<span id="commentTotalCount">'+t+"</span> comments")),i=parseInt($("#commentListCount").text())+1,$("#commentListCount").text(i),$("#commentCountDisplay").text(FR.Comment.CommentsCount(i)),i>0&&$("#totalCommentId").show(),n&&(isNaN(t)||n.find("#commentTotalCount").text(t))},DeleteComments:function(n){var r=$("#commentTotalCount").text(),t,u,i;n&&n.length>0&&(r=n.find("#commentTotalCount").text()),t=parseInt(r)-1,t<=0?($("#initialHeading").text(""),$("#initialHeading").append("What do you think about this?")):(u=FR.Comment.CommentsCount(t),$("#initialHeading").text(""),$("#initialHeading").append('<span id="commentTotalCount">'+t+"</span>"+u)),i=parseInt($("#commentListCount").text())-1,$("#commentListCount").text(i),$("#commentCountDisplay").text(FR.Comment.CommentsCount(i)),i<=0&&$("#totalCommentId").hide(),n&&(isNaN(t)||n.find("#commentTotalCount").text(t))},CommentsCount:function(n){return n==1?" comment":" comments"}};FR.ProfileEdit={Data:{},Setup:function(){var n=$("#errorPanel"),t=$("#profile-submit").validate({errorContainer:n,errorLabelContainer:$("ul",n),wrapper:"li",rules:{FirstName:{required:!0,minlength:2,maxlength:20,alphanumeric:!0},LastName:{required:!0,minlength:2,maxlength:20,alphanumeric:!0}}});$("#edit-button").on("click",function(n){n.preventDefault();var t=$(this);t.attr("data-fname")!=$("#FirstName").val()||t.attr("data-lname")!=$("#LastName").val()||t.attr("data-mname")!=$("#MaidenName").val()?$("#edit-profile-Dialog").FRdialogue({width:500,cancelCls:"cancel",originEl:$(this)}):$("#profile-submit").submit()});$("#confirm").on("click",function(n){n.preventDefault(),$("#profile-submit").submit()});$("#edit-button").on("click",function(){var n=$("#CarModel").val();if(n<1)if($("#CarMake").val()==0)n=0;else return!1});$("#savePhoto").click(function(){FR.Util.HideEl("#photoChanger");var t=$("#filedata").val(),n=t.substring(t.lastIndexOf(".")+1).toLowerCase();return n=="gif"||n=="jpg"||n=="png"?$("#photoChanger").submit():(FR.Util.ErrorMsg("#changeLabel","Please select a jpg, gif or png file"),FR.Util.ShowEl("#photoChanger")),!1})}};FR.BlockedMembers={Setup:function(){$(".unBlockShow").click(function(){return $(this).parent().next(".unBlockConfirm").fadeIn(),$(this).parent().hide(),!1}),$(".unBlockCancelButton").click(function(){return $(this).parent().prev(".unblock").show(),$(this).parent().hide(),!1}),$(".unBlockConfirmButton").click(function(){var n=$(this).attr("id");return FR.Data.Post("/Relationship/Unblock",[],{memberId:n},function(){}),$(this).closest("li").fadeOut(),!1})}};FR.CreateBox={Setup:function(n){FR.CreateBox.SetupBoxTypes(n),FR.CreateBox.SetupButtons(),FR.CreateBox.SetupHiddenArea(),FR.CreateBox.SetupPrivacy()},Data:{BoxTypes:{}},SetupUnLinking:function(){$(".delete-linked-box").on("click",function(n){n.preventDefault();var i="Are you sure you want to remove the link to this box?",t=$(this).parent();$.InlineConfirm(this,t,{message:i,confirmButtonText:"Delete",cancelButtonText:"Cancel",offsetLeft:350,callback:function(){FR.Data.Post(FR.UrlHelper.Urls.Box.RemoveLink,[],{boxId:$("#Id").val(),linkedBoxId:$('input[name="UnlinkBoxes"]',t).val()},function(n){if(n.successful){t.fadeOut();var i=t.parentsUntil("tr").parent();t.remove(),$(".delete-linked-box").length==0&&i.remove()}})}})})},SetupButtons:function(){FR.Util.AttachInlineCount($("#moreBoxDetails #Description"),{count:500});$("#add-category").on("click",function(n){n.preventDefault(),FR.CreateBox.AddCategoryRow(0,0)});$("#delete-button").click(function(){var n=$("#hidden-delete").val(),i="Are you sure you want to "+n+" this box?",t=$("#Id").val();return $.InlineConfirm(this,$("#column1"),{message:i,confirmButtonText:n,cancelButtonText:"Cancel",offsetLeft:350,callback:function(){window.location.href=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.Box.Delete,[t])}}),!1}),$("#create-button").click(function(){var n=[];n=$.map($("#addedTags span"),function(n){return{Id:$(n).attr("data-id"),Name:$(n).text()}}),$("#KeywordJsonString").val(JSON.stringify(n)),$("#create-form").valid()||$("#errorPanelWrapper").show()}),$("#edit-button").click(function(){var t=[],n;if(t=$.map($("#addedTags span"),function(n){return{Id:$(n).attr("data-id"),Name:$(n).text()}}),$("#KeywordJsonString").val(JSON.stringify(t)),$("#MemberNonOwnerCount").val()>0&$('#privacySet .publicPrivateBox input[value="Private"][checked="checked"]').length==1)return n="Are you sure you want to make this box private? "+$("#boxMemberCountString").text()+" will be removed from the box.",$.InlineConfirm(this,$("#column1"),{message:n,confirmButtonText:"Proceed",cancelButtonText:"Cancel",offsetLeft:350,callback:function(){$("#create-form").submit()}}),!1;$("#create-form").valid()||$("#errorPanelWrapper").show()})},SetupBoxTypes:function(){$("#BoxType").change(function(){FR.CreateBox.BoxTypeChanged(this)}),$("#CategoryId").change(function(){FR.CreateBox.CategoryChanged($("#BoxType").val(),$(this).val())})},LoadBoxTypeRow:function(n,t){FR.CreateBox.GetBoxTypesList($("#BoxType"),n),t!=0&&FR.CreateBox.GetCategoryList($("#CategoryId"),n,t)},GetSelectedCategoryList:function(){var n=[];return $('select[name="categoryIds"]').each(function(){$(this).val()!=null&&n.push($(this).val())}),n},GetSelectedBoxTypeList:function(){var n=[];return $('select[name="boxTypeIds"]').each(function(){$(this).val()!=null&&n.push($(this).val())}),n},GetBoxTypesList:function(n,t){$.each(FR.CreateBox.Data.BoxTypes,function(t,i){n.append('<option value="'+i.Value+'">'+i.Text+"</option>")}),t!=0&&n.val(t),n.change(function(){FR.CreateBox.CategoryChanged(this)})},GetCategoryList:function(n,t,i){FR.Data.Post(FR.UrlHelper.Urls.Box.GetCategories,[],{boxType:t},function(t){n.children().remove(),t.length==0&&n.append('<option value="">No options available</option>'),t.length>1&&n.append('<option value="">Select Category</option>'),$.each(t,function(t,i){n.append('<option value="'+i.Value+'">'+i.Text+"</option>")}),i!=0&&n.val(i),n.removeAttr("disabled")},function(){})},BoxTypeChanged:function(n){var t=$(n).val();FR.CreateBox.GetCategoryList($("#CategoryId"),t,0)},CategoryChanged:function(n,t){var i=$("#suggestedTags");t!=null&&t!=""?(i.show(),FR.Util.HideEl(i),$.get(FR.UrlHelper.Urls.Tags.GetByCategory,{categoryId:t},function(n){i.empty();var t="<p>Suggested: ";$.each(n,function(n,i){$('#addedTags span[data-id="'+i.Id+'"]').length==0&&(t=n<6?t+'<span class="suggestedTag" data-id="'+i.Id+'">'+i.Name+"</span>":t+'<span class="suggestedTagHidden" data-id="'+i.Id+'">'+i.Name+"</span>")}),i.append(t),$("#suggestedTags span").length==0&&$("#suggestedTags p").html("No more suggestions available"),FR.Util.ShowEl(i)})):i.empty()},SetupPrivacy:function(){$("#CannotChangePrivacy").val()!="True"&&$("#privacySet .field").click(function(){$("#privacySet .field").removeClass("on"),$(this).addClass("on"),$(".publicPrivateBox input").attr("checked",!1),$(".publicPrivateBox input",this).attr("checked",!0)})},SetupHiddenArea:function(){$("#showMore").click(function(){return FR.CreateBox.ShowHiddenArea(),!1})},ShowHiddenArea:function(){$("#showMore").hide(),$("#moreBoxDetails").slideDown();var n=$("#tags .tag:last");n.length>0?(alert("1"),$("#newTag").width($("#tags").width()-(n.width()+n.position().left)-20)):$("#newTag").width($("#tags").width()-20),$("#newTag").width()>$("#tags").width()/2&&$("#newTag").width($("#tags").width()/2)}};FR.Friends={Setup:function(){$(".unfriendShow").click(function(){return $(this).parent().next(".unfriendConfirm").fadeIn(),$(this).parent().hide(),!1}),$(".unfriendCancelButton").click(function(){return $(this).parent().prev(".unfriend").show(),$(this).parent().hide(),!1}),$(".unfriendConfirmButton").click(function(){var n=$(this).attr("id");return FR.Data.Post(FR.UrlHelper.Urls.Relationship.RemoveFriend,[],{friendshipId:n},function(){FR.Adverts.Refresh(!0),FR.Track.Page("Unfriend")}),$(this).closest("li").fadeOut(),!1});$(document).on("fr.pager.page",function(){FR.Adverts.Refresh(!0)})}};FR.UrlHelper={UrlBuilder:function(n,t){return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:"{"+i+"}"})},UrlQueryBuilder:function(n,t){var i=$.param(t);return n=n.indexOf("?")===-1?n+"?"+i:n+i}},FR.UrlHelper.Urls={AssetPager:{Load:"/Pager/PagerLoad",PagerGet:"/Pager/PagerGet",Get:"/Pager/JsonMedia",Breadcrumb:"/UI/Breadcrumb"},Box:{Delete:"/Box/Delete/{0}",GetBoxTypes:"/Box/BoxTypes",GetCategories:"/Box/Categories",GetMemoryList:"/Box/GetMemoryList",Edit:"/Box/Edit/{0}",RemoveLink:"/Box/RemoveLink",RememberWhen:"/UI/RememberWhen",View:"/Box/View/{0}",Upload:"/Media/BoxUpload/{0}",PeopleList:"/Box/PeopleList",Interstitial:"/Box/InterstitialBoxes",ActivityModule:"/Box/ActivityFeed"},Errors:{Generic:"/Help"},Gallery:{List:"/Pager/GalleryJsonList",Meta:"/Pager/GalleryJsonMedia",Comments:"/Media/Index",Reply:"/Comment/CommentReply",Share:"/UI/Share"},Invite:{Invite:"/Invite/Invite/{0}?returnUrl={1}",InviteMember:"/Invite/InviteMember/{0}?encodedId={1}",InviteMemberSave:"/Invite/InviteMemberSave",Accept:"/Invite/Accept"},Keepsafe:{Add:"/Keepsafe/Add",Upload:"/Media/KeepsafeUpload",Remove:"/Keepsafe/Remove",RemoveAllTakedown:"/Keepsafe/RemoveAllTakedown",RemoveOneTakedown:"/Keepsafe/RemoveOneTakedown",BannerToggle:"/Keepsafe/BannerToggle"},Media:{RotateRight:"/Media/RotateRight",Rotate:"/Media/Rotate/{0}"},Memory:{Delete:"/Box/DeleteMemory/{0}",Promote:"/Box/PromoteMemory/{0}"},Newsfeed:{Viewed:"/Newsfeed/Viewed",ReactionsModule:"/Newsfeed/ReactionsModule",ContactsModule:"/Newsfeed/ContactsActivityModule",ActivityModule:"/Newsfeed/MyActivityModule"},Personalise:{Welcome:"/Personalise/Welcome",Autocomplete:"/Personalise/Autocomplete",LocationResult:"/Personalise/LocationResult",Interests:"/Personalise/Interests",InterestsSave:"/Personalise/InterestsSave",Recommendations:"/Personalise/Recommendations",InterestsRecommendations:"/Personalise/InterestsRecommendations",Confirm:"/Personalise/Confirm",Success:"/Personalise/Success"},Tags:{GetByCategory:"/Tag/ListByCategory",GetAll:"/Tag/List"},Tour:{Complete:"/UI/TourComplete"},Sharing:{Email:"/Sharing/Email",Friends:"/Sharing/Friends"},Relationship:{AddFriend:"/Relationship/Add",RemoveFriend:"/Relationship/Remove",RemoveFriendByMemberId:"/Relationship/RemoveByMemberId",UnblockMember:"/Relationship/Unblock",BlockMember:"/Relationship/Block"},Comment:{Delete:"/Comment/DeleteComment",Reply:"/Comment/CommentReply",OtherBoxes:"/Comment/CommentsOtherBoxes",Comment:"/Comment/Comment"},PhotoTag:{RequestTagsUrl:"/PhotoTag/GetPhotoTags/{0}",DeleteTagsUrl:"/PhotoTag/RemovePhotoTag",AddTagUrl:"/PhotoTag/SavePhotoTag",AutocompleteUrl:"/PhotoTag/GetFriendsList"},Discussion:{MoreReplies:"/Discussion/MoreReplies"},Popularity:{Agree:"/Popularity/Agree",AgreeList:"/Popularity/AgreeList",Disagree:"/Popularity/Disagree"},UploadAutoComplete:"/UI/Autocomplete",UploadKeepsafe:"/Media/Upload",UploadBox:"/Media/Upload/{0}",UploadDelete:"/Media/UploadDelete/",AddStartEndYearInfo:"/Member/AddStartEndYearInfo",AddBoxMember:"/Member/AddBoxMember",RemoveMember:"/Member/RemoveBoxMember",RemoveGroupMember:"/Member/RemoveGroupMember",MemberOpenGraph:"/Member/OpenGraphSettings",UnlinkFacebook:"/Account/UnlinkFacebook",OpenGraphEnable:"/Account/OpenGraphEnable?enable={0}",OpenGraphRegister:"/Account/OpenGraphRegister",UnBlockMember:"/Relationship/Unblock",UnregisterMember:"/Account/Unregister",GetMemoryListMember:"/Member/GetMemoryList",JoinBoxRequest:"/JoinRequest/Create",MediaDelete:"/Media/Delete",MediaEdit:"/Media/Edit",MediaKeep:"/Media/KeepMedia",RemoveMediaFromBox:"/Media/RemoveResourceFromBox",SetDefaultImage:"/Media/SetDefaultImage",MailDelete:"/Mail/Delete",MailSaveToDraft:"/Mail/Save",SearchBoxList:"/Search/GetFullBoxList",SearchAssetList:"/Search/GetFullAssetList",SearchMemberList:"/Search/GetFullMemberList",SearchLocation:"/Search/Location",EditTopic:"/Discussion/Save/{0}",DeleteTopic:"/Discussion/DeleteDiscussion/{0}",LoadEditTopic:"/Discussion/EditDiscussion/{0}",LoadEditReply:"/Discussion/EditReply/{0}",EditReply:"/Discussion/SaveReply/{0}",DeleteReply:"/Discussion/DeleteDiscussionReply/{0}",TopicSearch:"/Discussion/DiscussionList/{0}",PeopleSearch:"/Box/PeopleList/{0}",PollVote:"/Poll/Vote",LoadMessage:"/Mail/Message/{0}?mailFolder={1}",Report:"/UI/ReportAbuse",ReportForm:"/UI/ReportForm",Share:"/UI/Share/{0}",GetGroupPeople:"/Group/GetPeople/",GetGroupMemories:"/Group/GetMemories",HomeFaqs:"/Help/GetFaqs",Validation:"/Account/Validation",NextSplashImage:"/Home/GetNextSplashImage",SchoolFinderAutocomplete:"/SchoolFinder/Autocomplete",CookieAccept:"/UI/AcceptCookieBar"};FR.Constants={HomeTownsVal:6,SortOrderNewVal:"New",SortOrderPopularVal:"Popular"};FR.Splash={EditorialSetup:function(n){var r,i,t;$("#splash-pane-titles li").on("click",function(){$("#splash-pane-titles li.active").removeClass("active"),$(this).addClass("active")});for(r=$("#splash-pane-titles ul li").length,i=$(".item.active"),t=1;t<r;t++)$(i).after('<div class="item" data-order="'+t+'"></div>'),i=$("[data-order='"+t+"']"),i.load("/Splash/Articles?showUnpublished="+encodeURIComponent(n)+"&displayOrder="+t);$("#splash-carousel").carousel({interval:1e4}).on("slid",function(){var n=parseInt($("#splash-carousel .active").attr("data-order"),10);$("#splash-pane-titles li").removeClass("active"),$("#splash-pane-titles li[data-slide-to="+n+"]").addClass("active")})},Setup:function(){$("#signinDisplayBtn").on("click",function(){return $(this).hide(),$("#loginFormWrapper").slideDown(),$("#splashSignUpForm").slideUp(),$("#splashSignupDisplayBtn").show(),!1});$("#splashSignupDisplayBtn").on("click",function(){return $(this).hide(),$("#loginFormWrapper").slideUp(),$("#splashSignUpForm").slideDown(),$("#signinDisplayBtn").show(),!1});FR.Util.GetQueryStringValue("loggingIn").toString().toLowerCase()=="false"&&$("#splashSignupDisplayBtn").click()},ConfigureSlide:function(n,t,i){function o(n){$("#splashDate span").each(function(t){$(this).animate({top:"-"+parseInt(n.charAt(t))*37+"px"})})}function u(){var t=$("#slide1 img").width(),i=$(window).width(),n;t>i?(n=(i-t)/2,n<-170&&(n=-170),$("#slide1, #slide2").css("marginLeft",n+"px")):$("#slide1, #slide2").css("marginLeft","0")}function e(){setTimeout(function(){o(r.Date),$("#remember-link").attr("data-id",r.SplashId),h++,f?($("#slide1").fadeOut(function(){$("#slide1 img").attr("src",r.ImageUrl)}),f=0):($("#slide1").css("visibility","hidden").show(),u(),$("#slide1").css("visibility","visible").hide().fadeIn(function(){u(),$("#slide2 img").attr("src",r.ImageUrl)}),f=1),FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.NextSplashImage,{order:r.Order}),{dataType:"json"},function(n){n&&(r.ImageUrl=n.ImageUrl,r.Date=n.Date,r.Order=n.Order,r.SplashId=n.SplashId),e()},function(){})},5e3)}var s=$("#splashDate").text();$("#splashDate").html("<span>0123456789</span><span>0123456789</span><span>0123456789</span><span>0123456789</span>"),$("#splashDate span").each(function(n){$(this).css("top","-"+s.charAt(n)*37+"px")}),$(window).resize(function(){u()}),u();var f=0,h=1,r={Date:n,ImageUrl:t,Order:0,SplashId:i};e()},FBButtonSetup:function(n,t,i){if(n.status==="connected"){$("#fb-signin-link").on("click",function(){return FR.Splash.FBLoginClick(this,i,n),FR.Track.Event(FR.Track.Params.FBLogin,"loginBtn_login"),!1});$("#fb-register-link").on("click",function(){return FR.Splash.FBLoginClick(this,i,n),FR.Track.Event(FR.Track.Params.FBLogin,"regBtn_login"),!1})}else{$("#fb-signin-link").on("click",function(){return FR.Splash.FBRegisterClick(this,t),FR.Track.Event(FR.Track.Params.FBLogin,"loginBtn_register"),!1});$("#fb-register-link").on("click",function(){return FR.Splash.FBRegisterClick(this,t),FR.Track.Event(FR.Track.Params.FBLogin,"regBtn_register"),!1})}$(".fb-button").removeClass("loading"),$("#fb-signin-link, #fb-register-link").show()},FBLoginClick:function(n,t,i,r){var f=$(n),u;f.off("click"),f.html("Please wait..."),u={FacebookId:i.authResponse.userID,SignedRequest:i.authResponse.signedRequest,AccessToken:i.authResponse.accessToken,AutoLogin:r,ReturnUrl:$("#ReturnUrl").val()},FR.Data.Post(t,{dataType:"json"},u,function(n){n.isSuccess?window.location.href=n.redirectToUrl:n.redirectToUrl.length>0?window.location.href=n.redirectToUrl:alert("Sorry, there was an error logging in with Facebook for this account.")})},FBRegisterClick:function(n,t){var i=$(n);i.html("Please wait..."),FB.login(function(n){n.authResponse&&n.status==="connected"&&(FR.Util.HideEl("#splashPage"),FB.api("/me",function(i){if(i.error)alert("Sorry, Facebook login is currently unavailable. Please try again later."),FR.Util.ShowEl("#splashPage"),FR.Track.EventWithData(FR.Track.Params.FBLogin,"error",{code:i.error.code,error_subcode:i.error.error_subcode,type:i.error.type});else{var r={FacebookId:i.id,SignedRequest:n.authResponse.signedRequest,AccessToken:n.authResponse.accessToken,Username:i.username,Forename:i.first_name,Surname:i.last_name,Email:i.email,Gender:i.gender,LocationId:i.location?i.location.id:"",LocationText:i.location?i.location.name:"",HometownId:i.hometown?i.hometown.id:"",HometownText:i.hometown?i.hometown.name:"",Locale:i.locale,Birthday:i.birthday};$.post(t,r,function(n){window.location.href=n.redirectToUrl})}}))},{scope:"email,user_birthday,user_hometown,user_location"})}};(function(n){n.FRdialogueClose=function(t){n(".FRdialogue a.close").off("click").on("click",function(){var i=n(".FRdialogue");n(".advert iframe").css("visibility","visible"),i.removeAttr("style"),n("#FRdialogueMarker").after(i),n("#FRdialogueMarker, #FRdialogueContainer, #FRdialogueBg").remove(),t()})},n.fn.FRdialogue=function(t){function l(){n(".advert iframe").css("visibility","visible"),n("body").removeClass("FRdialogueOpen"),i.removeAttr("style"),n("#FRdialogueMarker").after(i),n("#FRdialogueMarker, #FRdialogueContainer, #FRdialogueBg").remove()}function e(){i.outerHeight()>n(window).height()&&r?(r=!1,f=n("html").scrollTop(),n("html").css({position:"relative",top:-f+"px"}),n("html").addClass("FRdisableScroll"),n("#FRdialogueContainer").css("overflow","auto"),i.css({top:0})):i.outerHeight()>n(window).height()&&!r?n("#FRdialogueContainer").css("overflow","auto"):i.outerHeight()<=n(window).height()&&!r?(n("html").removeClass("FRdisableScroll"),i.css({top:-(i.outerHeight()/2+20)+"px"}),n("html").css({position:"static",top:0}),n("html").scrollTop(f),n("#FRdialogueContainer").css("overflow","hidden"),r=!0):i.outerHeight()<=n(window).height()&&r&&(i.css({top:-(i.outerHeight()/2+20)+"px"}),n("#FRdialogueContainer").css("overflow","hidden"))}var i=n(this),r,f,c;if(t=="reposition")return e(),!1;if(t=n.extend({width:"auto",block:!0,cancelCls:"close",originEl:!1,cbFunction:!1,reposition:!1},t),n(".close",n(this)).length||i.prepend('<a href="#" class="close" title="Cancel">X</a>'),t.width!="auto"&&i.css("width",t.width),i.addClass("FRdialogue"),i.before('<div id="FRdialogueMarker"></div>'),r=!0,f=n("html").scrollTop(),n("body").prepend('<div id="FRdialogueBg"></div>'),n("#FRdialogueBg").after(i),i.wrap('<div id="FRdialogueContainer"></div>').wrap('<div id="FRdialogueAnchor"></div>'),t.originEl&&i.addClass("invisible"),c=i.outerHeight(),n("body").is(".mobile")?(i.show(),n("body").addClass("FRdialogueOpen")):(i.show().css({left:-(i.width()/2)+"px",top:-(i.outerHeight()/2)+"px"}),e(),n(window).resize(function(){e()})),n(".advert iframe").css("visibility","hidden"),t.originEl){var u=n("#FRdialogueContainer").offset(),o=t.originEl.offset(),a=t.originEl.outerWidth(),v=t.originEl.outerHeight(),s=i.offset(),y=i.outerWidth(),h=i.outerHeight();n("#FRdialogueContainer").append('<div id="FRdialogueAnimation"></div>'),t.originEl.attr("src")&&n("#FRdialogueAnimation").append('<img src="'+t.originEl.attr("src")+'"/>'),n("#FRdialogueAnimation").width(a).height(v),n("#FRdialogueAnimation").css({top:o.top-u.top+"px",left:o.left-u.left+"px"}),n("#FRdialogueAnimation").animate({top:s.top-u.top+"px",left:s.left-u.left+"px",width:y+"px",height:h+"px"},250,function(){i.removeClass("invisible"),setTimeout(function(){n.isFunction(t.cbFunction)&&t.cbFunction.call()},2e3),n(this).remove()})}else n.isFunction(t.cbFunction)&&t.cbFunction.call();n(".close, .cancel, ."+t.cancelCls,i,"#FRdialogueContainer").click(function(){return l(),!1})}})(jQuery);(function(n){function l(){n("li.pager-item a."+e,i).click(function(){var t=parseInt(n(this).attr("data-id"),10);return o(t),!1}).removeClass(e),n(".next."+e,i).click(function(){return r!=t.pageCount&&(r=r+1,o(r)),!1}).removeClass(e),t.pageCount>t.pagerSize&&(n("a[data-id="+t.pagerSize+"]",i).parent().hide(),n("a[data-id="+(t.pagerSize-1)+"]",i).parent().hide(),n(".last-item").show(),u=!0),t.pageCount<2&&n(".next",i).addClass("disabled"),n(".pager-wrapper",i).show()}function o(i){FR.Util.HideEl(t.pagedElement),t.data.skip=(i-1)*t.recordsPerPage,t.data.take=t.recordsPerPage,t.data.orderBy=t.orderBy,n("html, body").animate({scrollTop:n(t.scrollTarget).offset().top-30},1e3),FR.Data.Post(t.url,{dataType:"html"},t.data,function(u){r=i,c(i),FR.Util.ShowEl(t.pagedElement),FR.Track.Page("GenericPager"),n(document).trigger("fr.pager.page",[]),typeof t.callback=="function"&&t.callback(u)})}function c(e){var h=e-1,s=h+t.pagerSize-1,c=t.pageCount>t.pagerSize,o;e>=4&&c?(n(".first-spacer").show(),f=!0,s=s-2):(n(".first-spacer").hide(),f=!1),s<t.pageCount&&c?(n(".last-spacer").show(),u=!0,s=s-2):(n(".last-spacer").hide(),u=!1,s=t.pageCount),c?(u&&!f&&(h=1,s=t.pagerSize-2),f&&!u&&(h=t.pageCount-t.pagerSize+3)):(h=1,s=t.pageCount),e==t.pageCount?n(".next",i).addClass("disabled"):n(".next",i).removeClass("disabled"),o=h,n("li.pager-item",i).each(function(i,e){var c=n("a",e);n(c).removeClass("selected"),o==1?(r==o&&n(c).addClass("selected"),o=o+1):n(e).hasClass("last-item")||n(e).hasClass("first-item")?r>=t.pageCount&&o>=t.pageCount&&n(c).addClass("selected"):o>=h&&o<=s?(f&&!u&&o>=s||(n(e).show(),n(c).attr("data-id",o),n(c).html(o),o===r&&n(c).addClass("selected")),o=o+1):n(e).hide()})}var s="FRPager",e="static",t,r,f=!1,u=!1,i,h=n.fn[s]=n[s]=function(u){return t=n.extend({recordsPerPage:10,pageCount:1,orderBy:"default",pagerSize:7,scrollTarget:n(this),data:{}},u),i=n(this),r=1,l(),i};h.ChangeOrderBy=function(n,i){t.orderBy=n,i&&o(1)}})(jQuery);BocaGrande.Pager={initCls:"static",settings:{},showingFirst:!1,showingLast:!1,startPage:1,element:{},Setup:function(n){try{if(BocaGrande.Pager.settings=$.extend({page:1,take:10,pageCount:1,sort:"default",size:7,scrollTarget:$(document),el:document},n),BocaGrande.Pager.Data=BocaGrande.Pager.settings.data,BocaGrande.Pager.element=$(BocaGrande.Pager.settings.el),BocaGrande.Pager.Data.page=BocaGrande.Pager.settings.page,BocaGrande.Pager.initialUrl==null&&(BocaGrande.Pager.initialUrl=BocaGrande.Pager.settings.url),$("li.pager-item a."+BocaGrande.Pager.initCls,BocaGrande.Pager.element).on("click",function(n){n.preventDefault(),BocaGrande.Pager.Data.page=parseInt($(this).attr("data-id"),10),History.enabled?History.pushState(BocaGrande.Pager.Data,document.title,$(this).attr("href")):BocaGrande.Pager.SetPage(BocaGrande.Pager.Data.page,$(this).attr("href"),!0,BocaGrande.Pager.settings.callback)}).removeClass(BocaGrande.Pager.initCls),$(".next."+BocaGrande.Pager.initCls,BocaGrande.Pager.element).on("click",function(n){n.preventDefault(),BocaGrande.Pager.Data.page!=BocaGrande.Pager.settings.pageCount&&(BocaGrande.Pager.Data.page=BocaGrande.Pager.Data.page+1,History.enabled?History.pushState(BocaGrande.Pager.Data,document.title,$("a[data-id="+BocaGrande.Pager.Data.page+"]",BocaGrande.Pager.element).attr("href")):BocaGrande.Pager.SetPage(BocaGrande.Pager.Data.page,$("a[data-id="+BocaGrande.Pager.Data.page+"]",BocaGrande.Pager.element).attr("href"),!0,BocaGrande.Pager.settings.callback))}).removeClass(BocaGrande.Pager.initCls),BocaGrande.Pager.settings.pageCount>BocaGrande.Pager.settings.size&&($("a[data-id="+BocaGrande.Pager.settings.size+"]",BocaGrande.Pager.element).parent().hide(),$("a[data-id="+(BocaGrande.Pager.settings.size-1)+"]",BocaGrande.Pager.element).parent().hide(),$(".last-item").show(),showingLast=!0),BocaGrande.Pager.settings.pageCount<2&&$(".next",BocaGrande.Pager.element).addClass("disabled"),BocaGrande.Pager.Data.page>1&&(BocaGrande.Pager.startPage=BocaGrande.Pager.Data.page,BocaGrande.Pager.Redraw(BocaGrande.Pager.Data.page)),$(document).trigger("bocagrande.pager.load",[BocaGrande.Pager.Data]),$(".pager-wrapper",BocaGrande.Pager.element).show(),History.enabled)$(window).on("statechange",function(){var t=History.getState(),n;t.data!=null&&t.data.page!=null?t.data.filterEvent?BocaGrande.Pager.ReloadPager(t.url):BocaGrande.Pager.SetPage(t.data.page,t.url,!0,BocaGrande.Pager.settings.callback):(n=BocaGrande.Pager.initialUrl,n=n.indexOf("?")===-1?n+"?pager=true":n+"&pager=true",BocaGrande.Pager.ReloadPager(n))})}catch(t){FR.Track.EventWithData(FR.Track.Params.Error,"bocagrand-pager",{fr_error:t.message})}},SetFilter:function(n){var i,t;BocaGrande.Pager.Data=$.extend(BocaGrande.Pager.Data,n),i=BocaGrande.Pager.settings.refreshUrl+"&"+$.param(BocaGrande.Pager.Data),History.enabled?(t=BocaGrande.Pager.Data,t.filterEvent=!0,t.page=1,BocaGrande.Pager.Data.page=1,History.pushState(t,document.title,i)):BocaGrande.Pager.ReloadPager(i)},ReloadPager:function(n){$(window).off("statechange"),FR.Util.HideEl(BocaGrande.Pager.settings.pagedElement),FR.Data.Get(n,{dataType:"html"},function(n){$(".pager-refresh-target").html(n),$("#gridView").css("visibility","visible"),$("#gridLoading").hide(),FR.Util.ShowEl(BocaGrande.Pager.settings.pagedElement),FR.Track.Page("BocaGrandeFiltersPager")})},SetPage:function(n,t,i,r){FR.Util.HideEl(BocaGrande.Pager.settings.pagedElement),i,FR.Data.Get(t,{dataType:"html"},function(t){BocaGrande.Pager.Data.page=n,BocaGrande.Pager.Redraw(n),FR.Util.ShowEl(BocaGrande.Pager.settings.pagedElement),typeof r=="function"&&r(t),$(document).trigger("bocagrande.pager.page",[]),FR.Track.Page("BocaGrandeGenericPager")})},Redraw:function(n){var r=n-1,i=r+BocaGrande.Pager.settings.size-1,u=BocaGrande.Pager.settings.pageCount>BocaGrande.Pager.settings.size,t;n>=4&&u?($(".first-spacer").show(),BocaGrande.Pager.showingFirst=!0,i=i-2):($(".first-spacer").hide(),BocaGrande.Pager.showingFirst=!1),i<BocaGrande.Pager.settings.pageCount&&u?($(".last-spacer").show(),BocaGrande.Pager.showingLast=!0,i=i-2):($(".last-spacer").hide(),BocaGrande.Pager.showingLast=!1,i=BocaGrande.Pager.settings.pageCount),u?(BocaGrande.Pager.showingLast&&!BocaGrande.Pager.showingFirst&&(r=1,i=BocaGrande.Pager.settings.size-2),BocaGrande.Pager.showingFirst&&!BocaGrande.Pager.showingLast&&(r=BocaGrande.Pager.settings.pageCount-BocaGrande.Pager.settings.size+3)):(r=1,i=BocaGrande.Pager.settings.pageCount),n==BocaGrande.Pager.settings.pageCount?$(".next",BocaGrande.Pager.element).addClass("disabled"):$(".next",BocaGrande.Pager.element).removeClass("disabled"),t=r,$("li.pager-item",BocaGrande.Pager.element).each(function(n,u){var f=$("a",u),e;$(f).removeClass("selected"),t==1?(BocaGrande.Pager.Data.page==t&&$(f).addClass("selected"),t=t+1):$(u).hasClass("last-item")||$(u).hasClass("first-item")?BocaGrande.Pager.Data.page>=BocaGrande.Pager.settings.pageCount&&t>=BocaGrande.Pager.settings.pageCount&&$(f).addClass("selected"):t>=r&&t<=i?(BocaGrande.Pager.showingFirst&&!BocaGrande.Pager.showingLast&&t>=i||($(u).show(),$(f).attr("data-id",t),e=BocaGrande.Pager.settings.url+"&page="+t,$(f).attr("href",e),$(f).html(t),t===BocaGrande.Pager.Data.page&&$(f).addClass("selected")),t=t+1):$(u).hide()})}},BocaGrande.Pager.Data={page:0};FR.AssetPager={Config:{},Setup:function(n){var t,r,i;FR.AssetPager.Config=$.extend({IsAuthenticated:!1,MediaSelectorEl:"#asset-display-container",CurrentKey:0,CurrentType:0,CurrentLegacy:!1,MemberProfileKey:null,Source:"Box",TotalCount:0,TotalPageSections:0,LoadedPageSections:0,LoadAheadMargin:2,ItemsPerSection:6,CurrentPosition:0,CurrentIndex:1,PageIncrement:1,ItemDisplay:1,ItemWidth:255,MorePrevious:!0,MoreNext:!0,BoxId:0,Sort:null,Offset:!1},n),t=FR.AssetPager.Config;$(".next").on("click",function(n){n.preventDefault(),FR.AssetPager.Next(),FR.Track.Event(FR.Track.Params.AssetPager,"NextSix")});$(".next-item").on("click",function(n){n.preventDefault(),FR.AssetPager.NextImage()});$(".previous").on("click",function(n){n.preventDefault(),FR.AssetPager.Previous(),FR.Track.Event(FR.Track.Params.AssetPager,"PreviousSix")});$(".previous-item").on("click",function(n){n.preventDefault(),FR.AssetPager.PreviousImage()});$("#pager-count .next-item").on("click",function(){FR.Track.Event(FR.Track.Params.AssetPager,"NextImagePager")});$("#pager-count .previous-item").on("click",function(){FR.Track.Event(FR.Track.Params.AssetPager,"PreviousImagePager")});$("#leftBrowseContainer").on("click",function(){FR.Track.Event(FR.Track.Params.AssetPager,"PreviousImagePagerOverlay")});$("#rightBrowseContainer").on("click",function(){FR.Track.Event(FR.Track.Params.AssetPager,"NextImagePagerOverlay")});r=FR.UrlHelper.Urls.AssetPager.Load,i={Id:t.CurrentKey,Source:t.Source,sort:t.Sort,Offset:t.Offset},t.MemberProfileKey&&(i.MemberKey=t.MemberProfileKey),FR.Data.Post(r,{},i,function(n){var r,s,u,f,v,h;t.TotalCount=n.TotalCount,t.BoxId=n.Pages[0].BoxId,t.Source=n.Source,r=n.Pages.length,t.LoadedPageSections=Math.floor(r/t.ItemsPerSection),t.TotalPageSections=Math.floor(t.TotalCount/t.ItemsPerSection),t.Offset=n.Offset,t.TotalCount%t.ItemsPerSection!=0&&t.TotalPageSections++,t.CurrentIndex=n.CurrentIndex-1,n.CurrentIndex==0&&$("#leftBrowse, .previous-item").addClass("visHidden"),$(".current-count","#pager-count").html(n.CurrentIndex),$(".total-count","#pager-count").html(t.TotalCount),r==t.TotalCount&&(t.MorePrevious=!1,t.MoreNext=!1),r%t.ItemsPerSection!=0&&t.LoadedPageSections++,s=Math.floor(n.CurrentIndex/t.ItemsPerSection),n.CurrentIndex!=0&&n.CurrentIndex%t.ItemsPerSection==0&&s--,FR.AssetPager.SetCurrentPosition(s),t.CurrentPosition<=1?t.MorePrevious=!1:Math.floor(t.TotalCount/t.ItemsPerSection)<=t.LoadedPageSections&&(t.MoreNext=!1);var i="",e=!0,a=-1,c=-1;for(u=0;u<r;u++)f=n.Pages[u],e&&(i=i+'<li class="page carousel-item">',a++),f.Index==n.CurrentIndex-1&&(c=a),(u+1)%6==0?(i=i+FR.AssetPager.GetPagedItemHtml(f,!0),e=!0):(i=i+FR.AssetPager.GetPagedItemHtml(f,!1),e=!1),e&&(i=i+'</li">');if(v=c*t.ItemWidth,i='<ul style="width: '+t.TotalPageSections*t.ItemWidth+35+"px; left: -"+v+'px;">'+i+"</ul>",$("#asset-pager-container #asset-pager-clip").html(i),!t.MoreNext){var y=0,o="",l=t.TotalCount%t.ItemsPerSection;for(l!=0&&(y=t.ItemsPerSection-l),h=0;h<y;h++)o=o+FR.AssetPager.GetPagedItemHtml(null,!1);$("#asset-pager-container #asset-pager-clip li").last().append(o)}if($("#pager-count").removeClass("hide"),t.Source!="Group"&&t.Source!="Profile"){$("#asset-pager-container").on("click","li.page a",function(n){n.preventDefault();var i=$(this);i.hasClass("empty")||(t.CurrentIndex=parseInt($(i).attr("data-index"),10),FR.AssetPager.Load(i),FR.Track.Event(FR.Track.Params.AssetPager,"LoadImageViaSix"))});FR.AssetPager.LoadGalleryTrigger(t.CurrentKey)}if(t.Source=="Profile")$("#asset-pager-container").on("click","li.page a",function(n){n.preventDefault();var i=$(this);i.hasClass("empty")||(t.CurrentIndex=parseInt($(i).attr("data-index"),10),FR.AssetPager.SetProfilePicture(i))})})},Next:function(){var n=FR.AssetPager.Config,t,i;n.CurrentPosition<n.TotalPageSections-1&&(FR.AssetPager.SetCurrentPosition(n.CurrentPosition+1),t={},i=n.ItemWidth*n.PageIncrement,t.left="-="+i,$("ul","#asset-pager-container").animate(t,{queue:!0,duration:500,complete:function(){}}),$("ul","#asset-pager-container").queue(function(){var i=this,t;n.MoreNext?(n.LoadedPageSections++,t={id:FR.AssetPager.GetElementId($("#asset-pager-container a").last()),source:n.Source,sort:n.Sort,offset:n.Offset,take:n.PageIncrement*n.ItemsPerSection,back:!1},n.MemberProfileKey&&(t.MemberKey=n.MemberProfileKey),FR.Data.Post(FR.UrlHelper.Urls.AssetPager.PagerGet,{},t,function(t){var f=t.length,r,o,u,s,e;if(f<n.ItemsPerSection&&(n.MoreNext=!1),f>0){for(r='<li class="page carousel-item">',o=0,u=0;u<f;u++)r=r+FR.AssetPager.GetPagedItemHtml(t[u],u==f-1),t[u].Index>=n.TotalCount-1&&(n.MoreNext=!1),o++;if(f<n.ItemsPerSection)for(s=n.ItemsPerSection-o,e=0;e<s;e++)r=r+FR.AssetPager.GetPagedItemHtml(null,!1);r=r+'</li">',$("#asset-pager-container ul").append(r)}$(i).dequeue()})):$(i).dequeue()}))},Previous:function(){var n=FR.AssetPager.Config,t,i;n.CurrentPosition>0&&(FR.AssetPager.SetCurrentPosition(n.CurrentPosition-1),t={},i=n.ItemWidth*n.PageIncrement,t.left="+="+i,$("ul","#asset-pager-container").animate(t,{queue:!0,duration:500}),$("ul","#asset-pager-container").queue(function(){var i=this,t;n.MorePrevious?(n.LoadedPageSections++,t={id:FR.AssetPager.GetElementId($("#asset-pager-container a").first()),source:n.Source,sort:n.Sort,offset:n.Offset,take:n.PageIncrement*n.ItemsPerSection,back:!0},n.MemberProfileKey&&(t.MemberKey=n.MemberProfileKey),FR.Data.Post(FR.UrlHelper.Urls.AssetPager.PagerGet,{},t,function(t){var f=t.length,r,o,u,h,e,s;if(f<n.ItemsPerSection&&(n.MorePrevious=!1),f>0){for(r='<li class="page carousel-item">',o=0,u=0;u<f;u++)r=r+FR.AssetPager.GetPagedItemHtml(t[u],u==f-1),t[u].Index<=0&&(n.MorePrevious=!1),o++;if(f<n.ItemsPerSection)for(h=n.ItemsPerSection-o,e=0;e<h;e++)r=r+FR.AssetPager.GetPagedItemHtml(null,!1);r=r+'</li">',$("#asset-pager-container ul").prepend(r),s=n.ItemWidth*n.PageIncrement,$("ul","#asset-pager-container").animate({left:"-="+s},0)}$(i).dequeue()})):$(i).dequeue()}))},NextImage:function(){var n=FR.AssetPager.Config,u=$("li.page a[data-index="+n.CurrentIndex+"]","#asset-pager-container"),t=n.CurrentIndex,r,i;t>n.TotalCount-(FR.AssetPager.Config.ItemsPerSection-1)&&FR.AssetPager.LoadInterstitial(),t+1==n.TotalCount&&($("#content").addClass("interstitial"),$(".next-item").addClass("visHidden")),r=Math.floor(t/n.ItemsPerSection),t!=0&&t%n.ItemsPerSection==0&&r--,i=$("li.page a[data-index="+(t+1)+"]","#asset-pager-container"),$(i).hasClass("empty")||(n.CurrentIndex=t+1,FR.AssetPager.Load(i)),u.hasClass("last")&&n.CurrentPosition==r&&FR.AssetPager.Next()},LoadInterstitial:function(){$("#interstitialHolder").length||($("#viewAsset").append('<div id="interstitialHolder"></div>'),FR.Data.Get(FR.UrlHelper.Urls.Box.Interstitial+"?boxKey="+FR.AssetPager.Config.BoxId,{},function(n){$("#interstitialHolder").append(n),FR.Track.Page("Interstitial")}))},PreviousImage:function(){if($("#content").is(".interstitial"))return FR.AssetPager.Config.CurrentIndex--,$("#content").removeClass("interstitial"),$(".next-item").removeClass("visHidden"),!1;var n=FR.AssetPager.Config,i=n.CurrentIndex,r=Math.floor(i/n.ItemsPerSection),t=$("li.page a[data-index="+(i-1)+"]","#asset-pager-container");t.hasClass("last")&&n.CurrentPosition==r&&FR.AssetPager.Previous(),$(t).hasClass("empty")||(n.CurrentIndex=i-1,FR.AssetPager.Load(t))},Load:function(n){var t=FR.AssetPager.Config,i,u;if(n.length>0){FR.AssetPager.HidePageElements(),t.CurrentKey=FR.AssetPager.GetElementId(n);var o=$(n).attr("data-title"),e=$(n).attr("data-pagetitle"),r=parseInt($(n).attr("data-type"),10),f=parseInt($(n).attr("data-index"),10);f==0?$("#leftBrowse, .previous-item").addClass("visHidden"):$("#leftBrowse, .previous-item").removeClass("visHidden"),$("#content").is(".interstitial")&&($("#content").removeClass("interstitial"),$(".next-item").removeClass("visHidden")),$("#media-image").attr("src",$(n).attr("data-full")).attr("alt",o),document.title=e,Modernizr.history&&window.history.pushState(t.CurrentKey,e,$(n).attr("href")),i=$(n).attr("data-memory")=="true"?!0:!1,u=$(n).attr("data-deleted")=="true"?!0:!1,r==1||r==5?r!=t.CurrentType?FR.Data.Get("/Media/Photo?id="+t.CurrentKey+"&isMemory="+i+"&isArchivedMemory="+u+"&source="+t.Source+"&gallery=false",{},function(n){$("#viewAssetPlayer").html(n),FR.AssetPager.LoadAssetMetaData(t.CurrentKey,i)}):(FR.AssetPager.LoadAssetMetaData(t.CurrentKey,i),$("#viewAssetPlayer img").attr("data-id",t.CurrentKey)):r==2?(FR.Data.Get("/Media/Video?id="+t.CurrentKey+"&isMemory="+i,{},function(n){$("#viewAssetPlayer").html(n)}),FR.AssetPager.LoadAssetMetaData(t.CurrentKey,i),$(".photo-tag-container").hide()):r==4?(FR.Data.Get("/Media/EmbeddedVideo?id="+t.CurrentKey+"&isMemory="+i,{},function(n){$("#viewAssetPlayer").html(n)}),FR.AssetPager.LoadAssetMetaData(t.CurrentKey,i),$(".photo-tag-container").hide()):FR.Track.Event(FR.Track.Params.AssetPagerDev,"LoadTypeUnknown"),t.CurrentType=r,$(".current-count","#pager-count").html(f+1)}},LoadAssetMetaData:function(n,t){var i=FR.AssetPager.Config,r={Id:n,IsMemory:t,Source:i.Source};i.MemberProfileKey&&(r.MemberProfileKey=i.MemberProfileKey),$("#showPhotoTagging").hide(),$("#fullScreen").hide().off("click"),i.Source!="Box"&&FR.Data.Post(FR.UrlHelper.Urls.AssetPager.Breadcrumb,{dataType:"html"},r,function(n){$("#breadcrumb-wrapper").html(n)}),FR.Data.Post(FR.UrlHelper.Urls.AssetPager.Get,{},r,function(r){var u,f;FR.Track.Page("AssetPager"),$("#media-author-info h3").html(r.Title+' <span class="asset-display-date date">'+r.DisplayDate+"</span>"),$(".info .description",i.MediaSelectorEl).html(r.Description),$("p.asset-display-date",i.MediaSelectorEl).html(r.Date),$("#media-author-info .creation img",i.MediaSelectorEl).attr("src",r.AuthorImageUrl).attr("alt",r.AuthorName),$("#media-author-info .info .created-on-date",i.MediaSelectorEl).html(r.CreatedOn),$("a.media-profile-url",i.MediaSelectorEl).attr("href",r.AuthorProfileUrl),$(".creation .date .media-profile-url",i.MediaSelectorEl).html(r.AuthorName),u="Add photo tags",r.PhotoTagCount>0&&(u="View photo tags <span>"+r.PhotoTagCount+"</span>"),$("#showPhotoTagging").html(u),$("#image-kept-count").html(r.KeepCount),r.IsKeptByUser?$("#keep-button").html("Kept").removeClass("keep").addClass("kept").attr("data-id",r.Id):$("#keep-button").html("Keep").removeClass("kept").addClass("keep").attr("data-id",r.Id),r.CreditText&&r.CreditUrl&&(f='&nbsp;<a rel="nofollow" href="'+r.CreditUrl+'" target="_blank" class="credit-link">'+r.CreditText+"</a>",$(".info .description",i.MediaSelectorEl).append(f)),$("#print-buy a").attr("href",r.PrintableUrl),$("#print-buy").attr("data-href",r.PrintableUrl),r.IsPrintable?$("#print-buy").removeClass("hidden"):$("#print-buy").addClass("hidden"),r.IsReportable&&!r.ShowEditButton?($("#media-author-info .actions").removeClass("hide"),$("#media-author-info .actions .report").attr("data-id",r.Id)):$("#media-author-info .actions").addClass("hide"),r.ShowEditButton?t?$("#edit-button").attr("href","/Memory/Edit/"+n+"?source="+i.Source).html("Edit").show():$("#edit-button").attr("href","/Media/Edit/"+n+"?source="+i.Source).html("Edit").show():$("#edit-button").attr("href","#").html("Edit not available").hide(),i.CurrentLegacy=r.IsLegacyBox,t&&setTimeout("FR.AssetPager.HasPageChanged('"+n+"')",1500),setTimeout("FR.AssetPager.LoadRememberWhen  ('"+n+"', "+r.CategoryId+")",1500),setTimeout("FR.AssetPager.LoadGalleryTrigger  ('"+n+"')",1500)},function(){FR.Track.Event(FR.Track.Params.AssetPagerDev,"MetaDataPostError"),setTimeout(function(){window.location.reload()},500)})},SetCurrentPosition:function(n){FR.AssetPager.Config.CurrentPosition=n,FR.AssetPager.Config.TotalPageSections>1&&(n<=0?($(".previous","#asset-pager-container").addClass("disabled").attr("disabled","disabled"),$(".next","#asset-pager-container").removeClass("disabled").removeAttr("disabled")):(n>=FR.AssetPager.Config.TotalPageSections-1?($(".next","#asset-pager-container").addClass("disabled").attr("disabled","disabled"),FR.AssetPager.Config.MoreNext=!1):$(".next","#asset-pager-container").removeClass("disabled").removeAttr("disabled"),$(".previous","#asset-pager-container").removeClass("disabled").removeAttr("disabled")))},GetPagedItemHtml:function(n,t){if(n){$("<img/>").load(function(){}).error(function(){}).attr("src",n.FullSizeImageUrl);var i='class="'+n.CssClass+" "+n.TypeCls;return t&&(i=i+" last"),i=i+'"',"<a "+i+' href="'+n.Url+'" data-id="'+n.Id+'" data-memoryid="'+n.MemoryId+'" data-box="'+n.BoxId+'" data-title="'+n.Title+'" data-pagetitle="'+n.PageTitle+'" data-index="'+n.Index+'" data-full="'+n.FullSizeImageUrl+'" data-memory="'+n.IsMemory+'" data-deleted='+n.IsDeleted+'" data-type="'+n.Type+'"><div class="assetThumbCentre"><img src="'+n.ImageUrl+'" height="'+n.Height+'" width="'+n.Width+'" alt="'+n.Title+'" /><div class="videoOverlay"></div></div></a>'}return'<a class="empty"><div class="assetThumbCentre">&nbsp;</div></a>'},GetElementId:function(n){var t=$(n).attr("data-id"),i=$(n).attr("data-memory")=="true"?!0:!1;return i&&(t=$(n).attr("data-memoryid")),t},HidePageElements:function(){$(".socialLinks, #appears-in-container, #kept-by-container, #replies-list, #merchanisable-container, #remember-when").hide()},HasPageChanged:function(n){var i=FR.AssetPager.Config,r,t,u;n==i.CurrentKey&&(r=$("a[data-memoryid="+i.CurrentKey+"]","#asset-pager-container"),r.length==0&&(r=$("a[data-id="+i.CurrentKey+"]","#asset-pager-container")),t=r.attr("data-memoryid"),u=r.attr("data-box"),$("#showPhotoTagging").show(),$("#comment-list").html('<div id="comments-body" class="pager-refresh-target"></div>'),FR.Data.Get("/Comment/Comments?id="+t+"&source="+i.Source+"&pager=true",{},function(n){$(".pager-refresh-target").html(n),$("#comment-list").show(),FR.Data.Get(FR.UrlHelper.Urls.Comment.Reply+"?memoryId="+t,{},function(n){$("#comment-list").append(n),FR.Data.Get(FR.UrlHelper.Urls.Comment.OtherBoxes+"?memoryId="+t,{},function(n){$("#comment-list").append(n),FR.Comment.Setup()})})}),FR.Data.Get("/Media/AppearsInWidget?memoryId="+t,{},function(n){$("#appears-in-container").html(n).show()}),i.IsAuthenticated&&(FR.Data.Get("/Media/KeptByWidget/"+t,{},function(n){$("#kept-by-container").html(n).show()}),FR.Data.Get("/Media/BuyImage?id="+t,{},function(n){$("#merchanisable-container").html(n).show()})),i.CurrentLegacy||FR.Data.Get("/UI/Share?boxKey="+u+"&memoryId="+t,{},function(n){$(".sharing").html(n).show()}),FR.Adverts.Refresh(!0),FR.Track.Event(FR.Track.Params.AssetPager,"AssetPagerFull"))},LoadRememberWhen:function(n,t){var i=FR.AssetPager.Config;n==i.CurrentKey&&FR.Data.Get("/UI/RememberWhen?category="+t,{},function(n){$("#remember-when").html(n).show()})},SetProfilePicture:function(n){var t=FR.AssetPager.Config;n.length>0&&(t.CurrentKey=FR.AssetPager.GetElementId(n),$("#imgProfilePhoto").attr("src",$(n).attr("data-full")),$("#NewProfilePhotoFromMemory").attr("value",t.CurrentKey))},LoadGalleryTrigger:function(n){var t=FR.AssetPager.Config;n!=t.CurrentKey||$("body").hasClass("mobile")||$("#fullScreen").on("click",function(i){i.preventDefault(),FR.Data.Get("/Pager/GalleryLoad?id="+n+"&source="+t.Source+"&memberKey="+t.MemberProfileKey+"&sort="+t.Sort,{},function(n){$("#gallery-pager-container").html(n)})}).show()}};FR.PhotoTag={Hide:function(n,t){n.fadeOut(function(){n.remove()}),t.fadeOut(function(){t.remove()})},Show:function(n){var i,f,e=new Image;e.src=$(n).attr("src"),i=e.width,f=e.height,(i===undefined||i<10)&&(i=$(n).width(),f=$(n).height());var l=$("#container"),r=$('<div id="tagShim"><div>').appendTo(l),u=$(n),a=f,p=i,v=u.attr("data-id"),s=u.clone(),y=$('<a title="Cancel" class="close" href="#">X</a>'),h=$('<div id="tagPhotoInner"></div>').append(s),t=$('<div id="tagPhoto"></div>').append(h).append(y),o,c;r.on("click",function(){FR.PhotoTag.Hide(r,t)}).animate({opacity:.33},"fast");t.on("click","a.close",function(n){n.preventDefault(),FR.PhotoTag.Hide(r,t)});t.hide().appendTo(l),o=t.width(),c=$(window).height()-45,h.css({"max-height":c}),t.css({"margin-left":-(o/2),"max-width":o}).fadeIn(),s.photoTag({requesTagstUrl:FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.PhotoTag.RequestTagsUrl,[v])+"?imageWidth="+p+"&imageHeight="+a+"&rand="+Math.random(),deleteTagsUrl:FR.UrlHelper.Urls.PhotoTag.DeleteTagsUrl,addTagUrl:FR.UrlHelper.Urls.PhotoTag.AddTagUrl,parametersForNewTag:{name:{parameterKey:"name",isAutocomplete:!0,autocompleteUrl:FR.UrlHelper.Urls.PhotoTag.AutocompleteUrl,label:"Name",source:u.attr("data-source")}},tag:{defaultWidth:115,defaultHeight:85},imageWrapBox:{controlPanelHeight:30},manageError:function(){FR.Notification.Add("Unable to save tag","You must provide a name or description for the tag","warning")}})},Setup:function(){$("#asset-display-container").on("click","a#showPhotoTagging",function(n){n.preventDefault(),FR.PhotoTag.Show("#media-image")})}};$.InlineConfirm=function(n,t,i){var r=$.extend({message:"Are you sure?",confirmButtonText:"OK",cancelButtonText:"Cancel",showConfirmButton:!0,showCancelButton:!0,offsetLeft:0,offsetTop:0},i),s,f,u,o,e;if($("body.mobile").length>0)return confirm(r.message)?(r.callback(),!0):!1;s=$(n).offset().top+r.offsetTop,f=$(n).offset().left+r.offsetLeft,$(t).parent(".inline-confirm-wrapper").length>0&&($(".inline-confirm-box").remove(),$(t).removeClass("inline-fade"),$(t).unwrap()),$(t).wrap('<div class="inline-confirm-wrapper">'),$(t).addClass("inline-fade"),$(".inline-confirm-wrapper").animate({opacity:.2},500,"swing",function(){}),u=$(document.createElement("div")),u.addClass("inline-confirm-box"),u.html(function(){var n='<p class="inline-message">'+r.message+"</p>";return(r.showConfirmButton||r.showCancelButton)&&(n=n+'<div class="inline-buttons">',r.showCancelButton&&(n=n+'<input type="submit" value="'+r.cancelButtonText+'" class="secondaryButton inline-cancel" />'),r.showConfirmButton&&(n=n+'<input type="submit" value="'+r.confirmButtonText+'" class="primaryButton inline-confirm" />'),n=n+"</div>"),n}),u.attr("style","position: absolute; top:"+s+"px; left:"+f+"px;"),$("body").prepend(u),o=$(window).width(),e=$(".inline-confirm-box").width(),f>o&&$(".inline-confirm-box").offset({left:-(e*2)}),$(".inline-confirm-box").animate({width:"toggle",top:"-="+$(".inline-confirm-box").height(),left:"-="+$(".inline-confirm-box").width()},200,"swing",function(){}),$(".inline-confirm").click(function(){return $(this).attr("disabled",!0).addClass("disabled"),typeof r.callback=="function"&&($(".inline-confirm-box").html(function(){return'<img src="'+FR.StaticUrl+'/img/loadingSpinner.gif" />'}),r.callback(),$(".inline-confirm-box").remove(),$(".inline-confirm-wrapper").animate({opacity:1},500,function(){$(t,this).removeClass("inline-fade"),$(t,this).unwrap()})),!1}),$(".inline-cancel").click(function(){return $(".inline-confirm-box").remove(),$(".inline-confirm-wrapper").animate({opacity:1},500,function(){$(t,this).removeClass("inline-fade"),$(t,this).unwrap()}),!1})};FR.Search=FR.Search||{},FR.Search.KeyWordSearch={CheckForChange:function(n){n!=""&&n.indexOf(" ")>0&&$("#searchTip").fadeIn()}},FR.Load(function(){$("#keyword").change(function(){FR.Search.KeyWordSearch.CheckForChange($("#keyword").val())}).keyup(function(){FR.Search.KeyWordSearch.CheckForChange($("#keyword").val())}),$("#searchTip").click(function(){$(this).hide(),$("#keyword").unbind("change").unbind("keyup")})});$("#assetPagingHeader.pager_square200").css("margin-left",parseInt($(".profilePic img").css("width"))+30+"px"),$("#content #column1.profile #groups h2").click(function(){$(this).hasClass("groupbarclosed")?($("#content #column1.profile #groups").animate({bottom:"0px"},500,"swing"),$(this).removeClass("groupbarclosed")):($("#content #column1.profile #groups").stop().animate({bottom:"-138px"},500,"swing"),$(this).addClass("groupbarclosed"))}),$("#mapStreets > h2").click(function(){$(this).hasClass("mapoverclosed")?($("#mapStreets").animate({bottom:"0px"},500,"swing"),$(this).removeClass("mapoverclosed")):($("#mapStreets").stop().animate({bottom:"-200px"},500,"swing"),$(this).addClass("mapoverclosed"))});$(document).on({mouseenter:function(){$(this).find(".profile-gallery-actions").fadeIn("fast")},mouseleave:function(){$(".profile-gallery-actions").fadeOut("fast")}},".carousel-item-wrap");$(".profilePic").mouseenter(function(){$(".newprofilephoto-upload").fadeIn("fast")}),$(".profilePic").mouseleave(function(){$(".newprofilephoto-upload").fadeOut("fast")}),FR.Box={Header:function(){$(".more-description","#description-paragraph-short").on("click",function(n){n.preventDefault(),$("#description-paragraph-short").hide(),$("#description-paragraph-full").show(),$(".information","#box-information").show()})},SetupDeleteButton:function(){$(".item .deleteAsset").on("click",function(){var n=this;return $.InlineConfirm(n,$(n).closest(".item"),{message:"Are you sure you want to delete this memory from the box?",confirmButtonText:"Delete",cancelButtonText:"Cancel",callback:function(){var i=$(n).attr("data-id"),t=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.Memory.Delete,[i]);return FR.Data.Post(t,[],null,function(t){t.isSuccess&&($("#gridView").masonry("destroy"),$(n).closest(".item").remove(),!$("body.mobile").length>0?$("#gridView").masonry({itemSelector:".item",columnWidth:240,cornerStampSelector:".corner-stamp",isAnimated:!0}):$(".corner-stamp").remove())}),!1}}),!1})},SetupPromoteButton:function(){$(".item .promoteAsset").on("click",function(){var n=this;return $.InlineConfirm(n,$(n).closest(".item"),{message:"Are you sure you want to make this the primary photo?",confirmButtonText:"Ok",cancelButtonText:"Cancel",callback:function(){var i=$(n).attr("data-id"),t=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.Memory.Promote,[i]);return FR.Data.Post(t,[],null,function(n){n.isSuccess&&location.reload()}),!1}}),!1})},SetupAssetKeptButton:function(n){$("#keep-button").on("click",function(t){t.preventDefault();var i=this,u=$(i).attr("data-id"),r;$(i).hasClass("keep")?($(i).addClass("justKept").addClass("kept").removeClass("keep").html("Kept"),r=parseInt($("#image-kept-count").text()),$("#image-kept-count").text(r+1),FR.OpenGraph.KeepMemory(window.location.href,n,function(){$(i).on("mouseout",function(){$(i).removeClass("justKept")});var n=parseInt($("#UserKeepCount").val());n<=3&&FR.Notification.Add("Added to your Keepsafe","Find this again in your Keepsafe.","confirmation"),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Add,[],{id:u},function(n){n.isSuccess||(window.location.href=n.redirectToUrl)})})):$(i).hasClass("kept")&&($(i).addClass("keep").removeClass("kept").html("Keep"),r=parseInt($("#image-kept-count").text()),$("#image-kept-count").text(r-1),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Remove,[],{id:u},function(n){n.success&&n.returnUrl&&(window.location.href=n.returnUrl)}))});$("#keep-button").hover(function(){$(this).hasClass("kept")&&$(this).html("UnKeep")},function(){$(this).hasClass("kept")&&$(this).html("Kept")})}};$("#content #column0.people a.showall").click(function(n){$("#content #column0.people section.filter, #content #column0.people section#people-list").slideToggle("fast"),$(this).find("span:first-child").text($(this).text()=="Show all"?"Hide all":"Show all"),$(this).find("span.caret").toggleClass("open"),n.preventDefault()}),FR.People={boxId:"",removeUrl:"",promoteUrl:"",demoteUrl:"",promoteImageUrl:"",demoteImageUrl:"",Setup:function(n){function t(){}FR.People.boxId=n,t(),$(window).resize(function(){t()});$(window).on("scroll",function(){t()});$("#people-search-form").submit(function(){return FR.People.GetPeopleList(),!1}),$(".clear-search").live("click",function(n){n.preventDefault(),$("#people-search-form #SearchKeywords").val(""),FR.People.GetPeopleList()});$("#people-nav-ul a").on("click",function(n){n.preventDefault();var t=$(this).attr("data-sort");t&&($("#people-nav-ul li").removeClass("selected"),$(this).parent().addClass("selected"),FR.People.GetPeopleList())});$(".classmateYears select").change(function(n){n.preventDefault(),FR.People.GetPeopleList()});$(document).on("bocagrande.pager.page",function(){FR.Adverts.Refresh(!0)});$(document).on("bocagrande.pager.load",function(n,t){t&&(t.sort?($("#people-nav-ul li").removeClass("selected"),$("#people-nav-ul a[data-sort="+t.sort+"]").parent().addClass("selected")):($("#people-nav-ul li").removeClass("selected"),$("#people-nav-ul a[data-sort=Surname]").parent().addClass("selected")),t.keywords?$("#people-search-form #SearchKeywords").val(unescape(t.keywords)):$("#people-search-form #SearchKeywords").val(""),$("#StartYear").length>0&&(t.from&&t.from!=0?$("#StartYear").val(t.from):$("#StartYear")[0].selectedIndex=0),$("#EndYear").length>0&&(t.to&&t.to!=0?$("#EndYear").val(t.to):$("#EndYear")[0].selectedIndex=0)),FR.Adverts.Refresh(!0),FR.Track.Page("PeopleSearch")})},GetPeopleList:function(){var t=null,n=null,i;$("#StartYear").length>0&&(t=$("#StartYear").val(),t==""&&(t=0)),n=0,$("#EndYear").length>0&&(n=$("#EndYear").val(),n==""&&(n=0)),i={keywords:$("#people-search-form #SearchKeywords").val(),sort:$("#people-nav-ul li.selected a").attr("data-sort"),from:t,to:n,page:1,pager:!0},BocaGrande.Pager.SetFilter(i)},SetupAdmin:function(n,t,i,r,u,f){FR.People.boxId=n,FR.People.removeUrl=t,FR.People.promoteUrl=i,FR.People.demoteUrl=r,FR.People.promoteImageUrl=u,FR.People.demoteImageUrl=f;$("#people-list-items .remove").on("click",function(){var n=this;return $.InlineConfirm(n,$(n).closest("li"),{message:"Are you sure you want to remove this member?",confirmButtonText:"Remove",cancelButtonText:"Cancel",callback:function(){var i={boxId:FR.People.boxId,memberId:$(n).attr("data-id")},t=FR.People.removeUrl;FR.Data.Post(t,[],i,function(){$(n).closest("li").fadeOut(function(){$(n).remove()}),FR.Adverts.Refresh(!0),FR.Track.Page("PeopleDelete")})}}),!1});$("#people-list-items .status-promote").one("click",function(){return FR.People.PromoteMember(this,FR.People.boxId,FR.People.promoteUrl,FR.People.demoteImageUrl),!1});$("#people-list-items .status-demote").one("click",function(){return FR.People.DemoteMember(this,FR.People.boxId,FR.People.demoteUrl,FR.People.promoteImageUrl),!1})},DemoteMember:function(n,t,i,r){$.InlineConfirm(n,$(n).closest("li"),{message:"Removing this user as an admin will prevent them from managing and editing the box.",confirmButtonText:"Demote",cancelButtonText:"Cancel",callback:function(){FR.Util.HideEl($(n).closest("li"));var f={boxId:t,memberId:$(n).attr("data-id")},u=i;FR.Data.Post(u,[],f,function(){$("img",n).attr("src",r),$(".owner",$(n).closest("li")).remove(),$(n).addClass("status-promote").attr("title","Promote user"),$(n).removeClass("status-demote"),FR.Util.ShowEl($(n).closest("li")),FR.Adverts.Refresh(!0);$(n).one("click",function(){return FR.People.PromoteMember(this,FR.People.boxId,FR.People.promoteUrl,FR.People.demoteImageUrl),!1})})}})},PromoteMember:function(n,t,i,r){$.InlineConfirm(n,$(n).closest("li"),{message:"Making this user an admin will allow them to manage and edit the box.",confirmButtonText:"Promote",cancelButtonText:"Cancel",callback:function(){FR.Util.HideEl($(n).closest("li"));var f={boxId:t,memberId:$(n).attr("data-id")},u=i;FR.Data.Post(u,[],f,function(){$("img",n).attr("src",r),$(".user-name",$(n).closest("li")).after('<p class="extra owner">Owner</p>'),$(n).removeClass("status-promote"),$(n).addClass("status-demote").attr("title","Demote user"),FR.Util.ShowEl($(n).closest("li")),FR.Adverts.Refresh(!0),FR.Track.Page("PeoplePromote");$(n).one("click",function(){return FR.People.DemoteMember(this,FR.People.boxId,FR.People.demoteUrl,FR.People.promoteImageUrl),!1})})}})}};FR.Polls={CreateSetup:function(n){var i=$("#divAnswers li").size(),t;i>=10&&$("#addLink").fadeOut(),$("#Question").watermark(),$(".answer").watermark();$("#cancelPollCreateButton").on("click",function(){return $("#pollCreate").remove(),$("#pollResult").show(),!1});$("#divAnswers").sortable({placeholder:"ui-state-highlight",axis:"y",handle:"a.move",disabled:!0,containment:"#pollCreate",stop:function(){FR.Polls.SetAnwserTextBoxNames()}}),$(".move").mousedown(function(){$(this).closest("li").find("input").addClass("highlight")}),$("body").mouseup(function(){$(this).find(".previewpolllist input").removeClass("highlight")});$("#addLink").on("click",function(){var n=$("#divAnswers li").size();n>=9&&$("#addLink").fadeOut(),n>=2&&$(".deleteButton").show(),$("#divAnswers").append($('<li><input type="text" maxlength="40" placeholder="Set an answer" class="answer" /> <a title="Delete answer" class="deleteButton">Delete</a></li>')),$("#divAnswers li:last input").focus(),$(".answer").watermark(),FR.Polls.SetupDeleteAnimation(),FR.Polls.SetAnwserTextBoxNames()});$("#subPoll").on("click",function(n){n.preventDefault();var t=!1;$("#divAnswers li input:text").each(function(){if($.trim($(this).val()).length==0)return $('span[htmlfor="Answer"]').length==0&&$("#divAnswers").append('<span htmlfor="Answer" generated="true" class="field-validation-error">Please fill in all answers</span>'),t=!0,!0}),t||$("#newPollForm").submit()});$("#savePollCreateButton").on("click",function(){var r=$("#newPollForm").valid(),i=$("#divAnswers li").length>1,t;return $("#divAnswers li").each(function(n,t){var r=0,u=$.trim($("input.answer",t).val());u&&(r=u.length),r==0||r>140?(i=!1,$("input.answer",t).addClass("input-validation-error")):$("input.answer",t).removeClass("input-validation-error")}),i?($("#errorPanel ul li.answers-validation").hide(),r&&(FR.Util.HideEl("#polls"),$.post(n,$("#newPollForm").serialize(),function(n){$("#pollCreate").remove(),$("#pollResult").html(n.html),$("#pollResult").show(),FR.Util.ShowEl("#polls"),(n.reload="true")&&location.reload()}))):(t=$("#errorPanel ul li.answers-validation"),t.length==0?$("#errorPanel ul").append('<li class="answers-validation"><span generated="false" class="field-validation-error" style="display: block;">You must provide at least two answers, which must be less than 140 characters</span></li>'):($("#errorPanel ul li.answers-validation").show(),$("#errorPanel ul li.answers-validation span").show()),$("#errorPanelWrapper").show()),!1});FR.Polls.SetAnwserTextBoxNames(),FR.Polls.SetupDeleteAnimation(),t=$("#divAnswers li").size(),t>=2&&$(".deleteButton").show()},VoteSetup:function(n){$("#polls").on("click","#pollCreateButton",function(){return FR.Util.HideEl("#polls"),FR.Data.Get(n,{},function(n){$("#pollResult").hide(),$("#polls").append(n),FR.Adverts.Refresh(!0),FR.Track.Page("PollCreate"),FR.Util.ShowEl("#polls")}),!1});$("#polls").on("click",".pollsData.vote li",function(){var t=this,n=$(this).parent(),i;$(".edit, .delete","#polls").hide(),i={AnswerId:$(t).attr("data-answer"),PollId:$(t).parent().attr("data-id")},FR.Data.Post(FR.UrlHelper.Urls.PollVote,{},i,function(i){$(t).addClass("selected"),$(n).removeClass("vote").find(".vote").remove(),$(n).find("li").append('<span class="percentText">0%</span>'),i.length>0&&$("li",n).each(function(){for(var u=$(this).attr("data-answer"),n=0;n<i.length;n++)if(u==i[n].Id){var r=parseInt(i[n].Percentage,10),f=Math.random()*80,t=r-f+40;t>100&&(t=100),(t<0||r<5)&&(t=0),$(".bar",this).animate({width:t+"%"},{duration:500+Math.random()*500,complete:function(){$(this).animate({width:r+"%"},{duration:500+Math.random()*1e3,easing:"swing",step:function(n){$(this).closest("li").find(".percentText").text(Math.floor(n)+"%")},complete:function(){$(this).closest("li").removeClass("selected")}})},easing:"linear",step:function(n){$(this).closest("li").find(".percentText").text(Math.floor(n)+"%")}})}})})})},PagingSetup:function(n,t,i,r,u){$(".edit",".pollBody").on("click",function(){return FR.Util.HideEl("#polls"),FR.Data.Get(n,{},function(n){$("#pollResult").hide(),$("#polls").append(n),FR.Adverts.Refresh(!0),FR.Track.Page("PollEdit"),FR.Util.ShowEl("#polls")}),!1});$(".delete",".pollBody").on("click",function(){return $.InlineConfirm(this,$("#pollResult"),{message:"Are you sure you want to delete this poll?",confirmButtonText:"Delete",cancelButtonText:"Cancel",callback:function(){FR.Data.Get(t,{},function(n){$("#pollResult").html(n),FR.Adverts.Refresh(!0),FR.Track.Page("PollDelete")})}}),!1});$(".close",".pollBody").on("click",function(){return FR.Util.HideEl("#polls"),FR.Data.Get(i,{},function(n){$("#pollResult").html(n),FR.Adverts.Refresh(!0),FR.Track.Page("PollClose"),FR.Util.ShowEl("#polls")}),!1});$("#pollPaging .previous","#polls").on("click",function(){return FR.Util.HideEl("#polls"),FR.Data.Get(r,{},function(n){$("#pollResult").html(n),FR.Adverts.Refresh(!0),FR.Track.Page("PollPager"),FR.Util.ShowEl("#polls")}),!1});$("#pollPaging .next","#polls").on("click",function(){return FR.Util.HideEl("#polls"),FR.Data.Get(u,{},function(n){$("#pollResult").html(n),FR.Adverts.Refresh(!0),FR.Track.Page("PollPager"),FR.Util.ShowEl("#polls")}),!1})},animateResults:function(){$(".pollsData .bar").each(function(){var i=parseInt($(this).attr("percent"),10),r=Math.random()*80,n=i-r+40,t;n>100&&(n=100),(n<0||i<5)&&(n=0),t=$(this).parent().width(),$(this).animate({width:t*(n/100)+"px"},{duration:500+Math.random()*500,complete:function(){$(this).animate({width:t*(i/100)+"px"},{duration:500+Math.random()*1e3,easing:"swing",step:function(n){$(this).find(".percentText").text(Math.floor(n/t*100)+"%")},complete:function(){$(this).closest("li").removeClass("selected")}})},easing:"linear",step:function(n){$(this).find(".percentText").text(Math.floor(n/t*100)+"%")}})})},SetAnwserTextBoxNames:function(){$("#divAnswers li input:text").each(function(n,t){$(t).attr("name","Answers["+n+"].Answer")})},SetupDeleteAnimation:function(){$(".deleteButton","#polls").on("click",function(){$(this).closest("li").fadeOut("slow",function(){$(this).remove();var n=$("#divAnswers li").size();n>=9&&$("#addLink").fadeIn(),n<3&&$(".deleteButton").hide(),FR.Polls.SetAnwserTextBoxNames()})})},Submit:function(){}};FR.Share={initialWindow:"",Setup:function(n,t,i,r,u,f){$(".share .facebook, .socialLinks #facebook-share a, .twitter-share-button, .twitter a, .share-button, .share .friends, .share .email").off("click"),FR.FacebookLoad(function(){$(".share .facebook, .socialLinks #facebook-share a").on("click",function(){function n(n){n&&(FR.Notification.Add("Shared with Facebook","You have successfully shared this memory with your friends on Facebook","confirmation"),FR.Track.Event(FR.Track.Params.Sharing,"ShareFacebookConfirm"),$("#shareDialog .close").click())}var e={method:"feed",link:u,picture:f,name:t,caption:r,description:i};return FB.ui(e,n),FR.Track.Event(FR.Track.Params.Sharing,"ShareFacebook"),!1})});$(".twitter-share-button, .twitter a").on("click",function(n){n.preventDefault(),window.open("https://twitter.com/intent/tweet?button_hashtag=RememberWhen&text="+t+"&url="+u+"&via=friendsreunited","_blank"),FR.Track.Event(FR.Track.Params.Sharing,"ShareTwitter")});$(".share-button").on("click",function(n){n.preventDefault(),FR.Track.Event(FR.Track.Params.Sharing,"ShareOpen"),$(this).parent().prevAll(".shareDialog").FRdialogue({width:600,cancelCls:"cancel"});$(".share .friends").on("click",function(){FR.Share.initialWindow=$("#shareDialogContent").html(),FR.Util.HideEl("#shareDialogContent"),FR.Data.Get("/Sharing/Friends?boxKey="+$(this).attr("data-id")+"&memoryId="+$(this).attr("data-memory"),{},function(n){$("#shareDialogContent").html(n),FR.Util.ShowEl("#shareDialogContent"),FR.Track.Event(FR.Track.Params.Sharing,"ShareRecommend")})});$(".share .email").on("click",function(n){n.preventDefault(),FR.Share.initialWindow=$("#shareDialogContent").html(),FR.Util.HideEl("#shareDialogContent"),FR.Data.Get("/Sharing/Email?boxKey="+$(this).attr("data-id")+"&memoryId="+$(this).attr("data-memory"),{},function(n){$("#shareDialogContent").html(n),FR.Util.ShowEl("#shareDialogContent"),FR.Track.Event(FR.Track.Params.Sharing,"ShareEmail")})})})},SetupWarningMessage:function(){$("#socialSharing").hide();$("#hidewarning-button").on("click",function(){$(".shareWarning").hide(),$("#socialSharing").show()})},SetupEmail:function(){$.FRdialogueClose(function(){$("#shareDialogContent").html(FR.Share.initialWindow)}),$("#send-button").click(function(){return FR.Share.SendEmail(),!1}),$("#addEmail").click(function(){return FR.Share.AddEmailToSendList(),!1}),$("#cancel-button").click(function(){return $(".close").click(),!1})},SetupFREmail:function(){$.FRdialogueClose(function(){$("#shareDialogContent").html(FR.Share.initialWindow)}),$("#send-button").click(function(){return FR.Share.SendFriendsReunitedEmail(),!1}),$(".members").click(function(){return FR.Share.AddMemberToList(this),!1}),$("#cancel-button").click(function(){return $(".close").click(),!1}),FR.Util.AttachInlineCount($("#Message"),{count:500,expandable:!0})},AddEmailToSendList:function(){var t=$("#emailInput").val(),n;FR.Share.ValidateEmail(t)?($("#errorPanelWrapper").hide(),$("#emailInput").val(""),$("#addedEmail").show(),$("#invalidEmail").remove(),n='<span name="EmailAddressList" class="customEmail">'+t+"</span>",$("#addedEmail").append(n),$("#addedEmail").children().last().click(function(){$(this).remove(),$("#addedEmail").children().length==0&&$("#addedEmail").hide()})):$("#invalidEmail").length==0&&($("#errorPanel ul").append('<li id="invalidEmail"><span for="invalidEmail" generated="false" class="field-validation-error" style="display: block;">Please enter a correctly formatted email address</span></li>'),$("#errorPanelWrapper").show())},ShowEmailError:function(){return $("#addedEmail").children().length==0?($("#errorPanel ul").append('<li id="noEmails"><span for="noEmails" generated="false" class="field-validation-error" style="display: block;">Please enter at least one email address</span></li>'),$("#errorPanelWrapper").show(),!1):($("#noEmails").remove(),!0)},ShowFriendsError:function(){if($("#noMembers").length==0)return $("#addedEmail").children().not("#info-watermark").length==0?($("#noEmails").length==0&&$("#errorPanel ul").append('<li id="noEmails"><span for="noEmails" generated="false" class="field-validation-error" style="display: block;">Please enter at least one contact</span></li>'),$("#errorPanelWrapper").show(),!1):($("#noEmails").remove(),!0)},SendEmail:function(){var t,n;return $("#emailcontact-form").valid()?(t=$("#emailInput").val(),t.length>0&&FR.Share.AddEmailToSendList(),FR.Share.ShowEmailError("#noEmails")||$("#errorPanelWrapper").show(),FR.Util.HideEl("#shareDialogContent"),n=$("#EmailAddressList").val(),$("#addedEmail").children().each(function(t,i){n=n+", "+$(i).text()}),FR.Data.Post(FR.UrlHelper.Urls.Sharing.Email,[],{Id:$("#Id").val(),Name:$("#Name").val(),Email:$("#Email").val(),MemoryId:$("#MemoryId").val(),Message:$("#Message").val(),EmailAddressList:n},function(n){n.isSuccess&&(FR.Notification.Add("Email sent","You have successfully shared this","confirmation"),FR.Track.Event(FR.Track.Params.Sharing,"ShareEmailConfirm"),$(".close").click())})):(FR.Share.ShowEmailError(),$("#errorPanelWrapper").show()),!1},ValidateEmail:function(n){var t=new RegExp(/^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i);return t.test(n)},AddMemberToList:function(n){var r=$(n).attr("data-id"),i=$(n).text(),t=$("<span data-id="+r+">"+i+"</span>").click(function(){FR.Share.RemoveMember(this)});$("#addedEmail").append(t),$(n).remove(),$("#suggestions").children().length==0&&$("#suggestions").hide(),$("#addedEmail").children().length>1&&($(".notification").hide(),$("#info-watermark").hide())},RemoveMember:function(n){var i=$(n).attr("date-id"),r=$(n).text(),t;$(n).remove(),t=$('<div><div class="members" data-id="'+i+'">'+r+"</div></div>").click(function(){FR.Share.AddMemberToList(this)}),$("#suggestions").append(t),$("#suggestions").show()},SendFriendsReunitedEmail:function(){if(FR.Share.ShowFriendsError()){FR.Util.HideEl("#shareDialogContent");var n=[];$("#addedEmail").children().each(function(){$(this).attr("data-id")!=null&&n.push($(this).attr("data-id"))}),FR.Data.Post(FR.UrlHelper.Urls.Sharing.Friends,[],{BoxKey:$("#BoxKey").val(),MemoryId:$("#MemoryId").val(),MemberIds:n,Message:$("#Message").val()},function(){n.length>1?FR.Notification.Add("Share Sent","Your Friends Reunited shares have been sent successfully.","confirmation"):FR.Notification.Add("Share Sent","Your Friends Reunited share has been sent successfully.","confirmation"),FR.Util.ShowEl("#send-button"),FR.Track.Event(FR.Track.Params.Sharing,"ShareRecommendConfirm"),$(".close").click()})}}};FR.Tour={Hide:function(n,t,i){i.removeClass("tourTargetHighlighted"),n.fadeOut(function(){n.remove()}),t.find("li").fadeOut(function(){t.remove()})},Show:function(){if($("#personalisation-widget").length==0){var i=$("#container"),n=$('<div id="tourShim"><div>').appendTo(i),t=$(".tourTarget");$.ajax({url:"/UI/Tour",context:i,error:function(){n.remove()},success:function(i){var r=$(i);r.on("click","a.tourNext",function(n){n.preventDefault();var f=$(this),u=f.closest("li"),i=u.next("li"),r=$("."+i.attr("id")+"Target");t.removeClass("tourTargetHighlighted"),r.length&&r.addClass("tourTargetHighlighted"),u.fadeOut(),i.fadeIn(),$(window).width()>960&&$("html, body").animate({scrollTop:i.offset().top-100})});r.on("click","a.close,a.tourEnd",function(i){i.preventDefault(),FR.Data.Get(FR.UrlHelper.Urls.Tour.Complete,{}),FR.Tour.Hide(n,r,t)});n.animate({opacity:.33},"fast"),r.hide().appendTo(this).show(),$("html, body").animate({scrollTop:0},800)}})}},Setup:function(){$("#friendsChangedTour").on("click","a",function(n){n.preventDefault(),FR.Tour.Show()})}};FR.Mail={SetupMessageView:function(n,t,i){function e(n){var t=n.MailId,u=n.IsRead,r;FR.Util.HideEl("#message-body"),r=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.LoadMessage,[t,i]),FR.Data.Get(r,{dataType:"html"},function(n){$("#mail-id").val(t),$("#message-body").html(n),f(),o(t,u),FR.Adverts.Refresh(!0),FR.Track.Page("MailPage"),FR.Util.ShowEl("#message-body")})}function f(){r>=s?$(".mail nav .next").parent().hide():$(".mail nav .next").parent().show(),r==0?$(".mail nav .previous").parent().hide():$(".mail nav .previous").parent().show()}function o(t,i){var u,f;i||(u=parseInt($("#mail-inbox-tab span").html(),10),u=u-1,n[r].IsRead=!0,u>0?$("#mail-inbox-tab span").html(u):u<0&&($("#mail-inbox-tab span").remove(),f=$("#mail-inbox-tab a").html(),$("#mail-inbox-tab a").html(f.substring(0,f.length-2))))}for(var s=n.length-1,r=0,u=0;u<n.length;u++)if(n[u].MailId==t){r=u;break}f(),$(".mail nav .next").click(function(){return r=r+1,e(n[r]),!1}),$(".mail nav .previous").click(function(){return r=r-1,e(n[r]),!1})},SelectAll:function(){$(".actions :checkbox").each(function(){$(this).attr("checked",!0),$(this).parent().parent().addClass("deleted")}),$("#selected-all").addClass("hidden"),$("#deselect-all").removeClass("hidden")},DeselectAll:function(){$(".actions :checkbox").each(function(){$(this).attr("checked",!1),$(this).parent().parent().removeClass("deleted")}),$("#deselect-all").addClass("hidden"),$("#selected-all").removeClass("hidden")},DeleteMailIndex:function(n){var r=$("#current-folder").val(),u=$("#current-folder-order").val(),i=[],t;$(".actions :checkbox").each(function(n,t){$(t).is(":checked")&&i.push($(this).prev().val())}),i.length>0&&(i.length>1?(t="Are you sure you want to delete these messages?",r=="Sent"&&(t='<span class="warning">These messages will be</span> permanently deleted and will not be retrievable from the "Deleted" folder.<br/>Are you sure you want to delete these messages?')):(t="Are you sure you want to delete this message?",r=="Sent"&&(t='<span class="warning">This message will be</span> permanently deleted and will not be retrievable from the "Deleted" folder.<br/>Are you sure you want to delete this message?')),$.InlineConfirm(n,".deleted",{message:t,confirmButtonText:"Delete",cancelButtonText:"Cancel",callback:function(){FR.Mail.PostDeleteMail(i,r,u)}}))},DeleteMailView:function(){var t=$("#mail-folder").val(),i=$("#mail-orderby").val(),r=$("#mail-index").val(),n=[];n.push($("#mail-id").val()),messageContent="Are you sure you want to delete this message?",t=="Sent"&&(messageContent='<span class="warning">This message will be</span> permanently deleted and will not be retrievable from the "Deleted" folder.<br/> Are you sure you want to delete this message?'),n.length>0&&$.InlineConfirm($("#delete_button"),$("#message-body"),{message:messageContent,confirmButtonText:"Delete",cancelButtonText:"Cancel",callback:function(){FR.Mail.PostDeleteMail(n,t,i,r)}})},BlockUser:function(n,t){$.InlineConfirm($("#block_button"),$("#message-body"),{message:"Are you sure you want to block this user?",confirmButtonText:"Block",cancelButtonText:"Cancel",callback:function(){FR.Data.Post(FR.UrlHelper.Urls.Relationship.BlockMember,[],{memberId:n},function(n){n&&(window.location.href=t)})}})},PostDeleteMail:function(n,t,i,r){FR.Data.Post(FR.UrlHelper.Urls.MailDelete,[],{selectedMail:n,mailFolder:t,mailOrder:i,currentIndex:r},function(n){window.location.href=n.redirectToUrl})},SaveToDraft:function(){var n=[];$('input[name="MemberIds"]').each(function(){n.push($(this).val())}),FR.Data.Post(FR.UrlHelper.Urls.MailSaveToDraft,[],{Body:$("#Body").val(),Subject:$("#Subject").val(),MemberIds:n,MailId:$("#MailId").val()},function(n){window.location.href=n.redirectToUrl})}};FR.SendMail={friends:"",Init:function(n){friends=n,$("#invitePopup #addButton").click(function(){return FR.SendMail.ValidateAndAddFriend(),!1}),$("#userInput").keyup(function(){FR.SendMail.DisplayMatches()}),$("#suggestions .suggestion").live("click",function(){$("#userInput").val($(this).text()),$("#suggestions").hide(),$("#addButton").trigger("click")}),$("#memberList span").live("click",function(){$(this).parent().remove(),FR.SendMail.DisplayMatches()}),FR.SendMail.DisplayMatches()},DisplayMatches:function(){var t=FR.SendMail.findMatchingFriends($("#userInput").val()),i,n;if(t.length>0){for(i="",n=0;n<t.length;n++)i+='<div><div class="suggestion">'+t[n]+"</div></div>";$("#suggestions").html(i).show()}else $("#suggestions").hide();$("#invitePopup .error").hide()},ValidateAndAddFriend:function(){var i=$("#userInput").val(),r=0,t,n;if(i!==""){for(t=!1,n=0;n<friends.length;n++)i===friends[n].Photo.FullName&&(r=friends[n].Id,t=!0);t?($("#userInput").val(""),FR.SendMail.addToList(i,r),FR.SendMail.DisplayMatches()):$("#invitePopup .error").show()}},findMatchingFriends:function(n){var i=[],t;for(n=n.toLowerCase(),t=0;t<friends.length;t++)friends[t].Photo!=null&&friends[t].Photo.FullName!=null&&(friends[t].Photo.FullName.toLowerCase().indexOf(n)!==0||FR.SendMail.isMemberAlreadyRecipient(friends[t].Id)||i.push(friends[t].Photo.FullName));return i},isMemberAlreadyRecipient:function(n){var t=!1;return $(".recipientArray").each(function(){t||$(this).val()!=n||(t=!0)}),t},addToList:function(n,t){$(".notification").hide();var r="list"+Math.floor(Math.random()*1e7),i='<div id="'+r+'">';i+="<span>"+n+'</span><input type="hidden" name="MemberIds" class="recipientArray" id="MemberIds_'+r+'"value="'+t+'"/>',i+="</div>",$("#memberList").append(i)}};FR.Adverts={Refresh:function(n){try{var u=document.getElementById("top_728x90"),f=document.getElementById("bottom_728x90"),r=document.getElementById("side_160x600"),t=document.getElementById("mpu_300x250"),i=document.getElementById("mpu2_300x250");u!=null&&u.contentDocument.location.reload(!0),r!=null&&r.contentDocument.location.reload(!0),n&&t!=null&&t.contentDocument.location.reload(!0),n&&i!=null&&i.contentDocument.location.reload(!0),f!=null&&f.contentDocument.location.reload(!0)}catch(e){FR.Track.EventWithData(FR.Track.Params.Error,"advert-refresh",{fr_error:e.message})}}};FR.Track={Params:{Ajax:"bsop_ajax",Commercial:"commercial",Login:"splash_login",FBLogin:"splash_fb_login",OpenGraph:"open_graph",AssetPager:"asset_pager",AssetPagerDev:"asset_pager_dev",Box:"box",Newsfeed:"newsfeed",Personalise:"personalise",SchoolFinder:"school_finder",Search:"search",Sharing:"sharing",MorePager:"more_pager",Upload:"upload",Error:"error",Gallery:"gallery",Discussion:"discussion",ScanningStore:"scanning",Recommend:"recommend"},Page:function(n){dataLayer.push({event:"ga-pageview"}),dataLayer.push({event:"ga-event","track-event-category":FR.Track.Params.Ajax,"track-event-action":n})},PageWithData:function(n,t){dataLayer.push({event:"ga-pageview"}),dataLayer.push({event:"ga-event","track-event-category":n,"track-event-action":t})},Event:function(n,t){dataLayer.push({event:"ga-event","track-event-category":n,"track-event-action":t})},EventWithData:function(n,t,i){var r="";$.each(i,function(n,t){r=r+"&"+n+"="+t}),dataLayer.push({event:"ga-event","track-event-category":n,"track-event-action":t,"track-event-label":r,"track-event-data":i})}};FR.Invite={friends:"",matchingList:"",inviteKey:"",Init:function(){$("#invitePopup #addButton").click(function(){return FR.Invite.ValidateAndAddPerson(),!1}),$("#invitePopup form").submit(function(n){if($("#userInput").val()!=""){if(FR.Invite.ValidateAndAddPerson(),$("#memberList span").length<1)return!1}else $("#memberList span").length>0&&($("#inviteSaveButton").addClass("wait"),FR.Invite.ajaxSubmit(n));return!1}),$("#invitePopup form").keydown(function(n){n.which==13&&$("#userInput").val()!=""&&n.preventDefault()}),$("#userInput").keyup(function(n){if(n.which==13)return FR.Invite.ValidateAndAddPerson(),!1;if($(this).val()=="")return $("#suggestions").hide(),!1;FR.Data.Get("/Invite/FriendList?id="+$("#BoxId").val()+"&term="+$(this).val(),{dataType:"json"},function(n){var i,t,r;if(FR.Invite.matchingList=n,i="",n.length>0){for(t=0;t<n.length;t++)n[t].Status==1||n[t].Status==2?(r=n[t].Status==1?"Requested":"Member",i+='<div><div class="userDisabled">'+n[t].FullName+" ["+r+"]</div></div>"):i+='<div><div class="suggestion">'+n[t].FullName+"</div></div>";$("#suggestions").html(i).show()}else $("#suggestions").hide();$("#invitePopup .error").hide()})}),$("#suggestions .suggestion").die("click").live("click",function(){$("#userInput").val($(this).text()),$("#suggestions").hide(),$("#addButton").trigger("click")}),$("#memberList span").live("click",function(){$(this).parent().remove()});$("#cancelWarning").on("click",function(){$("#userInput").val(""),$("#suggestions").hide()})},ValidateAndAddPerson:function(){var f=new RegExp("^([a-zA-Z0-9_\\-\\.\\'\\+\\&]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([a-zA-Z0-9\\-]+\\.)+))([a-zA-Z]{2,6}|[0-9]{1,3})(\\]?)$"),e=$(".emailAddresses"),n=$("#userInput").val(),u=0,r,i,t;if(n!=="")if(r=n.indexOf("@")>-1&&f.test(n),r)$("#userInput").val(""),FR.Invite.addToList(n,0);else{for(i=!1,t=0;t<FR.Invite.matchingList.length;t++)n===FR.Invite.matchingList[t].FullName&&(u=FR.Invite.matchingList[t].Id,i=!0);i?($("#userInput").val(""),FR.Invite.addToList(n,u)):($("#invitePopup .error").show(),$("#suggestions").hide())}},findMatchingFriends:function(n){var i=[],t;for(n=n.toLowerCase(),t=0;t<friends.length;t++)(friends[t].Forename.toLowerCase().indexOf(n)===0||friends[t].Surname.toLowerCase().indexOf(n)===0)&&i.push(friends[t].FullName);return i},addToList:function(n,t){var r="list"+Math.floor(Math.random()*1e7),i='<div id="'+r+'">';i+=t===0?"<span>"+n+'</span><input type="hidden" name="EmailAddresses" id="EmailAddresses_'+r+'" value="'+n+'"/>':"<span>"+n+'</span><input type="hidden" name="MemberIds" id="MemberIds_'+r+'"value="'+t+'"/>',i+="</div>",$("#memberList").append(i)},ajaxSubmit:function(n){n.preventDefault();var i="/Invite/InviteSave",t=$("#invitePopup form").serializeArray();$.post(i,t,function(n){FR.Util.HideEl("#invitePopup"),$("#invitePopup").find(".close").trigger("click"),n.IsSuccess&&(window.location.href=n.ReturnUrl,FR.Notification.Add("Successful",n.Message,"confirmation"))})},enableInvite:function(){var n=$("#invitePopup input[type=submit]");$("#memberList span").length<1?n.attr("disabled","true"):n.removeAttr("disabled")},SetupStandardInviteLink:function(n){$("#inviteLinkButton"+n).on("click",function(){var t=$(this).attr("data-id"),n=$(this).attr("data-return");return $(this).addClass("wait"),FR.Data.Post(FR.UrlHelper.Urls.Invite.Accept,[],{id:t,returnUrl:n},function(n){n.isSuccess?window.location.href=n.redirectUrl:(FR.Notification.Add("Error",n.Message,"warning"),setTimeout(function(){window.location.href=n.redirectUrl},4e3))}),!1})},SetupMoreInviteLink:function(n){$("#inviteLinkButton"+n).on("click",function(){return FR.Invite.inviteKey=$(this).attr("data-id"),FR.Data.Get("/Invite/RenderJoinBoxInvite?boxId="+$(this).attr("data-id")+"&returnUrl="+$(this).attr("data-return"),{},function(n){$("#joinInviteWrapper").html(n),$("#joinInviteDialog").FRdialogue({width:500,cancelCls:"cancel"})}),!1});$("#joinInviteSubmit").die("click").live("click",function(){var i,r;$(this).addClass("wait");var n=parseInt($("input#YearStarted").val()),t=parseInt($("input#YearLeft").val()),u=$("#joinForm #BoxId").val(),f=$("#joinForm #ReturnUrl").val();if(!n||n&&t&&n>t)i=$("#errorPanel ul li"),i.length<2&&$("#errorPanel ul").append('<li><span for="YearStarted" generated="false" class="field-validation-error" style="display: block;">You must provide at least a start year, and this must be before your leaving year.</span></li>'),$("#errorPanelWrapper").show(),$(window).trigger("resize");else return $(this).off("click"),$("#errorPanelWrapper").hide(),FR.Util.HideEl("#joinInviteDialog"),r={Id:u,YearStarted:n,YearLeft:t,ReturnUrl:f},FR.Data.Post(FR.UrlHelper.Urls.AddBoxMember,[],r,function(n){n.isSuccess||(FR.Notification.Add("Error",n.Message,"warning"),setTimeout(function(){window.location.href=n.redirectToUrl},4e3)),window.location.href=n.redirectToUrl}),!1;return!1})}};FR.MemoryEdit={Setup:function(n){var t=$("#media-edit-form").bind("invalid-form.validate",function(){$("#registerErrorPanel").html("You must fill in a valid date.")}).validate({debug:!1,errorElement:"li",errorContainer:$("#registerErrorPanel"),errorPlacement:function(){},rules:{Title:{required:!0,maxlength:250},Year:{required:!0,min:1754,max:2020},Month:{required:!0,min:1,max:12},Day:{required:!0,min:1,max:31}}});$("#update-button").on("click",function(){var f=this,u=[],i,r,t;if($("#media-edit-form").valid()&&($.each($(".kept-boxes-check:not(:checked)"),function(){u.push($(this).attr("data-id"))}),i=[],i=$.map($("#addedTags span"),function(n){return{Id:$(n).attr("data-id"),Name:$(n).text()}}),$("#KeywordJsonString").val(JSON.stringify(i)),$("#BoxesToRemoveFrom").val(u),n))return r=$("#media-edit-form").serialize(),FR.Util.HideEl(".editAsset"),t=$("#ModelId").attr("value"),$("#"+t+" h4 a").text($("#media-edit-form #Title").val()),$("#"+t+" .assetImg a").append('<div class="date">'+$("#media-edit-form #Year").val()+"</div>"),FR.Data.Post("/Media/Edit",{dataType:"json",contentType:"application/x-www-form-urlencoded",jsonify:!1},r,function(n){$(f).trigger("editcomplete",[n.success,n.valid]),$("#editAsset .cancel").trigger("click")}),!1});$(".rotateRight").click(function(){var n=$(this).closest(".thumbnail").find(".shadow img"),t;n.parent().addClass("rotating"),t=$("#hidden-mediaid").val(),FR.Data.Get(FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.Media.Rotate,[t]),{},function(){n.attr("src",n.attr("src")+"?"+Math.random()),n.parent().removeClass("rotating"),$(window).trigger("resize")})}),$("#delete-button").click(function(){var n="Are you sure you want to delete this memory?";return $.InlineConfirm(this,$("#column1"),{message:n,confirmButtonText:"Delete",cancelButtonText:"Cancel",offsetLeft:350,callback:function(){FR.Data.Post(FR.UrlHelper.Urls.MediaDelete,[],{resourceId:$("#hidden-mediaid").val(),boxId:$("#hidden-boxid").val(),isKeepSafe:$("#hidden-isfromkeepsafe").val()},function(n){window.location.href=n.redirectToUrl})}}),!1})}};FR.Keywords={Init:function(n){$(n).bind("contextmenu",function(n){n.preventDefault()}),$(n).bind("paste",function(n){n.preventDefault()})}};FR.Keepsafe={_purchaseableValue:"Buyable",_collapsed:!1,Setup:function(n){var t=FR.Keepsafe;$("#keepsafe-print-banner .purchase-filter").on("click",function(i){i.preventDefault(),$("#privacyOption").val(t._purchaseableValue),FR.Keepsafe.ChangeFilter(n)});$("#search-button").on("click",function(){return FR.Keepsafe.ChangeFilter(n),!1});$("#sortFilter a").on("click",function(t){t.preventDefault();var i=$(this).attr("data-sort");i&&($("#sortFilter li").removeClass("selected"),$(this).parent().addClass("selected"),FR.Keepsafe.ChangeFilter(n))});$("#privacyOption").change(function(){return FR.Keepsafe.ChangeFilter(n),!1}),$("#fromList").change(function(){return FR.Keepsafe.ChangeFilter(n),!1}),$("#toList").change(function(){return FR.Keepsafe.ChangeFilter(n),!1});$(".addMemory").on("click",function(n){n.preventDefault();var t=$(window).width()>FR.MobileWidth;t?$("#memory-add-wrapper").modal({backdrop:"static",remote:FR.UrlHelper.Urls.Keepsafe.Upload}):window.location.href=FR.UrlHelper.Urls.UploadKeepsafe});$(document).on("fr.pager.page",function(){FR.Adverts.Refresh(!1)})},Banner:function(n){var t=FR.Keepsafe;t._collapsed=n;$("#print-banner-collapse").on("click",function(n){n.preventDefault(),t._collapsed?($(".icon-chevron-up").addClass("icon-chevron-down"),$("#keepsafe-list, #keepsafe-print-banner").removeClass("collapsed"),t._collapsed=!1):($(".icon-chevron-up").removeClass("icon-chevron-down"),$("#keepsafe-list, #keepsafe-print-banner").addClass("collapsed"),t._collapsed=!0),FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Keepsafe.BannerToggle,{hidden:t._collapsed}),{},null,function(){})});$("#keepsafe-print-banner").hover(function(){$(".buyTag").addClass("animated swing")},function(){$(".buyTag").removeClass("animated swing")})},ChangeFilter:function(n){var i=FR.Keepsafe,t;$("#mason, .pager").remove(),$("#content").addClass("refreshing"),t={type:$(".tabNav ul li.selected a").attr("data-type"),privacy:$("#privacyOption").val(),dateFrom:$("#fromList").val(),dateTo:$("#toList").val(),skip:0,take:40,showPager:!0,sort:$("#sortFilter li.selected a").attr("data-sort"),keyword:$("#SearchKeyword").val()},t.privacy!=i._purchaseableValue||i._collapsed||$("#print-banner-collapse").click(),FR.Data.Post(n,{dataType:"html"},t,function(n){$("#content").removeClass("refreshing"),$("#keepsafe-list").html(n),FR.Adverts.Refresh(!1),FR.Track.Page("KeepsafeSearch")})},SetupKeepingInViews:function(){return $(".keepButton").click(function(n){var r;n.preventDefault();var t=this,i=$(t).next().val(),e=$(t).attr("data-id");if($(t).hasClass("keep")){$(t).addClass("justKept").addClass("kept").removeClass("keep").html("Joined"),$("#image-kept-count-"+i).text(parseInt($("#image-kept-count-"+i).text())+1);$(t).on("mouseout",function(){$(t).removeClass("justKept")});r=parseInt($("#UserKeepCount").val()),r<=3&&($("#UserKeepCount").val(r+1),FR.Notification.Add("Memory added to Keepsafe","Find this again in your Keepsafe","confirmation"));var o=$(t).attr("data-type"),u=$(t).attr("href"),f=$(t).attr("data-private")=="true";o=="box"?FR.OpenGraph.KeepBox(u,f,function(){}):o=="asset"&&FR.OpenGraph.KeepMemory(u,f,function(){}),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Add,[],{id:e},function(n){n.isSuccess||n.redirectToUrl!=undefined&&(window.location.href=n.redirectToUrl)})}else $(t).hasClass("kept")&&($(t).addClass("keep").removeClass("kept").html("Join"),$("#image-kept-count-"+i).text(parseInt($("#image-kept-count-"+i).text())-1),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Remove,[],{id:e},function(n){n.success||(window.location.href=n.redirectToUrl)}))}),$(".keepButton").hover(function(){$(this).hasClass("kept")&&$(this).html("Unkeep")},function(){$(this).hasClass("kept")&&$(this).html("Kept")}),!1}};FR.Discussions={_pollingTimeout:6e4,SetupDiscussionList:function(){},Setup:function(){$(".topic .info .actions .delete").click(function(){var n=this;return $.InlineConfirm(n,$("#topic-list"),{message:"Are you sure you want to delete this topic and all its replies?",confirmButtonText:"Delete",cancelButtonText:"Cancel",callback:function(){var i=$(n).attr("data-id"),t=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.DeleteTopic,[i]);FR.Data.Post(t,[],null,function(n){n.IsSuccess&&(window.location=n.Url)})}}),!1}),$(".topic .info .actions .edit").click(function(){var n=this,t=$(n).attr("data-id"),r=$(n).closest(".item").find("#BoxId").val(),i;return $("#editComment").remove(),$(n).closest(".item").find("div, p, h3").hide(),$(n).closest(".item").append('<form id="editComment"><input id="Subject" name="Subject" value="" type="text" class="required" maxlength="100" /><textarea class="required" maxlength="5000"></textarea><input type="submit" value="Update" class="primaryButton right" /><input type="button" value="Cancel" class="secondaryButton right" /><div class="clear"></div></form>'),$("#editComment").validate(),$("#editComment .secondaryButton").click(function(){$(n).closest(".item").find("div, p, h3").show(),$("#editComment").remove()}),i=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.LoadEditTopic,[t]),FR.Data.Get(i,{dataType:"json"},function(n){$("#editComment input#Subject").val(n.Subject),$("#editComment textarea").val(n.Message),FR.Util.AttachInlineCount($("#editComment input#Subject"),{count:100,expandable:!1}),FR.Util.AttachInlineCount($("#editComment textarea"),{count:5e3,expandable:!0}),$("#editComment textarea").trigger("keypress").focus(),FR.Adverts.Refresh(!0),FR.Track.Page("TopicEdit")}),$("#editComment").submit(function(){if($(this).valid()){var f=this,e=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.EditTopic,[t]),i=$("#editComment input#Subject").val(),u=$("#editComment textarea").val();FR.Data.Post(e,[],{discussionId:t,boxId:r,subject:i,message:u},function(t){t.IsSuccess&&($(n).closest(".item").find("p:eq(0)").html(t.Message),$(n).closest(".item").find("h3:eq(0)").html(t.Subject),FR.Adverts.Refresh(!0),FR.Track.Page("TopicEdit"))}),$(n).closest(".item").find("p:eq(0)").text(u),$(n).closest(".item").find("h3:eq(0)").text(i),$(n).closest(".item").find("div, p, h3").show(),$(f).remove()}return!1}),!1})},SetupReplies:function(n){function t(){if($(".commmentSortTabs .reply-tab.selected").hasClass("newest")){var i=FR.UrlHelper.UrlQueryBuilder("/Discussion/NewReplies",{timestamp:$("#reply-timestamp").val(),id:n});FR.Data.Get(i,{},function(n){var i=$(n),r;$("#reply-timestamp").remove(),r=$("#replies-list .reply-item"),r.length>0?$("#replies-list .reply-item").last().after(i):$("#replies-list").prepend(i),$(".reply-item",i).length>0&&($("#new-replies-btn").fadeIn(),FR.Track.Event(FR.Track.Params.Discussion,"NewRepliesAvailable")),setTimeout(function(){t()},FR.Discussions._pollingTimeout)},function(){})}}$("#topic-list .pager-refresh-target").on("click",".actions .delete",function(){var n=this;return $.InlineConfirm(n,$(n).closest(".item"),{message:"Are you sure you want to delete this reply?",confirmButtonText:"Delete",cancelButtonText:"Cancel",callback:function(){var i=$(n).attr("data-id"),t=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.DeleteReply,[i]);FR.Data.Post(t,[],null,function(t){t.IsSuccess&&($(n).closest(".item").fadeOut(function(){$(n).remove()}),FR.Adverts.Refresh(!0),FR.Track.Page("ReplyDelete"))})}}),!1});$("#topic-list .pager-refresh-target").on("click",".actions .edit",function(){var n=this,t=$(n).attr("data-id"),i;return $("#editReply").remove(),$(n).closest(".item").find("div, p, h3").hide(),$(n).closest(".item").append('<form id="editReply"><textarea class="required" maxlength="5000"></textarea><input type="submit" value="Update" class="primaryButton right" /><input type="button" value="Cancel" class="secondaryButton right" /><div class="clear"></div></form>'),$("#editReply").validate(),$("#editReply .secondaryButton").click(function(){$(n).closest(".item").find("div, p").show(),$("#editReply").remove()}),i=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.LoadEditReply,[t]),FR.Data.Get(i,{dataType:"json"},function(n){$("#editReply textarea").val(n.Message),FR.Util.AttachInlineCount($("#editReply textarea"),{count:5e3,expandable:!0}),FR.Adverts.Refresh(!0),FR.Track.Page("ReplyEdit")}),$("#editReply").submit(function(){if($(this).valid()){var r=this,u=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.EditReply,[t]),i=$("#editReply textarea").val();FR.Data.Post(u,[],{replyid:t,message:i},function(t){t.IsSuccess&&$(n).closest(".item").find("p:eq(0)").html(t.Message),FR.Adverts.Refresh(!0),FR.Track.Page("ReplyEdit")}),$(n).closest(".item").find("p:eq(0)").text(i),$(n).closest(".item").find("div, p").show(),$(r).remove()}return!1}),!1});$(".commmentSortTabs .reply-tab.selected").hasClass("newest")&&setTimeout(function(){t()},FR.Discussions._pollingTimeout);$("#topic-list .pager-refresh-target").on("click","#new-replies-btn",function(n){n.preventDefault(),$(".new-hidden-replies").show().removeClass(".new-hidden-replies"),$(this).fadeOut(),FR.Track.Event(FR.Track.Params.Discussion,"NewRepliesShown"),FR.Adverts.Refresh(!0)});$("#topic-list .pager-refresh-target").on("click",".btnViewReply",function(n){n.preventDefault(),FR.Discussions.ShowFlaggedMessage(this)});$("#topic-list .pager-refresh-target").on("click",".btn-hide-reply",function(n){n.preventDefault(),FR.Discussions.HideFlaggedMessage(this)});$(".commmentSortTabs .reply-tab").on("click",function(n){n.preventDefault();var i=this;$(".commmentSortTabs .selected").removeClass("selected"),$("#replies-list .reply-item").removeClass("marker").removeClass("markerBottom"),$(i).addClass("selected"),$(i).hasClass("newest")?(setTimeout(function(){t()},FR.Discussions._pollingTimeout),FR.Data.Get($(i).attr("href"),{},function(n){$("#replies-list").replaceWith(n)}),FR.Track.PageWithData(FR.Track.Params.Discussion,"SwitchTabNewest")):($("#new-replies-btn").hide(),FR.Data.Get($(i).attr("href"),{},function(n){$("#replies-list").replaceWith(n)}),FR.Track.PageWithData(FR.Track.Params.Discussion,"SwitchTabOldest")),FR.Adverts.Refresh(!0)});$("#topic-list").on("click",".showMore.sortNewest",function(n){n.preventDefault();var t=this;$("#replies-list .reply-item").removeClass("markerBottom").last().addClass("markerBottom"),FR.Data.Get($(t).attr("href"),{},function(n){$("#more-replies-url").remove(),$("#replies-list .reply-item").last().after(n),$("#more-replies-url").length>0?$(t).attr("href",$("#more-replies-url").attr("data-href")):$(t).hide()}),FR.Track.PageWithData(FR.Track.Params.Discussion,"ShowMoreNewest"),FR.Adverts.Refresh(!0)});$("#topic-list").on("click",".showMore.sortOldest",function(n){n.preventDefault();var t=this;$("#replies-list .reply-item").removeClass("marker").first().addClass("marker"),FR.Data.Get($(t).attr("href"),{},function(n){$("#more-replies-url").remove(),$("#replies-list .reply-item").first().before(n),$("#more-replies-url").length>0?$(t).attr("href",$("#more-replies-url").attr("data-href")):$(t).hide()}),FR.Track.PageWithData(FR.Track.Params.Discussion,"ShowMoreOldest"),FR.Adverts.Refresh(!0)});$("#commmentSortTabs .reply-tab-disabled").on("click",function(n){n.preventDefault()})},SetupTopicCreate:function(){$("#create-box-join a.primaryButton").html($(".box-join-default-button").html());$("#subTopic").on("click",function(){$(this).addClass("wait")});FR.Util.AttachInlineCount($("#newTopicForm #Subject"),{count:100,expandable:!1,toggleCount:!1}),FR.Util.AttachInlineCount($("#newTopicForm #Message"),{count:5e3,expandable:!0,toggleCount:!1})},SetupTopicReply:function(){$("#create-box-join a.primaryButton").html($(".box-join-default-button").html());$("#newTopicReplyForm .primaryButton").on("click",function(){$("#newTopicReplyForm").valid()&&$(this).addClass("wait")});FR.Util.AttachInlineCount($("#newTopicReplyForm #Message"),{count:5e3,expandable:!0})},SetupSearch:function(){$("#topic-search-form").submit(function(){return FR.Discussions.Search(),!1}),$(".clear-search").live("click",function(){return $("#Keywords",$("#topic-search-form")).val(""),FR.Discussions.Search(),!1});$(document).on("bocagrande.pager.page",function(){FR.Adverts.Refresh(!0)});$(document).on("bocagrande.pager.load",function(n,t){t&&(t.keywords?$("#Keywords",$("#topic-search-form")).val(unescape(t.keywords)):$("#Keywords",$("#topic-search-form")).val("")),FR.Adverts.Refresh(!0),FR.Track.Page("TopicSearch")})},Search:function(){var n={keywords:$("#Keywords",$("#topic-search-form")).val(),page:1,pager:!0};BocaGrande.Pager.SetFilter(n)},HidePager:function(){$(".pager").addClass("hidden")},ShowFlaggedMessage:function(n){var t=$(n).closest(".reply-item").removeClass("awaiting").addClass("showReported");$(".reply-hidden",t).hide(),$(".reply-content",t).fadeIn(),FR.Adverts.Refresh(!0),FR.Track.Event(FR.Track.Params.Discussion,"ShowFlaggedMessage")},HideFlaggedMessage:function(n){var t=$(n).closest(".reply-item").addClass("awaiting").removeClass("showReported");$(".reply-content",t).fadeOut(),$(".reply-hidden",t).show(),FR.Adverts.Refresh(!0),FR.Track.Event(FR.Track.Params.Discussion,"HideFlaggedMessage")}};FR.Discussions.Newsfeed={SetupReply:function(n){FR.Util.AttachInlineCount($("#newsfeedReplyForm-"+n+" #Message"),{count:5e3,expandable:!0}),$("#newsfeedReplyForm-"+n).submit(function(t){t.preventDefault();var i={Id:n,Message:this.Message.value};this.Message.value="",FR.Data.Post("/Discussion/SaveNewsfeedReply",{dataType:"html"},i,function(n){$("#Newsfeeditem-"+i.Id).html(n)})})}};FR.BoxButton={privateBoxKey:"",returnUrl:"",SetupMemoryButton:function(){$("#memoryButton").on("click",function(n){var t,u,r,i;n.preventDefault(),t=$(this).attr("data-id"),u=$(this).attr("data-valid"),u=="True"?(r=$(window).width()>FR.MobileWidth,r?(i=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.Box.Upload,[t]),$("#memory-add-wrapper").modal({backdrop:"static",remote:i})):window.location.href=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.UploadBox,[t])):window.location.href=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.Validation,[])})},SetupInvitePrivateButton:function(){$("#invitePrivateButton").on("click",function(){return FR.BoxButton.privateBoxKey=$(this).attr("data-id"),FR.BoxButton.returnUrl=$(this).attr("data-return"),$("#invite-control-Dialog").FRdialogue({width:500,cancelCls:"cancel",originEl:$(this)}),!1});return $("#joinPrivateSubmit").live("click",function(){var i=FR.BoxButton.privateBoxKey,t=FR.BoxButton.returnUrl,n=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.Invite.Invite,[i,t]);return FR.Data.Get(n,{},function(n){$("#invite-control-Dialog #cancelWarning").trigger("click"),$("#invite-popup-Dialog").html(n),$("#invitePopup").FRdialogue()}),!1}),!1},SetupInviteButton:function(){$("#inviteButton").on("click",function(){if($("#invite-controll-wrapper").html()===""){var i=$(this).attr("data-id"),t=$(this).attr("data-return"),n=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.Invite.Invite,[i,t]);FR.Data.Get(n,{},function(n){if($("#invite-controll-wrapper").html(n),$("#invitePopup").FRdialogue(),$("body.mobile").length>0)return!1;$("#userInput").focus()})}else{if($("#memberList span").parent().remove(),$("#invitePopup").FRdialogue(),$("body.mobile").length>0)return!1;$("#userInput").focus()}return!1})},SetupStandardKeepButton:function(){$("#boxKeepButton").on("click",function(n){n.preventDefault();var i=$(this).attr("data-id"),t=$(this).attr("data-return"),r=$(this).attr("data-private")=="true";$(this).addClass("wait"),FR.OpenGraph.KeepBox(t,r,function(){FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Add,[],{id:i,returnUrl:t},function(n){FR.Track.EventWithData(FR.Track.Params.Box,"keep",{key:i}),setTimeout(function(){window.location.href=n.redirectUrl},500)},function(){$(this).removeClass("wait"),FR.Util.ErrorButton("#boxKeepButton","Error",FR.UrlHelper.Urls.Errors.Generic)})})})},SetupShowMoreInfoButton:function(){FR.Track.EventWithData(FR.Track.Params.Box,"MissingYearPrompt",{key:$("#joinFormAlreadyKept #Id").val()}),$("#joinDialogAlreadyKept").modal({});$("#joinDialogAlreadyKept .cancel").one("click",function(){$("#joinDialogAlreadyKept .close").click()});$("#joinSubmitAlreadyKept").on("click",function(){var t;if($("#joinFormAlreadyKept").valid()){var u=parseInt($("input#YearStarted").val()),r=parseInt($("input#YearLeft").val()),f=$("#joinFormAlreadyKept #Id").val(),i=$("#joinFormAlreadyKept #ReturnUrl").val();$(this).off("click"),FR.Util.HideEl("#joinDialogAlreadyKept"),t={Id:f,YearStarted:u,YearLeft:r,ReturnUrl:i},FR.Data.Post(FR.UrlHelper.Urls.AddStartEndYearInfo,[],t,function(n){window.location.href=n.redirectToUrl})}return!1})},SetupMoreInfoKeepButton:function(){var t=!1,n="";$("#boxKeepButton, #memoryButton").on("click",function(i){i.preventDefault();var r=this;FR.OpenGraph.KeepBox(window.location.href,!1,function(){t=$(r).attr("id")=="memoryButton",n=$(r).attr("data-id"),$("#joinDialog").modal({backdrop:"static"})})});$("#joinSubmit").live("click",function(){var i,r;return $("#joinForm").valid()&&($(this).off("click"),i=$("#joinForm #Id").val(),FR.Util.HideEl("#joinDialog"),r={Id:i,YearStarted:parseInt($("input#YearStarted").val()),YearLeft:parseInt($("input#YearLeft").val()),ReturnUrl:$("#joinForm #ReturnUrl").val()},FR.Data.Post(FR.UrlHelper.Urls.AddBoxMember,[],r,function(r){FR.Track.EventWithData(FR.Track.Params.Box,"keep",{key:i}),t?($("#joinDialog .close").click(),$("#memory-add-wrapper").FRdialogue({width:500,cbFunction:function(){var t=FR.UrlHelper.UrlBuilder(FR.UrlHelper.Urls.Box.Upload,[n]);FR.Data.Get(t,{},function(n){$("#upload-container").html(n).removeClass("init"),$("#memory-add-wrapper").FRdialogue("reposition")})}})):setTimeout(function(){window.location.href=r.redirectToUrl},500)})),!1})},SetupUnKeepButton:function(){$("#boxKeptButton").on("click",function(n){n.preventDefault();var t=this;$("#unkeep-dialog").modal({backdrop:"static"});$("#unkeep-dialog #unkeep-confirm").on("click",function(n){n.preventDefault(),$("#unkeep-dialog").modal("hide"),$(this).off("click");var i={id:$(t).attr("data-id"),returnUrl:$(t).attr("data-return")};FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Remove,{},i,function(n){n.success&&n.returnUrl&&(window.location.href=n.returnUrl)})})});$("#boxKeptButton").hover(function(){$(this).hasClass("kept")&&$(this).html("Leave")},function(){$(this).hasClass("kept")&&$(this).html("Joined")})}};FR.Memory={Setup:function(){$(".change-memory-sort a").on("click",function(){var n=$(this).attr("data-sort");return n&&($(".change-memory-sort li").removeClass("selected"),$(this).parent().addClass("selected"),FR.Memory.GetBoxMemories()),!1});$("#categoryList").change(function(){return FR.Memory.GetBoxMemories(),!1}),$("#fromList").change(function(){var n=$(this).val();return FR.Memory.GetBoxMemories(),!1}),$("#toList").change(function(){var n=$(this).val();return FR.Memory.GetBoxMemories(),!1})},GetBoxMemories:function(){var n,i,t;$("#gridView").css("visibility","hidden"),$("#gridLoading").show(),n=$("#categoryList").val(),n=="Merchandisable"&&(n="All",i=!0),t={BoxId:$("#hdnBoxId").val(),MemoryType:n,FromYear:$("#fromList").val(),ToYear:$("#toList").val(),OrderBy:$(".change-memory-sort li.selected a").attr("data-sort"),Skip:0,Take:40,IncludePager:!0,CheckIsMerchandisable:i},FR.Data.Post(FR.UrlHelper.Urls.Box.GetMemoryList,{dataType:"html"},t,function(n){$("#memoryList").html(n),$("#gridView").css("visibility","visible"),$("#gridLoading").hide(),FR.Adverts.Refresh(!1),FR.Track.Page("AssetSearch")})},GetMemberMemories:function(){FR.Util.HideEl("#memories");var n={MemberId:$("#hdnMemberId").val(),EncodedId:$("#hdnEncodedId").val(),MemoryType:$("#hdnShow").val(),DateFrom:$("#selDateFrom").val(),DateTo:$("#selDateTo").val(),OrderBy:$("#hdnSort").val(),Skip:0,Take:40,IncludePager:!0};FR.Data.Post(FR.UrlHelper.Urls.GetMemoryListMember,{dataType:"html"},n,function(n){if($("#memoryList").html(n),FR.Util.ShowEl("#memories"),FR.Adverts.Refresh(!1),FR.Track.Page("AssetSearch"),$(".mobile").length>0&&$(".ipad").length==0)return!1;$("#gridView").masonry({itemSelector:".item",columnWidth:240,cornerStampSelector:".corner-stamp",isAnimated:!0})})},Layout:function(){function n(){setTimeout(function(){$("#csHolder").height()!=t&&($(window).trigger("resize"),t=$("#csHolder").height()),n()},500)}if($("#empty-box").length>0)return $("#gridLoading").hide(),$("#gridView").css("visibility","visible"),!1;!$("body.mobile").length>0?$("#gridView").masonry({itemSelector:".item",columnWidth:240,cornerStampSelector:".corner-stamp",isAnimated:!0}):$(".corner-stamp").remove();var t=$("#csHolder").height();n()}};BocaGrande.Memory={Setup:function(n){FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Box.ActivityModule,{boxId:n}),{},function(n){$("#box-activity-wrapper").html(n)},function(){});$(".change-memory-sort a").on("click",function(n){n.preventDefault();var t=$(this).attr("data-sort");t&&($(".change-memory-sort li").removeClass("selected"),$(this).parent().addClass("selected"),BocaGrande.Memory.GetBoxMemories())});$(".filter-control").change(function(n){n.preventDefault(),BocaGrande.Memory.GetBoxMemories()});$(document).on("bocagrande.pager.page",function(){FR.Adverts.Refresh(!1)});$(document).on("bocagrande.pager.load",function(n,t){t&&(t.sort?($(".change-memory-sort li").removeClass("selected"),$(".change-memory-sort a[data-sort="+t.sort+"]").parent().addClass("selected")):($(".change-memory-sort li").removeClass("selected"),$(".change-memory-sort a[data-sort=Latest]").parent().addClass("selected")),t.type?$("#categoryList").val(t.type):$("#categoryList").val(""),t.from?$("#fromList").val(t.from):$("#fromList").val(""),t.to?$("#toList").val(t.to):$("#toList").val(""),FR.Adverts.Refresh(!1))})},GetBoxMemories:function(){$("#gridView").css("visibility","hidden"),$("#gridLoading").show();var n={type:$("#categoryList").val(),from:$("#fromList").val(),to:$("#toList").val(),sort:$(".change-memory-sort li.selected a").attr("data-sort"),page:1,pager:!0};BocaGrande.Pager.SetFilter(n)},Layout:function(){function n(){setTimeout(function(){$("#csHolder").height()!=t&&($(window).trigger("resize"),t=$("#csHolder").height()),n()},500)}if($("#empty-box").length>0)return $("#gridLoading").hide(),$("#gridView").css("visibility","visible"),!1;!$("body.mobile").length>0?$("#gridView").masonry({itemSelector:".item",columnWidth:1,cornerStampSelector:".corner-stamp",isAnimated:!0}):$(".corner-stamp").remove();var t=$("#csHolder").height();n()}};FR.Account={ToggleLink:function(){function n(n){$(n).slideToggle(500)}$("div#account-details a#lnkChangeEmail").click(function(t){t.preventDefault(),n("div#account-details div#ChangeEmail")}),$("div#account-details a#lnkChangePass").click(function(t){t.preventDefault(),n("div#account-details div#ChangePassword")}),$("div#account-details a#lnkChangeEmailPreference").click(function(t){t.preventDefault(),n("div#account-details div#ChangeEmailPreference")}),$("div#account-details a#lnkChangePersonal").click(function(t){t.preventDefault(),n("div#account-details div#ChangePersonal")}),$("#lnkFacebookPreferences").click(function(t){t.preventDefault(),n("#FacebookPreferences")}),$("div#account-details a#lnkUnregister").click(function(t){t.preventDefault(),n("div#account-details div#UnregisterAccount")}),$("div#account-details a#lnkManageBlockedPeople").click(function(t){t.preventDefault(),n("div#account-details div#ManageBlockedPeople")}),$(".cancel.secondaryButton.unregister").click(function(t){t.preventDefault(),n("div#account-details div#UnregisterAccount")}),$(".cancel.secondaryButton.email").click(function(t){t.preventDefault(),n("div#account-details div#ChangeEmail")}),$(".cancel.secondaryButton.preference").click(function(t){t.preventDefault(),n("div#account-details div#ChangeEmailPreference")}),$(".cancel.secondaryButton.facebook").click(function(t){t.preventDefault(),n("#FacebookPreferences")}),$(".cancel.secondaryButton.account").click(function(t){t.preventDefault(),n("div#account-details div#ChangePersonal")}),$(".cancel.secondaryButton.password").click(function(t){t.preventDefault(),n("div#account-details div#ChangePassword")})}};FR.BoxSearch={Setup:function(){function n(n){$(n).val()==FR.Constants.HomeTownsVal&&($("#boxsortList li").removeClass("selected"),$("#boxsortList a[data-sort="+FR.Constants.SortOrderNewVal+"]").parent().addClass("selected"))}$("#box-search-form").submit(function(){return FR.BoxSearch.GetData(),FR.BoxSearch.SetTitle(),!1}),FR.BoxSearch.SetTitle();$("#categoryList").on("change",function(t){t.preventDefault(),n(this),FR.BoxSearch.GetData(),FR.BoxSearch.SetTitle(),FR.BoxSearch.UpdateRememberWhen()});$("#boxsortList a").on("click",function(n){n.preventDefault();var t=$(this).attr("data-sort");t&&($("#boxsortList li").removeClass("selected"),$(this).parent().addClass("selected"),FR.BoxSearch.GetData(),FR.BoxSearch.SetTitle())});$("#searchGo").on("click",function(n){n.preventDefault(),FR.BoxSearch.GetData(),FR.BoxSearch.SetTitle()});$(document).on("bocagrande.pager.page",function(){FR.Adverts.Refresh(!1)});$(document).on("bocagrande.pager.load",function(n,t){t&&(t.Category!=null?t.Category>0?$("#categoryList").val(t.Category):$("#categoryList")[0].selectedIndex=0:$("#categoryList")[0].selectedIndex=0,t.sort?($("#boxsortList li").removeClass("selected"),$("#boxsortList a[data-sort="+t.sort+"]").parent().addClass("selected")):($("#boxsortList li").removeClass("selected"),$("#boxsortList a[data-sort=Relevant]").parent().addClass("selected")),t.keywords?$("#search-keywords").val(unescape(t.keywords)):$("#search-keywords").val(""),t.start&&FR.BoxSearch.SetAlphaPager(t.start)),FR.BoxSearch.SetTitle(),FR.BoxSearch.Results(),FR.Adverts.Refresh(!1),FR.Track.Event(FR.Track.Params.Search,"BoxSearch")})},Results:function(){!$("body.mobile").length>0?$("#gridView").masonry({itemSelector:".item",columnWidth:240,cornerStampSelector:".corner-stamp",isAnimated:!0}):$(".corner-stamp").remove()},ConfigureAlpha:function(){$(".alpha a").on("click",function(n){n.preventDefault(),FR.BoxSearch.GetData($(this).html()),FR.BoxSearch.SetTitle()})},SetAlphaPager:function(n){$(".alpha a").removeClass("selected"),$(".alpha a").each(function(){$(this).html()==n&&$(this).addClass("selected")})},UpdateRememberWhen:function(){var n={category:$("#categoryList").val(),boxKey:null}},SetTitle:function(){var n;n=$("#categoryList option:selected").text(),$("#category-name").text($("#search-keywords").val())},GetData:function(){FR.Util.HideEl("#boxList");var i=(new Date).getFullYear(),t={Category:$("#categoryList").val(),BoxType:$("#BoxType").val(),sort:$("#boxsortList li.selected a").attr("data-sort"),keywords:$("#search-keywords").val(),from:1900,to:i,start:"",page:1,pager:!0};BocaGrande.Pager.SetFilter(t)}};FR.Box.Chat={_pollingTimeout:8e3,BoxId:"",Polling:!1,LastMessageId:0,UserName:"",LastMsg:"",Processing:!1,Setup:function(n,t){FR.Box.Chat.UserName=t,FR.Box.Chat.BoxId=n,$("#chatWindow").css({position:"absolute",top:"auto",height:$(window).height()-5}),$("#chatUserWindow").css({position:"absolute",top:"auto",height:$(window).height()-5}),$("#messageList").height($("#chatWindow").height()-80),$("#userList").height($("#chatUserWindow").height()-60),$(window).resize(function(){$("#chatWindow").css({position:"absolute",top:"auto",height:$(window).height()-5}),$("#chatUserWindow").css({position:"absolute",top:"auto",height:$(window).height()-5}),$("#messageList").height($("#chatWindow").height()-80),$("#userList").height($("#chatUserWindow").height()-60)}),$(".fr_status").click(function(n){n.preventDefault(),$(".fr_chatOptions").toggle()}),$("#chatInput").keydown(function(n){n.keyCode==13&&(n.preventDefault,$("#sendmessage").click())}),$(".fr_onlineOption").click(function(n){n.preventDefault(),$(".fr_chatOptions").toggle(),FR.Box.Chat.DisableChat()}),FR.Box.Chat.EnableChat()},OnlineCount:function(n){FR.Data.Get("/Chat/Chat?boxId="+n,{},function(n){$("#chat-user-count").html(n)},function(){}),setTimeout(function(){FR.Box.Chat.OnlineCount(n)},3e4)},EnableChat:function(){var n={boxid:FR.Box.Chat.BoxId};FR.Data.Post("/Chat/SignOnChat",[],n,function(n){FR.Box.Chat.Polling==!1,FR.Box.Chat.chatStatus=0,$("#chatWindow").show(),$("#chatUserWindow").show(),$(".fr_userBar .fr_info").hide(),$(".fr_status").removeClass("fr_status-offline"),$(".fr_onlineOption").text("Disconnect from this groups chat"),FR.Box.Chat.Polling=!0,$("#sendmessage").click(function(n){FR.Box.Chat.Processing=!0,n.preventDefault();var t={boxid:FR.Box.Chat.BoxId,message:$("#chatInput").val().replace("\n",""),lastmessageid:FR.Box.Chat.LastMessageId};if(FR.Data.LastMsg==t.message){FR.Box.Chat.Processing=!1;return}FR.Data.LastMsg=t.message,$("#messageList").append("<li><strong>"+FR.Box.Chat.htmlEncode("You")+"</strong> "+FR.Box.Chat.htmlEncode(t.message)+"</li>"),$("#messageList").scrollTop($("#messageList").prop("scrollHeight")),FR.Data.Post("/Chat/SendChat",[],t,function(n){FR.Box.Chat.ChatResult(n)}),$("#chatInput").val("").focus(),FR.Box.Chat.Processing=!1}),FR.Box.Chat.ChatResult(n)})},ChatResult:function(n){var t,e,i,r,u,f;if(FR.Box.Chat.Processing=!0,n.isSuccess==!0){for(i=0;i<n.model.ChatMessages.length;i++)t=n.model.ChatMessages[i],t.Message!=FR.Box.Chat.LastMsg&&(t.Name==FR.Box.Chat.UserName&&(t.Name="You"),e=new Date(parseInt(t.MessageTimeUTC.substr(6))),$("#messageList").append("<li><strong>"+FR.Box.Chat.htmlEncode(t.Name)+"</strong> "+FR.Box.Chat.htmlEncode(t.Message)+'<span class="_utctime">'+e.toLocaleTimeString().substr(0,8)+"</span></li>"),FR.Box.Chat.LastMsg=t.Message);if(n.model.ChatMessages.length>0&&$("#messageList").scrollTop($("#messageList").prop("scrollHeight")),n.model.ChatUsers.length>0){for($("#userList").empty(),i=0;i<n.model.ChatUsers.length;i++)r=n.model.ChatUsers[i],u="",FR.Box.Chat.PopOut&&(u=" target='_blank' "),f='<li><a class="privateMessageLink"'+u+' href="'+r.ProfileUrl+'"><img class="_avatar" src="'+r.ProfilePhoto.Url+'"><span class="_username">'+r.Fullname+"</span></a></li>",$("#userList").append(f);$("#chatUserWindow .chatTitle").text("Groups Members Online ("+n.model.ChatUsers.length+")")}FR.Box.Chat.LastMessageId=n.model.LastMessageId,FR.Box.Chat.Polling==!0,setTimeout(function(){FR.Box.Chat.GetLatestChat()},FR.Box.Chat._pollingTimeout)}else FR.Box.Chat.DisableChat();FR.Box.Chat.Processing=!1},htmlEncode:function(n){return $("<div />").text(n).html()},DisableChat:function(){FR.Box.Chat.Polling=!1;var n={boxid:FR.Box.Chat.BoxId};FR.Data.Post("/Chat/SignOffChat",[],n,function(){FR.Box.Chat.chatStatus=2,FR.Box.Chat.Polling=!1,$("#chatWindow").hide(),$("#chatUserWindow").hide(),$(".fr_userBar .fr_info").show(),$(".fr_status").addClass("fr_status-offline"),$(".fr_onlineOption").text("Connect to this groups chat"),window.close()})},GetLatestChat:function(){if(FR.Box.Chat.Polling==!0&&FR.Box.Chat.Processing==!1){var n={boxid:FR.Box.Chat.BoxId,lastmessageid:FR.Box.Chat.LastMessageId};FR.Data.Post("/Chat/PollChat",[],n,function(n){FR.Box.Chat.ChatResult(n)},function(){})}}};FR.Box.Newsfeed={cnt:0,Setup:function(n){var r=40,u=1,t=!1,i=!1;$("#moreNewsfeed").click(function(f){if((f.preventDefault(),!t)&&!i){$("#moreNewsfeed").addClass("wait");var e=u*r;t==!0,u++,FR.Data.Get("/Newsfeed/BoxMemoryStream?boxId="+n+"&skip="+e+"&take="+r,{},function(n){n?(t=!1,$("#memoryStreamBody").append(n)):(i=!0,$("#moreNewsfeed").hide()),$("#moreNewsfeed").removeClass("wait")},function(){t=!1,$("#moreNewsfeed").removeClass("wait")})}})},JPFix:function(){FR.Data.Get("/Discussion/JPFix?flag="+FR.Box.Newsfeed.cnt,{},function(){FR.Box.Newsfeed.cnt=0,FR.Box.Newsfeed.JPFix()},function(){FR.Box.Newsfeed.cnt=FR.Box.Newsfeed.cnt==1?999:1,FR.Box.Newsfeed.JPFix()})}};FR.Box.Event={EmailsSent:0,Processing:!1,EventId:0,Setup:function(){$("#send-invites").click(function(n){n.preventDefault(),FR.Box.Event.SendInvites($(this).data("id"))})},SendInvites:function(n){FR.Box.Event.EventId=n;var t={eventid:n};$("#send-invites").addClass("wait"),FR.Data.Post("/BoxEvent/SendInvite",[],t,function(n){FR.Box.Event.EmailsSent=FR.Box.Event.EmailsSent+n.InvitesSent,$("#send-invites-count").html(FR.Box.Event.EmailsSent),n.InvitesSent>0?FR.Box.Event.SendInvites(FR.Box.Event.EventId):($("#send-invites").removeClass("wait"),$("#send-invites-count").html("Finished : - "+FR.Box.Event.EmailsSent+" invites sent"))})}};FR.Asset=FR.Asset||{},FR.Asset.Search={Setup:function(n){function t(n){$(n).val()==FR.Constants.HomeTownsVal&&($("#boxsortList li").removeClass("selected"),$("#boxsortList a[data-sort="+FR.Constants.SortOrderNewVal+"]").parent().addClass("selected"))}$("#asset-search-form").submit(function(){return FR.Asset.Search.GetData(),FR.Asset.Search.SetTitle(),!1}),FR.Asset.Search.SetTitle();$("#assetTypeList").on("change",function(n){n.preventDefault(),FR.Asset.Search.GetData(),FR.Asset.Search.SetTitle()});$("#fromList").on("change",function(n){n.preventDefault(),FR.Asset.Search.GetData(),FR.Asset.Search.SetTitle()});$("#toList").on("change",function(n){n.preventDefault(),FR.Asset.Search.GetData(),FR.Asset.Search.SetTitle()});$("#searchGo").on("click",function(n){n.preventDefault(),FR.Asset.Search.GetData(),FR.Asset.Search.SetTitle()});$("#assetSortList a").on("click",function(n){n.preventDefault();var t=$(this).attr("data-sort");t&&($("#assetSortList li").removeClass("selected"),$(this).parent().addClass("selected"),FR.Asset.Search.GetData(),FR.Asset.Search.SetTitle())});$("#categoryList").on("change",function(i){i.preventDefault(),t(this),$(this).val()!=0?FR.BoxSearch.GetSubCategoryList(n,$(this).val(),function(){FR.Asset.Search.GetData(),FR.Asset.Search.SetTitle()}):FR.BoxSearch.SetSubCategoryListToEmpty(function(){FR.Asset.Search.GetData(),FR.Asset.Search.SetTitle()})});$("#subcategoryList").on("change",function(n){n.preventDefault(),t(this),FR.Asset.Search.GetData(),FR.Asset.Search.SetTitle()});$(document).on("bocagrande.pager.page",function(){FR.Adverts.Refresh(!1)});$(document).on("bocagrande.pager.load",function(t,i){if(i){var r=!1;i.category!=null?(r=$("#categoryList").val()!=i.category,i.category>0?$("#categoryList").val(i.category):$("#categoryList")[0].selectedIndex=0):$("#categoryList")[0].selectedIndex=0,r?i.category!=0?FR.BoxSearch.GetSubCategoryList(n,i.category,function(){i.subcategory?$("#subcategoryList").val(i.subcategory):$("#subcategoryList")[0].selectedIndex=0,FR.Asset.Search.SetTitle()}):FR.BoxSearch.SetSubCategoryListToEmpty(function(){FR.Asset.Search.SetTitle()}):i.subcategory?$("#subcategoryList").val(i.subcategory):$("#subcategoryList")[0].selectedIndex=0,i.type?$("#assetTypeList").val(i.type):$("#assetTypeList")[0].selectedIndex=0,i.sort?($("#assetSortList li").removeClass("selected"),$("#assetSortList a[data-sort="+i.sort+"]").parent().addClass("selected")):($("#assetSortList li").removeClass("selected"),$("#assetSortList a[data-sort=Relevant]").parent().addClass("selected")),i.keywords?$("#search-keywords").val(unescape(i.keywords)):$("#search-keywords").val(""),i.from?$("#fromList").val(i.from):$("#fromList")[0].selectedIndex=0,i.to?$("#toList").val(i.to):$("#toList")[0].selectedIndex=0}FR.Asset.Search.SetTitle(),FR.Adverts.Refresh(!1),FR.Track.Event(FR.Track.Params.Search,"MemorySearch")})},SetTitle:function(){var n,t=$("#search-keywords");n=t.val()==""?"All":t.val(),$("#asset-name").text(n)},GetData:function(){FR.Util.HideEl("#assets");var n={type:$("#assetTypeList").val(),sort:$("#assetSortList li.selected a").attr("data-sort"),keywords:$("#search-keywords").val(),from:$("#fromList").val(),to:$("#toList").val(),page:1,pager:!0,category:$("#categoryList").val(),subcategory:$("#subcategoryList").val()};BocaGrande.Pager.SetFilter(n)}};FR.Member=FR.Member||{},FR.Member.Search={Setup:function(){FR.Member.Search.SetTitle(),$("#member-search-form").submit(function(){return FR.Member.Search.GetData(),FR.Member.Search.SetTitle(),!1});$("#ageDropDownList").on("change",function(n){n.preventDefault(),$(this).val()!="-"&&(FR.Member.Search.GetData(),FR.Member.Search.SetTitle())});$("#searchGo").on("click",function(n){n.preventDefault(),FR.Member.Search.GetData(),FR.Member.Search.SetTitle()});$("#locationGo").on("click",function(n){n.preventDefault(),FR.Member.Search.GetData(),FR.Member.Search.SetTitle()});$("#memberSortList a").on("click",function(n){n.preventDefault();var t=$(this).attr("data-sort");t&&($("#memberSortList li").removeClass("selected"),$(this).parent().addClass("selected"),FR.Member.Search.GetData(),FR.Member.Search.SetTitle())});$(document).on("bocagrande.pager.page",function(){FR.Adverts.Refresh(!1)});$(document).on("bocagrande.pager.load",function(n,t){t&&(t.sort?($("#memberSortList li").removeClass("selected"),$("#memberSortList a[data-sort="+t.sort+"]").parent().addClass("selected")):($("#memberSortList li").removeClass("selected"),$("#memberSortList a[data-sort=Relevant]").parent().addClass("selected")),t.keywords?$("#search-keywords").val(unescape(t.keywords)):$("#search-keywords").val(""),t.age?$("#ageDropDownList").val(t.age):$("#ageDropDownList")[0].selectedIndex=0,t.Location?$("#Location").val(t.Location):$("#Location").val(""),t.start?FR.Member.Search.SetAlphaPager(t.start):FR.Member.Search.SetAlphaPager("All")),FR.Member.Search.SetTitle(),FR.Adverts.Refresh(!1),FR.Track.Event(FR.Track.Params.Search,"PeopleSearch")});$("#location").typeahead({source:function(n,t){if(n.length<3)return $(".typeahead").hide(),!1;var i=FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.SchoolFinderAutocomplete,{location:n});FR.Data.Get(i,{dataType:"json"},function(n){var i=[];$.each(n,function(n,t){i.push(t.text)}),t(i)},function(){})},updater:function(n){return $("#location").val(n),FR.Member.Search.GetData(),n},matcher:function(n){return~n.toLowerCase().replace(" ","").indexOf(this.query.replace(" ","").toLowerCase())}})},SetTitle:function(){var n,t=$("#search-keywords");n=t.val()==""?"All":t.val(),$("#member-name").text(n)},GetData:function(n){FR.Util.HideEl("#members");var t={sort:$("#memberSortList li.selected a").attr("data-sort"),keywords:$("#search-keywords").val(),age:$("#ageDropDownList").val(),location:$("#location").val(),start:n,page:1,pager:!0};BocaGrande.Pager.SetFilter(t)},SetAlphaPager:function(n){$(".alpha a").removeClass("selected"),$(".alpha a").each(function(){$(this).html()==n&&$(this).addClass("selected")})}};FR.SchoolFinder={Setup:function(){$("#btnRefine").on("click",function(n){n.preventDefault(),FR.SchoolFinder.GetData()});$("#subCategory").change(function(n){n.preventDefault(),FR.SchoolFinder.GetData()});$(document).on("bocagrande.pager.page",function(){FR.Adverts.Refresh(!1)});$(document).on("bocagrande.pager.load",function(n,t){t&&(t.keywords?$("#keywords").val(unescape(t.keywords)):$("#keywords").val(""),t.Location?$("#Location").val(t.Location):$("#Location").val(""),t.subCategory?$("#subCategory").val(t.subCategory):$("#subCategory")[0].selectedIndex=0),FR.SchoolFinder.SetTitle(),FR.Adverts.Refresh(!1),FR.Track.Event(FR.Track.Params.SchoolFinder,"Results")});$("#location").typeahead({source:function(n,t){if(n.length<3)return $(".typeahead").hide(),!1;var i=FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.SchoolFinderAutocomplete,{location:n});FR.Data.Get(i,{dataType:"json"},function(n){var i=[];$.each(n,function(n,t){i.push(t.text)}),t(i)},function(){})},updater:function(n){return $("#location").val(n),FR.SchoolFinder.GetData(),n},matcher:function(n){return~n.toLowerCase().replace(" ","").indexOf(this.query.replace(" ","").toLowerCase())}})},Results:function(){!$("body.mobile").length>0?$("#paged-memories").masonry({itemSelector:".item",columnWidth:240,cornerStampSelector:".corner-stamp",isAnimated:!0}):($(".corner-stamp").remove(),$("#paged-memories").masonry({itemSelector:".item",columnWidth:200}))},SetTitle:function(){$(".total-count").html($("#TotalBoxes").val()),$(".total-keyword").html($("#keywords").val())},GetData:function(){var n={keywords:$("#keywords").val(),subCategory:$("#subCategory").val(),location:$("#location").val(),page:1,pager:!0};BocaGrande.Pager.SetFilter(n)}};FR.OpenGraph={RequiredPrompt:!1,OpenGraphAllowed:!1,Namespace:"friends_reunited",Setup:function(n,t,i){FR.OpenGraph.RequiredPrompt=!t,FR.OpenGraph.OpenGraphAllowed=i,FR.OpenGraph.AuthorisedUser=n,n&&FR.FacebookLoad(function(){FB.getLoginStatus(function(n){n.status==="connected"?(FR.OpenGraph.AuthorisedUser=!0,t&&i&&FB.api("/me/permissions",function(n){FR.OpenGraph.OpenGraphAllowed=n.data!=null&&n.data[0]!=null?n.data[0].publish_actions!==undefined&&n.data[0].publish_actions==1?!0:!1:!1})):(FR.OpenGraph.OpenGraphAllowed=!1,FR.OpenGraph.AuthorisedUser=!1)})},!0)},Prompt:function(n){$("#openGraphDialog").FRdialogue({width:350,cancelCls:"cancel"}),FR.OpenGraph.RequiredPrompt=!1,$.FRdialogueClose(function(){FR.Data.Post(FR.UrlHelper.Urls.MemberOpenGraph,{},{openGraphPrompt:!FR.OpenGraph.RequiredPrompt,openGraphConfirm:FR.OpenGraph.OpenGraphAllowed},function(){typeof n=="function"&&n()},function(){typeof n=="function"&&n()})});$("#opengraph-cancel").one("click",function(n){n.preventDefault(),$(".close").click()});$("#openGraphConfirm").one("click",function(n){n.preventDefault();var t=this;$(t).addClass("wait"),FR.OpenGraph.AuthorisedUser?FB.login(function(n){n!=null&&FB.api("/me/permissions",function(n){FR.OpenGraph.OpenGraphAllowed=n.data!=null&&n.data[0]!=null?n.data[0].publish_actions!==undefined&&n.data[0].publish_actions==1?!0:!1:!1,$(".close").click(),FR.Track.Event(FR.Track.Params.OpenGraph,"fbuser_link")})},{scope:"publish_actions"}):FB.login(function(n){n.authResponse&&n.status==="connected"?FB.api("/me",function(t){if(t.error)alert("Sorry, there was a problem connecting with Facebook. Please try again later."),FR.Track.EventWithData(FR.Track.Params.OpenGraph,"error",{code:t.error.code,error_subcode:t.error.error_subcode,type:t.error.type});else{var i={FacebookId:t.id,SignedRequest:n.authResponse.signedRequest,AccessToken:n.authResponse.accessToken,Username:t.username,Forename:t.first_name,Surname:t.last_name,Email:t.email,Gender:t.gender,LocationId:t.location?t.location.id:"",LocationText:t.location?t.location.name:"",HometownId:t.hometown?t.hometown.id:"",HometownText:t.hometown?t.hometown.name:"",Locale:t.locale,Birthday:t.birthday,OpenGraphEnabled:!0};FR.Data.Post(FR.UrlHelper.Urls.OpenGraphRegister,{},i,function(n){n.success?(FR.OpenGraph.OpenGraphAllowed=!0,$(".close").click(),FR.Track.EventWithData(FR.Track.Params.OpenGraph,"standard_fblink",{success:n.success,facebook_id:i.FacebookId})):(alert(n.message),$(".close").click())})}}):(FR.OpenGraph.OpenGraphAllowed=!1,$(".close").click())},{scope:"email,user_birthday,user_hometown,user_location,publish_actions"})})},KeepBox:function(n,t,i){t?typeof i=="function"&&i():FR.OpenGraph.RequiredPrompt?FR.OpenGraph.Prompt(function(){FR.OpenGraph.KeepBox(n,t,i)}):FR.OpenGraph.OpenGraphAllowed?FB.api("/me/"+FR.OpenGraph.Namespace+":keep","post",{box:n},function(n){var t=n&&!n.error;FR.Track.Event(FR.Track.Params.OpenGraph,"keep_box"),typeof i=="function"&&i(t)}):typeof i=="function"&&i(!0)},KeepMemory:function(n,t,i){t?typeof i=="function"&&i():FR.OpenGraph.RequiredPrompt?FR.OpenGraph.Prompt(function(){FR.OpenGraph.KeepMemory(n,t,i)}):FR.OpenGraph.OpenGraphAllowed?FB.api("/me/"+FR.OpenGraph.Namespace+":keep","post",{memory:n},function(n){var t=n&&!n.error;FR.Track.Event(FR.Track.Params.OpenGraph,"keep_memory"),typeof i=="function"&&i(t)}):typeof i=="function"&&i()}};FR.Personalise={urls:[],Setup:function(n,t){function i(){FR.Track.EventWithData(FR.Track.Params.Personalise,"setup",{fr_type:"initialise"}),$("#personalisation-widget").modal({backdrop:"static"});$("#personalisation-widget .close").on("click",function(n){n.preventDefault(),FR.Track.EventWithData(FR.Track.Params.Personalise,"dialog",{fr_type:"close",fr_method:"TopRightClose"}),window.location.href=$(".modal-header .close").attr("data-url")});typeof t=="function"&&t()}FR.Personalise.urls=n,$("#Hometown, #hometown-form").attr("autocomplete",'off"'),$("#personalisation-widget").length>0?i():FR.Data.Get(FR.Personalise.urls[0],{},function(n){$("body").append(n),i()},function(){FR.Track.EventWithData(FR.Track.Params.Personalise,"setup",{fr_type:"error",fr_error:"SetupGetError"})})},BuildHometownDisplay:function(n){var t=$("#hometown-suggestion-list");$("#hometown-suggestions .hometown-item").remove(),$("#hometown-suggestions .not-to-worry").remove(),$("#hometown-spinner").hide(),$.each(n,function(n,i){var f=i.IsKept?"kept":"keep",u=i.IsKept?"Kept":"Keep",r=$('<div class="hometown-item"><div class="singleBox ninety imgStack'+i.ImageStackNumber+" "+i.CssClass+'"><div class="outer shadow"><div class="innerx"><a href="#" class="keep-trigger" title="'+i.Name+'"><img src="'+i.ImageUrl+'" alt="'+i.Name+'" /></a></div></div><div class="imgStack"></div><div class="clear"></div><a href="#" class="primaryLink keep-trigger" title="'+i.Name+'">'+i.DisplayName+'</a><a href="#" class="'+f+' primaryButton small keepButton" data-id="'+i.Id+'">'+u+"</a></div></div>");t.append(r)})},BuildMoreHometownCount:function(n){var t=$("#more-count");t.length>0?($("span.current",t).html(n),t.show()):$("#personalise-skip-btn").after('<div id="more-count" class="pull-left"><span class="current">'+n+"</span> of 3</div>")},HometownTrigger:function(n){var t,i;n.length>2?(t=$("#hometown-suggestions"),t.length>0&&t.is(":visible")?FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"error",fr_error:"LookupWithResults"}):(FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"lookup",postcode:n}),i=FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Personalise.LocationResult,{postcode:n}),FR.Data.Get(i,{dataType:"json"},function(t){if(t.isSuccess){var i=t.page==null?1:t.page;FR.Personalise.SkipButton("More",function(){$("#hometown-suggestion-list").fadeOut();var t=FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Personalise.LocationResult,{postcode:n,page:i+1});FR.Data.Get(t,{dataType:"json"},function(n){i=n.page==null?1:n.page,FR.Personalise.BuildMoreHometownCount(i),FR.Personalise.BuildHometownDisplay(n.Data),$("#hometown-suggestion-list").fadeIn()})});try{$("#personalise-skip-btn").popover("hide"),$("#personalise-skip-btn").popover("destroy")}catch(r){}FR.Personalise.BuildMoreHometownCount(i),FR.Personalise.BuildHometownDisplay(t.Data),$(".modal-footer p").fadeIn(),$("#welcome-help-link").popover("hide"),$("#welcome-help-link").hide(),$("#welcome-graphic-container").fadeOut(),$("#Hometown").animate({height:"toggle",opacity:"toggle"},"normal",function(){$("#getStarted").animate({height:"toggle",opacity:"toggle"},"normal",function(){$("#introduction").animate({height:"toggle",opacity:"toggle"},"2500",function(){$("#hometown-word").html(n),$("#hometown-suggestions").fadeIn(),$("#hometown-suggestions h3").show("blind",{direction:"left"}),$("#personalise-continue-btn").show("blind",{direction:"right"})})})})}else $("#hometown-spinner").hide(),FR.Personalise.DisplayError(t.errorMsg),FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"error",fr_error:t.errorMsg})},function(){FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"error",fr_error:"ServerErrorGet"})}))):($("#hometown-spinner").hide(),FR.Personalise.DisplayError("We need a full postcode to be able to recommend groups for you."),FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"error",fr_error:"PostcodeLengthTooShort"}))},DisplayError:function(n){var t=$("#error-container");t.length>0?(t.html(n),t.show()):$("#getStarted").after('<div id="error-container">'+n+"</div>")},Continue:function(){var n=$("#personalise-continue-btn"),t=parseInt(n.attr("data-step"),10);t<FR.Personalise.urls.length?(n.html(""),n.addClass("wait"),FR.Data.Get(FR.Personalise.urls[t],{},function(n){$("#personalisation-widget .modal-body").fadeOut("normal",function(){$("#personalisation-widget .modal-body").html(n),$("#personalisation-widget .modal-body").fadeIn()})})):(n.html(""),n.addClass("wait"),window.location.reload(!0)),n.attr("data-step",t+1)},ContinueButton:function(n,t){$("#personalise-continue-btn").hide("slide",{direction:"right"},function(){$(this).html(n),$(this).removeClass("wait"),$(this).show("slide",{direction:"right"})}).off("click").on("click",function(n){n.preventDefault(),typeof t=="function"?t():($("#welcome-help-link").popover("hide"),$("#personalise-skip-btn").popover("hide"),$("#welcome-graphic-container").fadeOut(),$(".modal-footer p, #more-count").fadeOut(),FR.Personalise.Continue(),FR.Track.EventWithData(FR.Track.Params.Personalise,"step",{fr_type:"continue"}))})},SkipButton:function(n,t){$("#personalise-skip-btn").html(n).off("click").on("click",function(n){n.preventDefault(),$("#welcome-help-link").popover("hide"),$(this).popover("destroy"),typeof t=="function"?t():(FR.Personalise.Continue(),FR.Track.EventWithData(FR.Track.Params.Personalise,"step",{fr_type:"skip"}))});$("#personalise-skip-btn").is(":visible")||$("#personalise-skip-btn").show("slide",{direction:"left"})},LoadWelcome:function(){var t,n;$("#personalisation-widget").on("shown",function(){$("#welcome-graphic-container").fadeIn()});$("#Hometown").typeahead({source:function(n,t){$("#error-container").hide();var i=FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Personalise.Autocomplete,{location:n});FR.Data.Get(i,{dataType:"json"},function(n){var i=[];$.each(n,function(n,t){i.push(t.text)}),t(i)},function(){})},matcher:function(n){return~n.toLowerCase().replace(" ","").indexOf(this.query.replace(" ","").toLowerCase())},updater:function(n){return $("#hometown-spinner").length>0?$("#hometown-spinner").show():$("#getStarted").after('<div id="spinner-container"><img id="hometown-spinner" src="'+FR.StaticUrl+'/img/loadingSpinner.gif" alt="Loading" height="28px" width="28px" /></div>'),FR.Personalise.HometownTrigger(n),FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"submit",fr_method:"autocomplete"}),n}});$("#hometown-form").on("submit",function(n){n.preventDefault()});$("#welcome-help-link").popover({placement:"top",html:!0,title:"<strong>Why do you need my postcode?</strong>",content:"Adding your hometown postcode will help us find friend groups from where you grew up. We will never display it publicly, or pass it on to anyone else.<br /><br />We currently only accept UK postcodes."}).on("click",function(n){n.preventDefault(),FR.Track.EventWithData(FR.Track.Params.Personalise,"welcome",{fr_type:"help",fr_method:"click"})});$("#personalise-skip-btn").popover({placement:"top",trigger:"manual",html:!0,title:"<strong>Are you sure?</strong>",content:'Adding your hometown postcode will help us find friend groups from where you grew up. <div id="confirm-buttons" class=\'popover-footer\'><a href="#" class="secondaryButton medium" id="personalise-skip-btn-confirm">Skip</a><a href="#" class="primaryButton medium" id="personalise-skip-btn-stay">Stay</a></div>'});$("#personalisation-widget.modal .getStarted form input.submit").on("click",function(){$(".typeahead .active:visible").length>0?$(".typeahead .active a").trigger("click"):FR.Personalise.HometownTrigger($("#Hometown").val())});$("#personalise-skip-btn").on("click",function(n){n.preventDefault(),FR.Track.EventWithData(FR.Track.Params.Personalise,"welcome",{fr_type:"skip",fr_method:"popup"}),$("#personalise-skip-btn").popover("show"),$("#welcome-help-link").popover("hide")});$("body").on("click","#personalise-skip-btn-stay",function(n){n.preventDefault(),FR.Track.EventWithData(FR.Track.Params.Personalise,"welcome",{fr_type:"skip",fr_method:"stay"}),$("#personalise-skip-btn").popover("hide")});$("body").on("click","#personalise-skip-btn-confirm",function(n){n.preventDefault(),FR.Track.EventWithData(FR.Track.Params.Personalise,"welcome",{fr_type:"skip",fr_method:"skip"}),$("#personalise-skip-btn").popover("hide").popover("destroy"),$("#personalise-skip-btn").off("click"),$("#welcome-graphic-container").fadeOut(),$(".modal-footer p, #more-count").fadeOut(),FR.Personalise.Continue()});$("#personalise-continue-btn").on("click",function(n){n.preventDefault(),FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"continue"}),$("#welcome-help-link").popover("hide"),$("#personalise-skip-btn").popover("hide"),$("#welcome-graphic-container").fadeOut(),$(".modal-footer p, #more-count").fadeOut(),FR.Personalise.Continue()});$("#hometown-word").on("click",function(n){n.preventDefault(),FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"rerun"}),$("#personalise-continue-btn").hide("blind",{direction:"right"}),$("#hometown-suggestions h3").hide("blind",{direction:"left"}),$("#hometown-suggestions").fadeOut(),$("#more-count").fadeOut(),$("#hometown-spinner").hide(),$("#introduction").animate({height:"toggle",opacity:"toggle"},"2500",function(){$("#getStarted").animate({height:"toggle",opacity:"toggle"},"normal",function(){$("#Hometown").animate({height:"toggle",opacity:"toggle"},"normal",function(){$("#welcome-graphic-container").fadeIn(),$("#welcome-help-link").show()})})})});$("#hometown-suggestions").on("click",".keep-trigger",function(n){n.preventDefault();var t=$(".keepButton",$(this).closest(".singleBox"));t.length>0&&t.click()});$("#hometown-suggestions").on("click",".keepButton",function(n){n.preventDefault();var t=this,i=$(t).attr("data-id");if($(t).hasClass("keep")){$(t).addClass("justKept").addClass("kept").removeClass("keep").html("Joined");$(t).on("mouseout",function(){$(t).removeClass("justKept")});FR.Data.Post(FR.UrlHelper.Urls.AddBoxMember,[],{id:i},function(){FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"keep",box_key:i})})}else $(t).hasClass("kept")&&($(t).addClass("keep").removeClass("kept").html("Join"),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Remove,[],{id:i},function(n){n.success?FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"unkeep",box_key:i}):FR.Track.EventWithData(FR.Track.Params.Personalise,"hometown",{fr_type:"error",fr_error:"UnKeepError"})}))});$("#hometown-suggestions").on("mouseenter ",".keepButton",function(){$(this).hasClass("kept")&&$(this).html("Leave")}).on("mouseleave",".keepButton",function(){$(this).hasClass("kept")&&$(this).html("Joined")})},LoadProfile:function(){$("#personalise-continue-btn").on("click",function(n){n.preventDefault(),FR.Personalise.Continue()})},LoadInterests:function(){FR.Personalise.ContinueButton("Save your interests",function(){var t=[],n="";$("#interest-list input:checked").each(function(i,r){var u=$(r).attr("id");t.push(u),n=n+u+","}),FR.Data.Post(FR.UrlHelper.Urls.Personalise.InterestsSave,{},t,function(t){t.isSuccess?(FR.Personalise.Continue(),FR.Track.EventWithData(FR.Track.Params.Personalise,"interests",{fr_type:"continue",interests:n})):FR.Track.EventWithData(FR.Track.Params.Personalise,"interests",{fr_type:"error",fr_error:"SaveError"})},function(){FR.Track.EventWithData(FR.Track.Params.Personalise,"interests",{fr_type:"error",fr_error:"SaveServerError"})})}),FR.Personalise.SkipButton("Skip",function(){FR.Personalise.Continue(),FR.Track.EventWithData(FR.Track.Params.Personalise,"interests",{fr_type:"skip"})});$("#interest-list input").on("click",function(n){n.stopPropagation(),$(this).closest("li").toggleClass("selected",$(this).prop("checked"))});$("li","#interest-list").on("click",function(n){var t=this;n.preventDefault(),$("input",this).prop("checked",function(n,i){return $(t).toggleClass("selected",!i),!i})})},LoadRecommendations:function(){FR.Personalise.ContinueButton("Save recommendations",function(){FR.Personalise.Continue(),FR.Track.EventWithData(FR.Track.Params.Personalise,"recommendations",{fr_type:"continue"})}),FR.Personalise.SkipButton("Skip",function(){FR.Personalise.Continue(),FR.Track.EventWithData(FR.Track.Params.Personalise,"recommendations",{fr_type:"skip"})});$("#box-suggestions .keep-trigger").on("click",function(n){n.preventDefault();var t=$(".keepButton",$(this).closest(".singleBox"));t.length>0&&t.click()});$("#box-suggestions .keepButton").on("click",function(n){n.preventDefault();var t=this,i=$(t).attr("data-id");if($(t).hasClass("keep")){$(t).addClass("justKept").addClass("kept").removeClass("keep").html("Joined");$(t).on("mouseout",function(){$(t).removeClass("justKept")});FR.Data.Post(FR.UrlHelper.Urls.AddBoxMember,[],{id:i},function(){FR.Track.EventWithData(FR.Track.Params.Personalise,"recommendations",{fr_type:"keep",box_key:i})})}else $(t).hasClass("kept")&&($(t).addClass("keep").removeClass("kept").html("Join"),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Remove,[],{id:i},function(n){n.success?FR.Track.EventWithData(FR.Track.Params.Personalise,"recommendations",{fr_type:"unkeep",box_key:i}):FR.Track.EventWithData(FR.Track.Params.Personalise,"recommendations",{fr_type:"error",fr_error:"UnKeepError"})}))})},LoadInterestsRecommendations:function(){FR.Personalise.ContinueButton("Save interests",function(){var t=[],n="";$("#interests-recommendations input:checked").each(function(i,r){var u=$(r).attr("id");t.push(u),n=n+u+","}),FR.Data.Post(FR.UrlHelper.Urls.Personalise.InterestsSave,{},t,function(t){t.isSuccess?(FR.Personalise.Continue(),FR.Track.EventWithData(FR.Track.Params.Personalise,"interests_recommendations",{fr_type:"continue",interests:n})):FR.Track.EventWithData(FR.Track.Params.Personalise,"interests_recommendations",{fr_type:"error",fr_error:"SaveError"})},function(){FR.Track.EventWithData(FR.Track.Params.Personalise,"interests_recommendations",{fr_type:"error",fr_error:"SaveServerError"})})}),FR.Personalise.SkipButton("Skip",function(){FR.Personalise.Continue(),FR.Track.EventWithData(FR.Track.Params.Personalise,"interests_recommendations",{fr_type:"skip"})});$("#personalisation-widget a.more").on("click",function(n){n.preventDefault();var t=this,r=$(t).hasClass("left"),i=r?"-=750":"+=750";$(".interest-category-inner",$(this).closest(".interestCategory")).animate({marginLeft:i},{duration:500}),$(t).toggleClass("left")});$("#interests-recommendations .keep-trigger").on("click",function(n){n.preventDefault();var t=$(".keepButton",$(this).closest(".singleBox"));t.length>0&&t.click()});$("#interests-recommendations .keepButton").on("click",function(n){n.preventDefault();var t=this,i=$(t).attr("data-id");if($(t).hasClass("keep")){$(t).addClass("justKept").addClass("kept").removeClass("keep").html("Joined");$(t).on("mouseout",function(){$(t).removeClass("justKept")});FR.Data.Post(FR.UrlHelper.Urls.AddBoxMember,[],{id:i},function(){FR.Track.EventWithData(FR.Track.Params.Personalise,"interests_recommendations",{fr_type:"keep",box_key:i})})}else $(t).hasClass("kept")&&($(t).addClass("keep").removeClass("kept").html("Join"),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Remove,[],{id:i},function(n){n.success?FR.Track.EventWithData(FR.Track.Params.Personalise,"interests_recommendations",{fr_type:"unkeep",box_key:i}):FR.Track.EventWithData(FR.Track.Params.Personalise,"interests_recommendations",{fr_type:"error",fr_error:"UnKeepError"})}))});$("input","#interests-recommendations").on("click",function(){$(this).closest(".interestCategory").toggleClass("selected",$(this).prop("checked"))})},LoadConfirm:function(){$("#personalise-skip-btn").hide("slide",{direction:"left"}),FR.Personalise.ContinueButton("Continue",function(){FR.Personalise.Continue(),FR.Track.EventWithData(FR.Track.Params.Personalise,"confirm",{fr_type:"continue"})})},LoadSuccess:function(){$("#personalise-continue-btn").hide("slide",{direction:"right"}),$("#personalise-skip-btn").hide("slide",{direction:"left"}),FR.Track.EventWithData(FR.Track.Params.Personalise,"success",{fr_type:"finish"})}};FR.Popularity={SetupPopularity:function(){$("body").on("click",".agree",function(n){var t,i;n.preventDefault(),t=$(this),t.attr("data-validated-member")=="True"?t.attr("data-is-clicked")=="false"&&(t.attr("data-is-clicked","true"),i=t.attr("data-entity-id"),FR.Data.Post(FR.UrlHelper.Urls.Popularity.Agree,{dataType:"json"},{entityId:i},function(n){if(n.isSuccess){if(n.Data.HasVoted==!0){if(n.Data.HasDisagreed){var i=t.next(),r=parseInt(i.html());i.html(r-1),i.removeClass("selected"),t.addClass("selected")}n.Data.HasAgreed&&t.removeClass("selected")}else t.addClass("selected");FR.Track.Event("Popularity","Agree")}t.attr("data-is-clicked","false")})):window.location.href=FR.UrlHelper.Urls.Validation});$("body").on("click",".disagree",function(n){var t,r,i;n.preventDefault(),t=$(this),t.attr("data-validated-member")=="True"?t.attr("data-is-clicked")=="false"&&(t.attr("data-is-clicked","true"),r=t.attr("data-entity-id"),i=parseInt(t.html()),FR.Data.Post(FR.UrlHelper.Urls.Popularity.Disagree,{dataType:"json"},{entityId:r},function(n){if(n.isSuccess){if(n.Data.HasVoted==!0){if(n.Data.HasAgreed){var r=t.prev(),u=parseInt(r.html());r.html(u-1),r.removeClass("selected"),t.html(i+1),t.addClass("selected")}n.Data.HasDisagreed&&(t.html(i-1),t.removeClass("selected"))}else t.html(i+1),t.addClass("selected");FR.Track.Event("Popularity","Disagree")}t.attr("data-is-clicked","false")})):window.location.href=FR.UrlHelper.Urls.Validation});$("body").on("click",".agreeList",function(n){var t,i;n.preventDefault(),t=$(this),t.attr("data-validated-member")=="True"?(i=t.attr("data-entity-id"),FR.Data.Post(FR.UrlHelper.Urls.Popularity.AgreeList,{dataType:"html"},{entityId:i},function(n){t.append(n);var i=function(){$(".voteActionsList").remove(),$("body").unbind("click",i)};$("body").bind("click",i)})):window.location.href=FR.UrlHelper.Urls.Validation})}};FR.Gallery={Model:null,Setup:function(n){function i(){var n=t.Model.asset_url();n!=null&&n.length>0?window.location.href=n:($("body").removeClass("gallery"),$(window).unbind("resize"),$("#gallery-viewer img").hide())}var t=FR.Gallery;FR.Track.Event(FR.Track.Params.Gallery,"Load"),$(window).smartresize(function(){var i,u,r,n;if((t.Model.type()==2||t.Model.type()==4)&&(i=$("#gallery-image").innerHeight(),u=$("#gallery-viewer #video").height(),$("#gallery-viewer #video").css("marginTop",(i-u)/2+"px")),$("#interstitialHolder").length>0&&($("#interstitialHolder").height()>$("#gallery-image").innerHeight()?$("#interstitialHolder").height($("#gallery-image").innerHeight()):$("#interstitialHolder").height("auto"),$("#interstitialHolder").css("marginTop",($("#gallery-image").innerHeight()-$("#interstitialHolder").height())/2+"px")),t.Model.image_width()<200){$("#gallery-background").append('<img id="frithIm" src="'+$("#gallery-viewer #media-image").attr("src")+'" style="visibility: hidden"/>');$("#frithIm").one("load",function(){t.Model.image_height($(this).height()*1.5),t.Model.image_width($(this).width()*1.5),t.ImageResize($(this).height()*1.5,$(this).width()*1.5),$(this).remove()})}else t.ImageResize(t.Model.image_height(),t.Model.image_width());$("#gallery-pager-container #commentContainer").length>0&&(r=$("#gallery-pager-container #commentContainer").position().top,n=$("#gallery-info").height()-240-$("#gallery-pager-container .nonpending-reply").height()-r,$("#gallery-comments #commentContainer").css("maxHeight",n+"px"),n<50?$("body").addClass("noAdvert"):$("body").removeClass("noAdvert"))}),$("body").addClass("gallery");$("#exitFullScreen").on("click",function(){i()});$("#viewDescription").live("click",function(){$("#gallery-description").addClass("init"),$("#viewDescription").hide()}),$(document).bind("keydown",function(n){n.keyCode==27&&$(document.activeElement).attr("id")!="Text"&&(i(),FR.Track.Event(FR.Track.Params.Gallery,"esc-key")),n.keyCode==39&&$(document.activeElement).attr("id")!="Text"&&($("#gallery-right-arrow:visible").trigger("click"),FR.Track.Event(FR.Track.Params.Gallery,"right-key")),n.keyCode==37&&$(document.activeElement).attr("id")!="Text"&&($("#gallery-left-arrow:visible").trigger("click"),FR.Track.Event(FR.Track.Params.Gallery,"left-key"))}),t.Init(n);$("#gallery-keep-button").on("click",function(n){n.preventDefault();var i=$(this);if(i.hasClass("keep")){i.addClass("justKept");i.on("mouseout",function(){i.removeClass("justKept")});FR.OpenGraph.KeepMemory(t.Model.asset_url,t.Model.is_private(),function(){}),t.Model.is_kept(!0),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Add,[],{id:t.Model.asset_id()},function(){})}else i.hasClass("kept")&&(t.Model.is_kept(!1),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Remove,[],{id:t.Model.asset_id()},function(){}))});$("#gallery-comments").on("click","#gallery-comment-link",function(n){n.preventDefault(),i()});$("#Text").live("focus",function(){$(window).trigger("resize")}),$("#descClose").live("click",function(){$("#gallery-description").removeClass("init"),$("#viewDescription").length>0?$("#viewDescription").fadeIn():$("#gallery-description").after('<div id="viewDescription">View description</div>')});$(document).on("fr.comment.add",function(){var n=$("#gallery-comments .commentsContainer .item:visible");n.length>3&&$(n[0]).hide().removeClass("exceed"),$("#gallery-comments .commentContainer .exceed").removeClass("exceed"),$("#gallery-comments #totalCommentId").html(function(){var n=parseInt($(this).attr("data-take"),10),t=parseInt($(this).attr("data-total"),10),i;return t=t+1,n<3?(n=n+1,i="<strong>Comments</strong></text><span>"+n+" of "+t+"</span>"):i='<a href="#" id="gallery-comment-link">Show all comments</a><span>'+n+" of "+t+"</span>",$(this).attr("data-take",n),$(this).attr("data-total",t),$(window).trigger("resize"),i})});$("#gallery-comments").on("click",".commentReply",function(){var n=$(this).closest(".nonpending-reply").parent(),t=n.find(".Text"),r=n.find(".replyImage").parent(),i;return t.val().length>3&&!t.is(".exceed")?(n.find(".commentsContainer").append('<div class="item adddedComment"><a href="#">'+r.html()+'</a><div class="info"><p class="commentBody">'+t.val()+"</p></div></div>"),n.find(".commentReply").parent().addClass("init"),t.removeAttr("style"),i=$(this).closest("form").serialize(),t.val(""),removeCount=n.find(".chars-left"),removeCount.siblings("div.clear").remove(),removeCount.remove(),FR.Util.AttachInlineCount(n.find(".Text"),{count:900,expandable:!0}),$.post(FR.UrlHelper.Urls.Comment.Comment,i,function(t){var r=$(".reply-tab.newest"),i=$(".reply-tab.oldest");i.hasClass("selected")&&i.removeClass("selected"),r.addClass("selected"),setTimeout(function(){getLatestReplies()},FR.Comment._pollingTimeout),FR.Data.Get($(r).attr("href"),{},function(n){$(".pager-refresh-target").html(n)}),n.find(".adddedComment").remove(),n.find(".commentsContainer").append(t),FR.Comment.AddingComments(n),$(document).trigger("fr.comment.AddingComments"),FR.Adverts.Refresh(!0),FR.Track.Page("NewComment")})):(t.addClass("exceed"),t.val().length<4&&n.find(".chars-left").addClass("exceed").text("Please enter at least 4 characters for your comment")),!1});$("#gallery-comments").on("click",".delete-comment",function(){var t=$(".viewAllComments",$(this).closest("#commentContainer").parent()),i=$(this).attr("data-id"),n=$(this).closest(".item");return $.InlineConfirm(this,n,{message:"Are you sure you want to delete this comment?",confirmButtonText:"Delete",cancelButtonText:"Cancel",callback:function(){FR.Data.Post(FR.UrlHelper.Urls.Comment.Delete,[],{commentId:i},function(i){i.IsSuccess&&(n.remove(),FR.Comment.DeleteComments(t))})}}),!1})},ImageResize:function(n,t){var f=t/n,e=$("#gallery-image").innerWidth(),i=$("#gallery-image").innerHeight(),o=e/i,r,u,n;o>f?($("#gallery-image").addClass("sizeOnHeight").css("marginTop",0),r=i,i>n&&(r=n),$("#gallery-image #media-image").height(r).css("marginTop",(i-r)/2+"px").width(r*f+"px")):(u=e,e>t&&(u=t),n=u/f,$("#gallery-image #media-image").width(u+"px"),$("#gallery-image #media-image").height(n+"px"),$("#gallery-image").removeClass("sizeOnHeight"),$("#gallery-image #media-image").css("marginTop",(i-n)/2+"px"))},Init:function(n){var t=FR.Gallery,r=function(n,i,r,u,f,e,o,s,h,c){this.asset_id=ko.observable(n),this.type=ko.observable(i),this.is_memory=ko.observable(r),this.title=ko.observable(u),this.description=ko.observable(f),this.date=ko.observable(e),this.author_name=ko.observable(o),this.author_url=ko.observable(s),this.created_on=ko.observable(h),this.image_url=ko.observable(c),this.asset_url=ko.observable(),this.profile_key=ko.observable(),this.sort=ko.observable(),this.interstitial_box_key=ko.observable("975527fb-bdb4-4be5-bb51-a020011cdcc8"),this.asset_list=ko.observableArray([]),this.current_index=ko.observable(this.asset_list().indexOf(this.asset_id())),this.source=ko.observable("Box"),this.is_private=ko.observable(!0),this.is_legacy=ko.observable(!1),this.is_deleted=ko.observable(!1),this.is_kept=ko.observable(!1),this.image_height=ko.observable(0),this.image_width=ko.observable(0),this.list_loaded=ko.observable(!1),this.preload_limit=ko.observable(30),this.can_share=ko.computed(function(){return!this.is_private()&&!this.is_legacy()},this),this.nextClick=function(){var n=this.current_index()+1;this.current_index(n),t.PreloadImage(n+t.Model.preload_limit()),FR.Track.Page(FR.Track.Params.Gallery),FR.Track.Event(FR.Track.Params.Gallery,"Next")},this.previousClick=function(){var n=this.current_index()-1;this.current_index(n),t.PreloadImage(n-1),FR.Track.Page(FR.Track.Params.Gallery),FR.Track.Event(FR.Track.Params.Gallery,"Previous")},this.finalNextClick=ko.computed(function(){return this.current_index()<=this.asset_list().length-1},this),this.finalPreviousClick=ko.computed(function(){return this.current_index()>0},this),this.shouldDescriptionShow=ko.computed(function(){return this.description()!=null&&this.description().length>0},this)},i;t.Model=new r(n.asset_id,n.type,n.is_memory,n.title,n.description,n.date,n.author_name,n.author_url,n.created_on),n.source!=null&&t.Model.source(n.source),t.Model.interstitial_box_key(n.box_key),t.Model.is_private(n.is_private),t.Model.is_legacy(n.is_legacy),t.Model.is_deleted(n.is_deleted),t.Model.profile_key(n.profile_key),t.Model.sort(n.sort),ko.applyBindings(t.Model,document.getElementById("gallery-container")),n.description!=null&&n.description.length>0?t.ShowDescription():t.HideDescription(),t.Model.asset_id.subscribe(function(n){setTimeout("FR.Gallery.ExtendedLoad('"+n+"')",1500)}),t.Model.description.subscribe(function(n){n!=null&&n.length>0?t.ShowDescription():t.HideDescription()}),t.Model.date.subscribe(function(n){n!=null&&n.length>0?$("#gallery-container .asset-display-date").show():$("#gallery-container .asset-display-date").hide()}),t.Model.image_url.subscribe(function(){t.ImageResize(t.Model.image_height(),t.Model.image_width())}),t.Model.current_index.subscribe(function(n){if(t.Model.list_loaded()){t.HideDescription();var i=t.Model.asset_list()[n];i!=null?($("#interstitialHolder").length&&($("#interstitialHolder").hide(),$("#gallery-meta").show()),t.Load(i.Id,i.ItemUrl,i.ImageUrl)):n>0&&(t.Model.asset_id(null),$("#interstitialHolder").length?($("#interstitialHolder").show(),$("#gallery-viewer #media-image").remove(),$(window).trigger("resize")):($("#viewDescription").remove(),$("#gallery-viewer").append('<div id="interstitialHolder"></div>'),$("#gallery-viewer img").remove(),FR.Data.Get(FR.UrlHelper.Urls.Box.Interstitial+"?boxKey="+t.Model.interstitial_box_key(),{},function(n){$("#interstitialHolder").append(n).show(),$(window).trigger("resize")})),$("#gallery-meta").hide(),FR.Track.Page("Interstitial"))}$(window).trigger("resize")}),t.Model.is_kept.subscribe(function(n){var t=$("#gallery-keep-button");n?t.addClass("kept").removeClass("keep").html("Joined"):t.addClass("keep").removeClass("kept").html("Join")}),t.Model.is_kept(n.is_kept),i=$("#gallery-viewer #media-image"),t.Model.type()==1&&(t.Model.image_height(i.attr("height")),t.Model.image_width(i.attr("width"))),$(window).trigger("resize"),i.show(),t.ExtendedLoad(t.Model.asset_id()),FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Gallery.List,{id:t.Model.asset_id(),source:t.Model.source(),memberKey:t.Model.profile_key(),sort:t.Model.sort()}),{dataType:"json"},function(n){if(n.isSuccess){t.Model.asset_list(n.Data);var i=0;$.each(t.Model.asset_list(),function(n,r){r.Id==t.Model.asset_id()&&(t.Model.current_index(n),t.Model.list_loaded(!0),t.PreloadImage(n-1)),t.Model.list_loaded()&&i<t.Model.preload_limit()&&$("<img/>").load(function(){}).attr("src",r.ImageUrl)}),$("#gallery-viewer img").bind("contextmenu",function(n){n.preventDefault()}),t.Model.current_index()==-1&&(FR.Track.EventWithData(FR.Track.Params.Error,"GalleryIndexNotFound",{fr_model_id:t.Model.asset_id()}),t.Model.current_index(0),t.Model.list_loaded(!0))}})},PreloadImage:function(n){var i=FR.Gallery,t=i.Model.asset_list()[n];t!=null&&$("<img/>").load(function(){}).attr("src",t.ImageUrl)},ExtendedLoad:function(n){var t=FR.Gallery;t.Model.asset_id()==n&&(t.Comments(n),t.Sharing(n),FR.Adverts.Refresh(!0))},Sharing:function(n){var t=FR.Gallery;t.Model.can_share()&&FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Gallery.Share,{memoryId:n}),{},function(n){$("#gallery-share").html(n),$("#gallery-share").show()})},Comments:function(n){var t=FR.Gallery;t.Model.is_memory()&&FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Gallery.Comments,{id:n,source:t.Model.source(),take:3,hide:!0}),{},function(i){$("#gallery-comment-list").html(i),$("#gallery-comments .nonpending-reply").length>0?($("#gallery-comments .Text").val("").trigger("smartkeydown"),$("#gallery-comments .nonpending-reply #MemoryId").val(n),$("#gallery-comment-link").attr("href",t.Model.asset_url()),$("#gallery-comments").show()):FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Gallery.Reply,{memoryId:n}),{},function(n){$("#gallery-comments").append(n),FR.Util.AttachInlineCount($("#gallery-comments .Text"),{count:500,expandable:!0}),$("#gallery-comments").show(),$(window).trigger("resize")})})},ShowDescription:function(){$("#gallery-description").show().addClass("init"),$("#descClose").length>1||$("#gallery-description").append('<div id="descClose">x</div>'),setTimeout(function(){$("#gallery-description").removeClass("init"),$("#viewDescription").length>0?$("#viewDescription").fadeIn():$("#gallery-description").after('<div id="viewDescription">View description</div>')},5e3)},HideDescription:function(){$("#gallery-description, #viewDescription").hide()},Load:function(n,t,i){var r=FR.Gallery;$("#gallery-share").hide(),$("#gallery-comments").hide(),$("#gallery-viewer #media-image").removeClass("loaded").hide(),FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Gallery.Meta,{id:n}),{dataType:"json"},function(u){if(r.Model.image_width(u.Width),r.Model.image_height(u.Height),Modernizr.history&&window.history.pushState(r.Model.current_index(),u.Title,t),u.Type==1||u.Type==5){function e(){$("#gallery-viewer #media-image").one("load",function(){r.ImageResize(r.Model.image_height(),r.Model.image_width()),$("#gallery-viewer img").show(),$(window).trigger("resize"),setTimeout(function(){$("#gallery-viewer img").addClass("loaded"),$("#gallery-viewer img").bind("contextmenu",function(n){n.preventDefault()})},100)}).each(function(){this.complete&&$(this).trigger("load")})}u.Type!=r.Model.type()?FR.Data.Get("/Media/Photo?id="+n+"&isMemory="+u.IsMemory+"&isArchivedMemory="+u.IsDeleted+"&source="+r.Model.source(),{},function(n){$("#gallery-viewer").html(n),e()}):($("#gallery-viewer #media-image").remove(),$("#gallery-viewer").append('<img id="media-image" src="'+i+'" />'),e())}else if(u.Type==2||u.Type==4){var f="/Media/Video?id="+n+"&isMemory="+u.IsMemory;u.Type==4&&(f="/Media/EmbeddedVideo?id="+n+"&isMemory="+u.IsMemory),FR.Data.Get(f,{},function(n){$("#gallery-viewer").html(n),$(window).trigger("resize")})}r.Model.asset_url(t),r.Model.image_url(i),r.Model.asset_id(u.Id),r.Model.type(u.Type),r.Model.title(u.Title),r.Model.description(u.Description),r.Model.date(u.Date),r.Model.author_name(u.AuthorName),r.Model.author_url(u.AuthorProfileUrl),r.Model.created_on(u.CreatedOn),r.Model.is_memory(u.IsMemory),r.Model.is_deleted(u.IsDeleted),r.Model.is_kept(u.IsKeptByUser)})}};FR.Scanning={Mixed:function(n,t){function i(i){var e=n,u=t,f=50,r=((i-f)*u+e).toString();$("#select-specific-amount #quantity").val(i),$("#buy-mix-count").html(i),$("#buy-mix-cost").html("£"+[r.slice(0,r.length-2),".",r.slice(r.length-2)].join(""))}$("#buy-specific-amount").on("click",function(n){n.preventDefault(),$("#select-specific-amount").show()});var r=$("#mix-slider").slider({range:"min",value:50,min:50,max:150,step:1,slide:function(n,t){i(t.value)}});$("#select-specific-amount #quantity").change(function(){var n=$(this).val();$.isNumeric(n)&&n>=50&&n<=150&&(r.slider("value",n),i(n))})},Address:function(){$("#terms-modal-button").on("click",function(n){n.preventDefault(),$("#terms-modal").modal({})})},Delivery:function(){$("#register-delivery-interest").one("click",function(n){n.preventDefault();var t=this;$(t).addClass("wait"),FR.Track.Event(FR.Track.Params.ScanningStore,"DeliveryOptionInterest"),setTimeout(function(){$(t).html("Thanks! We'll be in touch"),$(t).removeClass("wait").addClass("disabled");$(t).on("click",function(n){n.preventDefault()})},1500)})},Payment:function(){$("#promoSubmitButton").on("click",function(n){n.preventDefault();var t=$("#appendedInputButton");t.val().length==0?$("#promoError").html("You must enter a promotion code"):FR.Data.Get("/Scan/AddPromotion?promotionCode="+t.val(),{dataType:"json"},function(n){n.isSuccess?($("#promoError").html(n.data),window.location.href=n.redirectToUrl):$("#promoError").html(n.errorMsg)})})}};FR.Printing={_currentBanner:0,_currentProductPosition:0,_productPositionLimit:3,_mouseOverBanner:!1,_bannerRotateTime:1e4,_bannerItemWidth:100,_bannerCount:1,ProductSetup:function(){$(".product-pick").on("click",function(n){n.preventDefault(),$(this).hasClass("disabled")||($(this).addClass("disabled"),window.location=$(this).attr("href"))});$("#calendar-test").on("click",function(n){n.preventDefault();var t=$(this);FR.Data.Get("/Print/AddCustomerInterest/",{dataType:"json"},function(n){n.isSuccess&&($("#calendar-message").fadeIn(),$("#save-email").attr("data-id",n.Data),t.hasClass("disabled")||t.addClass("disabled"),t.off("click"))})});$("#save-email").on("click",function(n){n.preventDefault();var t=$(this);FR.Data.Post("/Print/AddCustomerInterestSignup/",{dataType:"json"},{id:t.attr("data-id"),email:$("#interest-email").val()},function(n){n.isSuccess&&(t.hide(),$("#interest-email").hide(),$("#cancel-email").hide(),$("#email-record-confirmation").fadeIn(),t.hasClass("disabled")||t.addClass("disabled"),t.off("click"))})});$("#cancel-email").on("click",function(n){n.preventDefault(),$("#calendar-message").hide()})},ProductSubSetup:function(){$(".resolution-warning").popover({title:"Image quality low",content:"The selected image may not be high enough resolution to ensure the best print.",placement:"top",trigger:"hover"}),$("#print-confirmation-order").click(function(){return!1});$("#print-confirmation-check").on("click",function(){var n=$(this).prop("checked");n?($("#print-confirmation-order").removeClass("disabled"),$("#print-confirmation-order").unbind("click")):($("#print-confirmation-order").addClass("disabled"),$("#print-confirmation-order").click(function(){return!1}))});$(".product-pick").on("click",function(n){n.preventDefault(),$(this).hasClass("disabled")||($(this).addClass("disabled"),window.location=$(this).attr("href"))});$(".confirm-purchase").on("click",function(n){n.preventDefault();var t=$(this).attr("data-url");$("#print-confirmation-order").attr("href",t),$("#print-confimation-wrapper").modal({backdrop:"static"})})},Address:function(){$("#terms-modal-button").on("click",function(n){n.preventDefault(),$("#terms-modal").modal({})})},Next:function(){var n=FR.Printing,t;n._mouseOverBanner||(n._currentBanner=n._currentBanner+1,n._currentBanner>=n._bannerCount&&(n._currentBanner=0),t=n._currentBanner*n._bannerItemWidth,$("#carousel-banner-container").css("margin-left",-t)),setTimeout(function(){n.Next()},n._bannerRotateTime)},Promo:function(){var n=FR.Printing;n._bannerItemWidth=$("#caroursel-banner-first").width(),n._bannerCount=$(".carousel-banner").length,setTimeout(function(){n.Next()},n._bannerRotateTime),$(".contentWell").mouseenter(function(){n._mouseOverBanner=!0}).mouseleave(function(){n._mouseOverBanner=!1})},PromoCodeSetup:function(){$("#promoSubmitButton").on("click",function(n){n.preventDefault();var t=$("#appendedInputButton");t.val().length==0&&$("#promoError").html("You must enter a promotion code"),FR.Data.Get("/Print/AddPromotion?promotionCode="+t.val(),{dataType:"json"},function(n){n.isSuccess?($("#promoError").html(n.data),window.location.href=n.redirectToUrl):$("#promoError").html(n.errorMsg)})})}};FR.Upload={_fromKeepsafe:!0,_boxId:null,_uploadUrl:"",_uploadData:{},_uploadStage:1,_returnUrl:"/Keepsafe",_hasExif:!1,_usingHtml5:!1,_useMasonry:!0,_boxName:"a friend group",_moreUpload:!1,Setup:function(n,t,i,r,u){var f=FR.Upload;f._fromKeepsafe=n,f._boxId=t,f._uploadUrl=i,f._uploadData=r,f._returnUrl=u,f._useMasonry=$(window).width()>644,f._boxName=$("#uploadedToBox span.name").text();$("body.uploader").on("keyup",".assetTags",function(n){var i=n.keyCode?n.keyCode:n.which,t,r;if(i==13||i==32||i==188){if(t=$(this).val(),i!=13&&(t=t.slice(0,-1)),t=="")return!1;$(this).val(""),$(this).closest(".item").hasClass("checked")?($(".item.checked .tagList").each(function(n,i){$(i).html($(i).html()+'<span class="tag" data-val="'+t+'">'+t+'<a class="remove" title="Remove tag"></a></span>')}),FR.Track.Event(FR.Track.Params.Upload,"tag-batchadd")):(r=$(this).parent().find(".tagList"),r.html(r.html()+'<span class="tag" data-val="'+t+'">'+t+'<a class="remove" title="Remove tag"></a></span>'),FR.Track.Event(FR.Track.Params.Upload,"tag-add")),f._useMasonry&&$("#html5-file-container .files, #filedata-queue").masonry("reload")}});$("body.uploader").on("click",".tagList .tag .remove",function(n){n.preventDefault(),$(this).parent().remove(),f._useMasonry&&$("#html5-file-container .files, #filedata-queue").masonry("reload"),FR.Track.Event(FR.Track.Params.Upload,"tag-remove")});$("#helpNext1").on("click",function(n){n.preventDefault(),$("#uploadHelpP1").is(":visible")?f.SetHelpPage(2):f.SetHelpPage(1)});$("#edit-all").on("click",function(n){n.preventDefault(),$("#header-controls").slideUp(),$("#batchEdit").slideDown(),$(".item .itemSelect").attr("checked","checked").change(),FR.Track.Event(FR.Track.Params.Upload,"edit-all")});$("#batch-edit-done, #batch-edit-cancel").on("click",function(n){n.preventDefault(),$("#batchEdit").slideUp(),$("#header-controls").slideDown(),$(".item .itemSelect").attr("checked",null).change(),$("#batchTitle, #batchYear, #batchLocation, #batchKeywords, #batchDescription").val(""),FR.Track.Event(FR.Track.Params.Upload,"batch-done")});$("body.uploader").on("click",".itemDel",function(n){n.preventDefault();var t=$(this).closest(".item").find(".details").attr("data-guid"),i=$(this).closest(".item").find(".details");t!=null&&t.length>0?$("#remove-confirm-modal").modal({backdrop:"static"}):($(this).closest(".item").remove(),f._useMasonry&&$("#html5-file-container .files, #filedata-queue").masonry("reload"),FR.Track.Event(FR.Track.Params.Upload,"remove-incomplete"));$("#remove-confirm-modal .modal-footer .primaryButton").on("click",function(n){n.preventDefault(),$(this).addClass("wait"),FR.Data.Post(FR.UrlHelper.Urls.UploadDelete,null,{id:t},function(){$(".item").length==0&&(FR.Track.Event(FR.Track.Params.Upload,"removed-all-return"),document.location=f._returnUrl)},function(){FR.Track.Event(FR.Track.Params.Upload,"delete-error")}),$(i).closest(".item").remove(),$("#remove-confirm-modal").modal("hide"),$(this).removeClass("wait"),f._useMasonry&&$("#html5-file-container .files, #filedata-queue").masonry("reload"),FR.Track.Event(FR.Track.Params.Upload,"remove")})});$("body.uploader").on("click","#finishConfirm",function(n){n.preventDefault(),$("#incomplete-confirm-modal").modal("hide"),FR.Upload.FinishEditing()});$("body.uploader").on("click",".preview.image",function(n){var e,t,s,h,i;if(n.preventDefault(),e=$(this).find(".rotateLayer"),!e.is(".updating")){if(t=$(this).find("canvas, img"),$("html").is(".no-csstransforms"))e.addClass("updating"),s=$(this).closest(".item").find(".details").attr("data-guid"),h=t.attr("src"),t.hide().attr("src",""),FR.Data.Get(FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.Media.RotateRight,{id:s,degrees:90}),{},function(){t.attr("src",h+"?"+Math.random()),t.fadeIn(),e.removeClass("updating")});else{t.height()<120&&t.css("margin-top",(120-t.height())/2+"px");var o=t.width(),c=1,f=document.createElement("div"),u=parseInt($(this).attr("rotate")),r=parseInt($(this).attr("actualRotate"));u+=90,r+=90,r==360&&(r=0),$(this).attr("rotate",u).attr("actualRotate",r),o>120&&(r==90||r==270)&&(c=120/o),i="transform","MozTransform"in f.style&&(i="-moz-transform"),"WebkitTransform"in f.style&&(i="-webkit-transform"),"OTransform"in f.style&&(i="-o-transform"),"MsTransform"in f.style&&(i="-ms-transform"),t.css(i,"rotate("+u+"deg) scale("+c+")"),$(this).find(".rotateLayer").css(i,"rotate("+u+"deg)")}FR.Track.Event(FR.Track.Params.Upload,"rotate")}});$("body.uploader").on("change","#fileupload .itemSelect, #fileUploadFlash .itemSelect",function(){f.UploadBatchSummary()});$("body.uploader").on("click","#finish-next, #successSummary .primaryButton",function(n){if(n.preventDefault(),!$(this).is(".disabled"))if(f._uploadStage==1)$("#dropbox input").trigger("click"),FR.Track.Event(FR.Track.Params.Upload,"upload-next-trigger");else if(f._uploadStage==2){var i=$("#fileUploadFlash .item, #fileupload .item").length-1,t=$("#fileUploadFlash .item.ready, #fileupload .item.ready").length;t==i?(FR.Upload.FinishEditing(),FR.Track.Event(FR.Track.Params.Upload,"upload-next-complete")):($(".item").each(function(){f.ValidateItem($(this))}),$("#incomplete-confirm-modal").modal({backdrop:"static"}),FR.Track.Event(FR.Track.Params.Upload,"upload-next-incomplete"))}else f._uploadStage==9&&(document.location=f._returnUrl)});$("body.uploader").on("keyup",".assetDescription",function(n){$(this).closest(".item").hasClass("checked")&&$(".item.checked .assetDescription").val($(n.currentTarget).val())});$("body.uploader").on("keyup",".assetTitle",function(n){var t=$(n.currentTarget).val();$(".item.checked .assetTitle").each(function(n){var r="";n>0&&(r=" ("+n+")"),t!=""&&$(this).val(t+r)}),f.CheckDone()});$("#batchTitle").on("keyup",function(n){var t=$(n.currentTarget).val();$(".item.checked .assetTitle").each(function(n){var r="";n>0&&(r=" ("+n+")"),t!=""&&$(this).val(t+r)}),f.CheckDone()});$("body.uploader").on("keyup",".assetYear, #batchYear",function(n){$(".item.checked .assetYear").val($(n.currentTarget).val()),f.CheckDone()});$("#batchLocation").typeahead({source:function(n,t){var i=FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.UploadAutoComplete,{location:n,scope:"Worldwide"});FR.Data.Get(i,{dataType:"json"},function(n){var i=[];$.each(n,function(n,t){i.push(t.text)}),t(i)},function(){})},updater:function(n){return $(".item.checked").each(function(t,i){$(".assetLocation",i).val(n),$(".assetLatitude, .assetLongitude",i).val(null)}),n}});$("#batchLocation").on("keyup",function(n){$(".item.checked .assetLocation").val($(n.currentTarget).val())});$("#batchKeywords").on("keyup",function(n){var i,t;if(n.preventDefault(),i=n.keyCode?n.keyCode:n.which,i==13||i==32||i==188){if(t=$(this).val(),i!=13&&(t=t.slice(0,-1)),t=="")return!1;$(this).val(""),$(".item.checked .tagList").each(function(n,i){$(i).html($(i).html()+'<span class="tag" data-val="'+t+'">'+t+'<a class="remove" title="Remove tag"></a></span>'),FR.Track.Event(FR.Track.Params.Upload,"tag-batcheditor-add")}),f._useMasonry&&$("#html5-file-container .files, #filedata-queue").masonry("reload")}});$("#batchDescription").on("keyup",function(n){$(".item.checked .assetDescription").val($(n.currentTarget).val()),f.CheckDone()});$("#exifYes").on("click",function(n){n.preventDefault(),f.PopulateExifData(),FR.Track.Event(FR.Track.Params.Upload,"exif-yes")});$("#exifNo").on("click",function(n){n.preventDefault(),$("#header-help").slideUp(),$("#header-controls").slideDown(),$("#exifQuestion").hide(),FR.Track.Event(FR.Track.Params.Upload,"exif-no")});$("#cancel-keepsafe-save").on("click",function(n){n.preventDefault(),$(this).hasClass("wait")||($(this).html("").addClass("wait"),$("#cancel-leave").hide(),f.SaveAll(function(){window.location=$("#cancel-leave").attr("href")}),FR.Track.Event(FR.Track.Params.Upload,"cancel-with-save"))});$("#cancel-leave").on("click",function(n){var i,t;n.preventDefault(),i=this,$(i).html("").addClass("wait"),$("#cancel-keepsafe-save").hide(),t=$(".item").length,$(".item").each(function(n,i){var r=$(".details",i).attr("data-guid");FR.Data.Post(FR.UrlHelper.Urls.UploadDelete,null,{id:r},function(){t==n+1&&(window.location=f._returnUrl)},function(){FR.Track.Event(FR.Track.Params.Upload,"delete-error"),t==n+1&&(window.location=f._returnUrl)})}),FR.Track.Event(FR.Track.Params.Upload,"cancel-remove")});$("#add-more-btn").on("click",function(n){n.preventDefault(),f._moreUpload=!0,$("#fileUploadFlash .uploadButton").removeClass("item").removeClass("add-more-item"),$(".item").remove(),f._useMasonry&&($("#html5-file-container .item, #filedata-queue .item").unbind("change"),$("#html5-file-container .files, #filedata-queue").masonry("destroy")),$("#header-controls").hide(),$("#help, #header-help").show(),f._usingHtml5?($("#dropbox input").trigger("click"),$("#upload-header, #fileupload").show()):($("#fileUploadFlash").removeClass("selected"),$("#filedata-button, #filedata").css("width",600).css("height",100),$("#fileUploadFlash .uploadButton .secondaryButton").addClass("primaryButton").removeClass("secondaryButton"),$("#fileUploadFlash").show(),$("#upload-header, #fileUploadFlash").show()),$("#successSummary").hide(),$(".tabNav li").eq(1).addClass("current").removeClass("complete"),$(".tabNav li").eq(2).addClass("disabled").removeClass("current"),$("#finished-button").addClass("disabled wait"),$("#add-more-btn").css("visibility","hidden"),FR.Track.Event(FR.Track.Params.Upload,"upload-more")});FR.Upload.InitialiseUploader()},InitialiseUploader:function(){var n=FR.Upload,i=0,t,r;if(n._usingHtml5=!!window.FileReader&&Modernizr.draganddrop,n._usingHtml5)$("#fileupload").fileupload({previewMaxWidth:300,previewMaxHeight:120,start:function(){$("#dropbox").hide(),$(".tabNav li").eq(0).removeClass("current").addClass("complete"),$(".tabNav li").eq(1).removeClass("disabled complete").addClass("current"),n._uploadStage=2,n.SetHelpPage(2),$("#finish-next").text("Next").removeClass("green disabled"),$("#batchEdit:visible").length>0&&$("#batch-edit-done").click()},autoUpload:!0,always:function(t,r){if(FR.Util.AttachInlineCount($(".assetDescription").not(".overflowHide"),{count:500,expandable:!0}),i++,r.result!=null&&r.result.files!=null&&r.result.files.length>0&&r.result.files[0].HasExifData&&r.result.files[0].IsFromCamera){n._hasExif=!0;try{var u=new Date(parseInt(r.result.files[0].CreatedOn.substr(6)));$(".assetYear",r.context).attr("data-year",u.getFullYear()),$(".assetLatitude",r.context).attr("data-latitude",r.result.files[0].Latitude),$(".assetLongitude",r.context).attr("data-longitude",r.result.files[0].Longitude),r.result.files[0].Location!=null&&$(".assetLocation",r.context).attr("data-location",r.result.files[0].Location.Text)}catch(t){}}return!0},fail:function(n,t){var i=$(t.context);$(".progressStatus",i).addClass("warning").html("Error"),$(".progress",i).hide(),$(".size",i).after('<div class="upload-error">Sorry, there was an error uploading your file. Please try again</div>')},stop:function(){n.FinishUpload(),FR.Track.EventWithData(FR.Track.Params.Upload,"html5-file-count",{count:i})},previewSourceMaxFileSize:1e8,maxFileSize:1e8,maxNumberOfFiles:100,limitConcurrentUploads:1,sequentialUploads:!0,previewAsCanvas:!1}),$("#fileupload").fadeIn(),FR.Track.Event(FR.Track.Params.Upload,"upload-html5-init");else{$("#filedata").uploadify({swf:FR.StaticUrl+"/js/libs/uploadify/uploadify.swf",uploader:n._uploadUrl,formData:n._uploadData,removeCompleted:!1,queueID:"fileUploadFlash",onSelect:function(t){var r,f,u;$("#finish-next").text("Next").removeClass("green disabled"),$("#fileUploadFlash").addClass("selected"),$("#filedata-button, #filedata").css("width",300).css("height",353),$("#fileUploadFlash .uploadButton").addClass("item").addClass("add-more-item"),$("#fileUploadFlash .uploadButton .primaryButton").addClass("secondaryButton"),$("#fileUploadFlash .uploadButton .secondaryButton").removeClass("primaryButton"),n._uploadStage=2,n.SetHelpPage(2),$(".tabNav li").eq(0).removeClass("current").addClass("complete"),$(".tabNav li").eq(1).removeClass("disabled complete").addClass("current"),r=$(".uploadify-queue-item").last(),r.wrap('<div class="item"></div>'),r.find(".cancel").addClass("itemDel").attr("title","Remove"),r.before(r.find(".cancel")),r.wrap('<div class="itemInner"></div>'),f=t.name,u=" "+FR.Upload.CheckFileType(f),r.before('<div class="preview'+u+'" rotate="0" actualrotate="0"></div>'),r.closest(".item").prepend($("#titleBarTemplate .titleBar").eq(0).clone()),i++,$("#batchEdit:visible").length>0&&$("#batch-edit-done").click()},onUploadSuccess:function(t,i){var c=JSON.parse(i),u=c.files,o;if(u[0]!=null){var s="",h="",f="",e="";if(u[0].HasExifData&&u[0].IsFromCamera){n._hasExif=!0;try{o=new Date(parseInt(u[0].CreatedOn.substr(6))),s=o.getFullYear(),h=u[0].Latitude,f=u[0].Longitude,u[0].Location.Text!=null&&(e=u[0].Location.Text)}catch(l){}}$("#"+t.id).after('<div class="details" data-guid="'+u[0].Id+'"><label>Title*</label><input type="text" placeholder="Type here" value="'+u[0].ImageName+'" class="assetTitle"/><label>Year*</label><input type="text" placeholder="Type here" class="assetYear" data-year="'+s+'"/><label>Location</label><input type="text" placeholder="Optional" class="assetLocation" data-location="'+e+'"/><input type="hidden" class="assetLatitude" data-latitude="'+h+'"/><input type="hidden" class="assetLongitude" data-longitude="'+f+'"/><div class="tagRegion"><label>Keywords</label><input type="text" placeholder="Optional" class="assetTags"/><div class="tagList"></div></div><label>Description</label><div class="descriptionWrapper"><textarea class="assetDescription" placeholder="Optional"></textarea></div>'),$("#"+t.id).hide().closest(".itemInner").find(".preview").append('<img src="'+u[0].ImageUrl+'" /><div class="rotateLayer"></div>'),$("#"+t.id).closest(".itemInner").find(".preview").removeClass("uploading"),$("#"+t.id).closest(".item").find(".titleBar .progressStatus").addClass("warning").text("Add title & year")}},onQueueComplete:function(){n.FinishUpload(),FR.Track.EventWithData(FR.Track.Params.Upload,"flash-file-count",{count:i})},height:353,width:300}),t=!1,$("#fileUploadFlash").height("auto"),$("#finish-next").addClass("disabled");try{r=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),r&&(t=!0)}catch(u){navigator.mimeTypes["application/x-shockwave-flash"]!=undefined&&(t=!0)}t?($("#fileUploadFlash").show(),FR.Track.Event(FR.Track.Params.Upload,"upload-flash-init")):($("#no-upload").show(),$("#upload-header").hide(),FR.Track.Event(FR.Track.Params.Upload,"upload-nothing-init"))}},FinishUpload:function(){var n=FR.Upload,t;if(n._useMasonry&&($(".masonry").length>0?$("#html5-file-container .files, #filedata-queue").masonry("reload"):($("#html5-file-container .files, #filedata-queue").masonry({itemSelector:".item",columnWidth:322,isAnimated:!0}),$("#html5-file-container .item, #filedata-queue .item").bind("change",function(){$("#html5-file-container .files, #filedata-queue").masonry("reload")}))),n._usingHtml5&&$("#add-more-inline").length==0){t=$('<div id="add-more-inline" class="item add-more-item"><a href="#" id="add-more-inline-btn" class="secondaryButton large">Add more files</a></div>'),$("#html5-file-container .files, #filedata-queue").prepend(t).masonry("reload");$("#add-more-inline-btn").on("click",function(n){n.preventDefault(),$("#dropbox input").trigger("click")})}$(".assetLocation").typeahead({source:function(n,t){var i=FR.UrlHelper.UrlQueryBuilder(FR.UrlHelper.Urls.UploadAutoComplete,{location:n,scope:"Worldwide"});FR.Data.Get(i,{dataType:"json"},function(n){var i=[];$.each(n,function(n,t){i.push(t.text)}),t(i)},function(){})},updater:function(n){return $(this.$element).siblings(".assetLatitude").val(null),$(this.$element).siblings(".assetLongitude").val(null),$(this.$element).closest(".item").hasClass("checked")&&$(".item.checked .assetLocation").val(n),n}}),n._moreUpload&&FR.Track.Event(FR.Track.Params.Upload,"add-more-inline"),n._moreUpload=!0,n.CheckExifData(),n.CheckDone()},CheckExifData:function(){var n=FR.Upload;n._hasExif?($("#exif-modal").modal({backdrop:"static"}),FR.Track.Event(FR.Track.Params.Upload,"exif-prompt")):($("#header-help").slideUp(),$("#header-controls").slideDown())},PopulateExifData:function(){var n=FR.Upload;$("#exif-modal").modal("hide"),$(".item").each(function(n,t){var u=$(".assetYear",t),f=$(".assetLatitude",t),i=$(".assetLongitude",t),r=$(".assetLocation",t);u.val()||u.val(u.attr("data-year")),f.val()||f.val(f.attr("data-latitude")),i.val()||i.val(i.attr("data-longitude")),r.val()||r.val(r.attr("data-location"))}),$("#header-help").slideUp(),$("#header-controls").slideDown(),n.CheckDone(),n.SaveAll()},SaveAll:function(n){var i=FR.Upload,t=[];$(".item .details").each(function(){var f=$(this).attr("data-guid"),s=$(this).find(".assetTitle").val(),o=$(this).find(".assetYear").val(),h=$(this).find(".assetLocation").val(),l=$(this).find(".assetLatitude").val(),c=$(this).find(".assetLongitude").val(),r=$(this).find(".assetDescription").val(),i=$(this).closest(".itemInner"),u=i.find(".preview").attr("actualrotate"),e=i.find(".tagList .tag"),n="";$.each(e,function(t,i){n=n+$(i).attr("data-val")+" "}),t.push({id:f,title:s,description:r,year:o,tags:n,rotation:u,location:{Text:h,Latitude:l,Longitude:c}})}),$(".item .preview").attr("actualrotate",0),FR.Data.Post("/Media/EditMedia",null,t,function(){typeof n=="function"&&n()})},CheckDone:function(){$(".item").each(function(){FR.Upload.ValidateItem($(this))});var t=$("#fileUploadFlash .item, #fileupload .item").length-1,n=$("#fileUploadFlash .item.ready, #fileupload .item.ready").length,i=$("#fileUploadFlash .item.partial, #fileupload .item.partial").length;$("#uploaderHeader .completed").text(Math.floor((n+i/2)/t*100)),t==n&&($("#finish-next").text("Save").addClass("green"),$("#upload-step2").addClass("complete").removeClass("current"))},CheckFileType:function(n){var u=/(?:\.([^.]+))?$/,t=u.exec(n)[1].toLowerCase(),r="|jpg|jpeg|gif|png|",i="|avi|flv|m1v|mp4|mpg|mpeg|wmv|mov|webm|ogv|";return r.indexOf(t)>-1?"image":i.indexOf(t)>-1?"video":!1},SetHelpPage:function(n){n==1&&($("#uploadHelpP1").show(),$("#uploadHelpP2").hide(),$("#upload-help-modal .modal-header h3").html("Upload your files"),$("#helpNext1").html("Next"),FR.Track.Event(FR.Track.Params.Upload,"help1")),n==2&&($("#uploadHelpP1").hide(),$("#uploadHelpP2").show(),$("#upload-help-modal .modal-header h3").html("Add titles and dates"),$("#helpNext1").html("Previous"),FR.Track.Event(FR.Track.Params.Upload,"help2")),$("#help-page-count").html(n+" of 2")},ValidateItem:function(n){var r;if(!n.hasClass("add-more-item")){var e=n.find(".details"),u=e.find(".assetYear"),f=e.find(".assetTitle"),t=u.val(),i=f.val();i!=null&&t!=null&&(i=$.trim(i),t=$.trim(t),i.length>1&&t.length>3&&!isNaN(t)&&t>1752&&t<=(new Date).getFullYear()?(n.addClass("ready").removeClass("partial"),u.removeClass("invalid"),f.removeClass("invalid"),n.find(".progressStatus").removeClass("warning").text("Ready")):(i.length>1?(n.addClass("partial"),f.removeClass("invalid")):f.addClass("invalid"),t.length>3&&!isNaN(t)&&t>1752&&t<=(new Date).getFullYear()?(n.addClass("partial"),u.removeClass("invalid")):u.addClass("invalid"),r=i.length>2?"Add year":t.length>3&&!isNaN(t)&&t>1752&&t<=(new Date).getFullYear()?"Add title":"Add title & year",n.removeClass("ready").find(".progressStatus").addClass("warning").text(r)))}},FinishEditing:function(){var n=FR.Upload,i,t="files",r;$("#upload-header").hide(),n._fromKeepsafe?(i=$("#fileUploadFlash .item, #fileupload .item").length-1,i==1&&(t="file"),$("#uploadedToBox").show().text(t+" to your Keepsafe"),$("#batchEdit, #fileupload, #fileUploadFlash").hide(),$("#successSummary").show(),$("#help").hide(),$("#uploadedAssets").text(i),$("#keepsafeMessage").hide(),$(".tabNav li").eq(1).removeClass("current").addClass("complete"),$(".tabNav li").eq(2).removeClass("disabled").addClass("current"),n.SaveAll(function(){$("#finished-button").removeClass("wait disabled").html("I'm done").attr("href",n._returnUrl),$("#add-more-btn").css("visibility","visible")}),n._uploadStage=9):(i=$("#fileUploadFlash .item, #fileupload .item").length-1,$("#uploadedToBox").show(),r=$("#fileUploadFlash .item.ready, #fileupload .item.ready").length,r==1&&(t="memory"),$("#uploadedToBox").show().text(t+" to "+n._boxName),n.SaveAll(function(){var t=[];$(".item.ready .details").each(function(n,i){t.push($(i).attr("data-guid"))}),FR.Data.Post("/Memory/AddResources",null,{resourceIds:t,boxId:n._boxId},function(){$("#finished-button").removeClass("wait disabled").html("I'm done").attr("href",n._returnUrl).off("click"),$("#add-more-btn").css("visibility","visible")})}),$("#batchEdit, #fileupload, #fileUploadFlash").hide(),$("#successSummary").show(),$("#uploadedAssets").text(r),i-r>0?(t=" photos had insufficient information and were ",i-r==1&&(t=" photo had insufficient information and was "),$("#uploadedInsufficient").text(i-r+t)):$("#keepsafeMessage").hide(),$("#finish-next").text("Save"),$(".tabNav li").eq(1).removeClass("current").addClass("complete"),n._uploadStage=9)},UploadBatchSummary:function(){var t=$("#fileupload .itemSelect:checked, #fileUploadFlash .itemSelect:checked").length,n;$(".item").each(function(){$(this).find(".itemSelect").is(":checked")?$(this).addClass("checked"):$(this).removeClass("checked")}),n="photos",t==1&&(n="photo"),$("#batchHeader .batch-memory-count").html(t+" selected "+n)}};FR.Recommend={Setup:function(n){$(".recommend-keeps").on("click",function(n){n.preventDefault();var i=$("a",this),u=parseInt(i.html().replace(/\,/g,""),10),t=i.attr("data-id"),f=i.attr("data-type"),r=i.attr("href");$(this).hasClass("kept")?($(this).removeClass("kept"),i.html(u-1),FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Remove,[],{id:t},function(){FR.Track.EventWithData(FR.Track.Params.Recommend,"unkeep",{key:t})})):($(this).addClass("kept"),i.html(u+1),f=="Box"?FR.OpenGraph.KeepBox(r,!1,function(){FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Add,[],{id:t,returnUrl:r},function(){FR.Track.EventWithData(FR.Track.Params.Recommend,"keep",{key:t})},function(){})}):FR.OpenGraph.KeepMemory(r,!1,function(){FR.Data.Post(FR.UrlHelper.Urls.Keepsafe.Add,[],{id:t,returnUrl:r},function(){FR.Track.EventWithData(FR.Track.Params.Recommend,"keep",{key:t})},function(){})}))});$(".why-recommend a").on("click",function(n){n.preventDefault(),$("#recommend-memory-items").hide(),$("#recommend-why-content").show(),$(".why-recommend a").hide()});$("#recommend-why-content a.primaryButton").on("click",function(n){n.preventDefault(),$("#recommend-memory-items").show(),$("#recommend-why-content").hide(),$(".why-recommend a").show()});FR.Track.EventWithData(FR.Track.Params.Recommend,"display",n)}};FR.Newsfeed={Setup:function(){var u=40,r=1,n=!1,t=!1,i=$("#contentFooter").offset().top;setInterval(function(){var o,e,f;n||t||(o=$(window).scrollTop()+$(window).height(),e=i-o,e<5e3&&(f=r*u,n==!0,r++,FR.Data.Get("/Newsfeed/MemoryStream?skip="+f+"&take="+u,{},function(r){r?(n=!1,$("#memoryStreamBody").append(r),i=$("#contentFooter").offset().top):t=!0},function(){n=!1})))},5e3);$(document).on("fr.pager.page",function(){FR.Adverts.Refresh(!0)});FR.Data.Post(FR.UrlHelper.Urls.Newsfeed.Viewed,{dataType:"json"},{},function(){},function(){}),FR.Data.Get(FR.UrlHelper.Urls.Newsfeed.ReactionsModule,{},function(n){$("#reactions-module-holder").html(n)},function(){}),FR.Data.Get(FR.UrlHelper.Urls.Newsfeed.ContactsModule,{},function(n){$("#contacts-module-holder").html(n)},function(){}),FR.Data.Get(FR.UrlHelper.Urls.Newsfeed.ActivityModule,{},function(n){$("#activity-module-holder").html(n)},function(){})}};FR.MorePager={Setup:function(){function t(){if($(".commmentSortTabs .reply-tab.selected").hasClass("newest")){var n=FR.UrlHelper.UrlQueryBuilder("/Discussion/NewReplies",{timestamp:$("#reply-timestamp").val(),id:id});FR.Data.Get(n,{},function(n){var i=$(n),r;$("#reply-timestamp").remove(),r=$("#replies-list .reply-item"),r.length>0?$("#replies-list .reply-item").last().after(i):$("#replies-list").prepend(i),$(".reply-item",i).length>0&&($("#new-replies-btn").fadeIn(),FR.Track.Event(FR.Track.Params.Discussion,"NewRepliesAvailable")),setTimeout(function(){t()},FR.Discussions._pollingTimeout)},function(){})}}$(".show-more").on("click",function(n){n.preventDefault();var t=this;FR.Data.Get($("#more-replies-url").attr("data-href"),{},function(n){$("#more-replies-url").remove(),$(".paged-item").last().after(n),$("#more-replies-url").length>0?$(t).attr("href",$("#more-replies-url").attr("data-href")):$(t).parent().hide()}),FR.Track.PageWithData(FR.Track.Params.MorePager,"More"),FR.Adverts.Refresh(!0)});$(".commmentSortTabs .reply-tab.selected").hasClass("newest")&&setTimeout(function(){t()},FR.Discussions._pollingTimeout);$("#comment-list .pager-refresh-target").on("click","#new-replies-btn",function(n){n.preventDefault(),$(".new-hidden-replies").show().removeClass(".new-hidden-replies"),$(this).fadeOut(),FR.Track.Event(FR.Track.Params.Discussion,"NewRepliesShown"),FR.Adverts.Refresh(!0)});$(".commmentSortTabs .reply-tab").on("click",function(n){n.preventDefault();var i=this;$(".commmentSortTabs .selected").removeClass("selected"),$("#replies-list .reply-item").removeClass("marker").removeClass("markerBottom"),$(i).addClass("selected"),$(i).hasClass("newest")?(setTimeout(function(){t()},FR.Discussions._pollingTimeout),FR.Data.Get($(i).attr("href"),{},function(n){$("#replies-list").replaceWith(n)}),FR.Track.PageWithData(FR.Track.Params.Discussion,"SwitchTabNewest")):($("#new-replies-btn").hide(),FR.Data.Get($(i).attr("href"),{},function(n){$("#replies-list").replaceWith(n)}),FR.Track.PageWithData(FR.Track.Params.Discussion,"SwitchTabOldest")),FR.Adverts.Refresh(!0)});$("#comment-list").on("click",".showMore.sortNewest",function(n){n.preventDefault();var t=this;$("#replies-list .reply-item").removeClass("markerBottom").last().addClass("markerBottom"),FR.Data.Get($(t).attr("href"),{},function(n){$("#more-replies-url").remove(),$("#replies-list .reply-item").last().after(n),$("#more-replies-url").length>0?$(t).attr("href",$("#more-replies-url").attr("data-href")):$(t).hide()}),FR.Track.PageWithData(FR.Track.Params.Discussion,"ShowMoreNewest"),FR.Adverts.Refresh(!0)});$("#comment-list").on("click",".showMore.sortOldest",function(n){n.preventDefault();var t=this;$("#replies-list .reply-item").removeClass("marker").first().addClass("marker"),FR.Data.Get($(t).attr("href"),{},function(n){$("#more-replies-url").remove(),$("#replies-list .reply-item").first().before(n),$("#more-replies-url").length>0?$(t).attr("href",$("#more-replies-url").attr("data-href")):$(t).hide()}),FR.Track.PageWithData(FR.Track.Params.Discussion,"ShowMoreOldest"),FR.Adverts.Refresh(!0)});$("#commmentSortTabs .reply-tab-disabled").on("click",function(n){n.preventDefault()})}};FR.ProfileVisit={Data:{},Setup:function(){var n=$("#errorPanel"),t=$("#visit-submit").validate({errorContainer:n,errorLabelContainer:$("ul",n),wrapper:"li",rules:{VisitorMessage:{required:!0,minlength:2,maxlength:40,alphanumeric:!0}}});$("#sendBuzzButton").on("click",function(){$("#myModal").css("visibility","visible")});$("a.buzz-icon").on("click",function(n){n.preventDefault(),$("#VisitorPictureUrl").val($(this).attr("data-value")),$("#visit-submit").submit()});$("a.buzz-delete").on("click",function(n){n.preventDefault();var i="/profile/DeleteVisitor",t=$(this).attr("data-value");FR.Data.Post(i,[],{id:t},function(n){if(n.isSuccess==!0){var i="#buzz"+t;$(i).remove()}})});$("#visit-submit").submit(function(){var t,n;if($(this).valid()){if(t="/profile/SaveVisitor",n=$("#VisitorMessage").val(),n=="")return;var u=$("#MemberId").val(),r=$("#EncodedId").val(),i=$("#VisitorPictureUrl").val();FR.Data.Post(t,[],{MemberId:u,VisitorMessage:n,EncodedId:r,VisitorPictureUrl:i},function(n){if(n.isSuccess==!0){var t="<tr id='buzz"+n.Data.Id+"'><td><img src='' class='Buzzes/"+n.Data.VisitorPictureUrl,i=new Date(parseInt(n.Data.DateAdded.substr(6)));t=t+"' /></td><td>&nbsp;"+n.Data.VisitorMessage+"</td><td><a href='"+n.Data.SenderUrl+"'>("+n.Data.SenderName+" "+i.toDateString()+"</a></td>",$("#buzz-list").prepend(t)}FR.Adverts.Refresh(!0),FR.Track.Page("SaveVisitor")})}return $("#myModal").css("visibility","hidden"),!1})}};FR.ProfileView={Setup:function(){$(".profile-gallery-set").on("click",function(n){n.preventDefault();var i=$(this).attr("data-id"),t=$(this).attr("data-url");FR.Data.Get("/Profile/ChangeProfilePhoto?newPhotoId="+i,{},function(){$(".profilePic img").attr("src",t)})});$(".profile-gallery-hide").on("click",function(n){n.preventDefault();var t=$(this).attr("data-id");$(this).closest(".carousel-item-wrap").remove(),FR.Data.Get("/Profile/RemoveProfilePhoto?id="+t,{},function(){})});$(".change-memory-order").click(function(){return $("#memory-order li").removeClass("selected"),$(this).parent().addClass("selected"),$("#hdnSort").val($(this).attr("value")),FR.Memory.GetMemberMemories(),!1}),$(".change-memory-show").change(function(){return $("#memory-show li").removeClass("selected"),$(this).parent().addClass("selected"),$("#hdnShow").val($(this).attr("value")),FR.Memory.GetMemberMemories(),!1}),$("#selDateFrom").change(function(){return FR.Memory.GetMemberMemories(),!1}),$("#selDateTo").change(function(){return FR.Memory.GetMemberMemories(),!1});$("#blockButton").on("click",function(){var n=this;return $.InlineConfirm($("#blockButton"),$("#column1"),{message:"Are you sure you want to block this user?",confirmButtonText:"Block",cancelButtonText:"Cancel",callback:function(){FR.Data.Post(FR.UrlHelper.Urls.Relationship.BlockMember,[],{memberId:$(n).attr("data-user")},function(n){n&&(window.location.href='@Url.Action("Index", "Newsfeed")')})}}),!1});$("#unBlockButton").on("click",function(){var n=this;return $.InlineConfirm($("#unBlockButton"),$("#column1"),{message:"Are you sure you want to unblock this user?",confirmButtonText:"Unblock",cancelButtonText:"Cancel",callback:function(){FR.Data.Post(FR.UrlHelper.Urls.Relationship.UnblockMember,[],{memberId:$(n).attr("data-user")},function(n){n&&(window.location.href='@Url.Action("Index", "Newsfeed")')})}}),!1});$("#friendButton").on("click",function(){var n=this;return $(n).addClass("wait"),$(n).hasClass("contact")?FR.Data.Post(FR.UrlHelper.Urls.Relationship.RemoveFriendByMemberId,[],{friendId:"@Model.MemberId"},function(){$(n).removeClass("contact").removeClass("wait"),$(n).html("Add Friend ")}):FR.Data.Post(FR.UrlHelper.Urls.Relationship.AddFriend,[],{friendId:"@Model.MemberId"},function(){$(n).addClass("contact").removeClass("wait"),$(n).html("Friend")}),!1});$("#friendButton").hover(function(){$(this).hasClass("contact")&&$(this).html("Remove")},function(){$(this).hasClass("contact")&&$(this).html("Contact")})}};$.watermark.options.useNative=Modernizr.input.placeholder,$.watermark.options.className="markCls",$(".watermark").each(function(n,t){$(t).watermark($(t).attr("placeholder"))}),FR.Initialise=function(){function t(){var n,i;if(typeof FB!="undefined"&&FB!=null){if(FR.FBLoaded=!0,FR&&FR.fbLoad)for(n=0;n<FR.fbLoad.length;n++)i=FR.fbLoad[n],$(document).ready(i);FR.FBExecuted=!0}else setTimeout(function(){t()},500)}function n(){var t,i;if(FR.FBLoaded&&FR.FBInit){if(FR&&FR.fbInitLoad)for(t=0;t<FR.fbInitLoad.length;t++)i=FR.fbInitLoad[t],$(document).ready(i)}else setTimeout(function(){n()},500)}if(FR&&FR.onLoad){for(i=0;i<FR.onLoad.length;i++){var r=FR.onLoad[i];$(document).ready(r)}FR.Loaded=!0,t(),n(),FR.Load(function(){$("#content").css("minHeight",$(".primaryNav").height()+100+"px"),FR.Util.AddLargeProfileLinks()})}$(window).bind("load",function(){FR.InitialiseAds()})},FR.InitialiseAds=function(){var n,t;if(FR&&FR.advertLoad){for(n=0;n<FR.advertLoad.length;n++)t=FR.advertLoad[n],$(document).ready(t);FR.LoadedAdverts=!0}},function(n,t){var i=function(n,t,i){var r;return function(){function e(){i||n.apply(f,u),r=null}var f=this,u=arguments;r?clearTimeout(r):i&&n.apply(f,u),r=setTimeout(e,t||100)}};jQuery.fn[t]=function(n){return n?this.bind("resize",i(n)):this.trigger(t)}}(jQuery,"smartresize"),function(n,t){var i=function(n,t,i){var r,u=0,f=new Date;return function(){function o(){u=0,i||n.apply(s,h),r=null}var s=this,h=arguments,e;u++,u==1&&(e=new Date,e-f>1e3&&(f=e,clearTimeout(r),o())),u>15&&(clearTimeout(r),o()),r?clearTimeout(r):i&&n.apply(s,h),r=setTimeout(o,t||500)}};jQuery.fn[t]=function(n){return n?this.bind("keydown",i(n)):this.trigger(t)}}(jQuery,"smartkeydown");